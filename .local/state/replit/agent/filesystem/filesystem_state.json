{"file_contents":{"constants/theme.ts":{"content":"import { Platform } from \"react-native\";\n\nexport const AppColors = {\n  primary: \"#4CAF50\",\n  primaryDark: \"#388E3C\",\n  secondary: \"#F44336\",\n  secondaryDark: \"#D32F2F\",\n  accent: \"#2196F3\",\n  accentLight: \"#E3F2FD\",\n  warning: \"#FF9800\",\n  info: \"#03A9F4\",\n  error: \"#E91E63\",\n  success: \"#66BB6A\",\n  divider: \"#E0E0E0\",\n};\n\nexport const Colors = {\n  light: {\n    text: \"#212121\",\n    textSecondary: \"#757575\",\n    buttonText: \"#FFFFFF\",\n    tabIconDefault: \"#757575\",\n    tabIconSelected: \"#4CAF50\",\n    link: \"#2196F3\",\n    backgroundRoot: \"#FAFAFA\",\n    backgroundDefault: \"#FFFFFF\",\n    backgroundSecondary: \"#F5F5F5\",\n    backgroundTertiary: \"#EEEEEE\",\n  },\n  dark: {\n    text: \"#ECEDEE\",\n    textSecondary: \"#9BA1A6\",\n    buttonText: \"#FFFFFF\",\n    tabIconDefault: \"#9BA1A6\",\n    tabIconSelected: \"#4CAF50\",\n    link: \"#64B5F6\",\n    backgroundRoot: \"#121212\",\n    backgroundDefault: \"#1E1E1E\",\n    backgroundSecondary: \"#2A2A2A\",\n    backgroundTertiary: \"#363636\",\n  },\n};\n\nexport const Spacing = {\n  xs: 4,\n  sm: 8,\n  md: 16,\n  lg: 24,\n  xl: 32,\n  xxl: 48,\n  inputHeight: 48,\n  buttonHeight: 56,\n  fabSize: 56,\n};\n\nexport const BorderRadius = {\n  xs: 4,\n  sm: 8,\n  md: 12,\n  lg: 16,\n  xl: 24,\n  full: 9999,\n};\n\nexport const Typography = {\n  h1: {\n    fontSize: 32,\n    fontWeight: \"700\" as const,\n  },\n  h2: {\n    fontSize: 28,\n    fontWeight: \"700\" as const,\n  },\n  h3: {\n    fontSize: 24,\n    fontWeight: \"600\" as const,\n  },\n  h4: {\n    fontSize: 20,\n    fontWeight: \"600\" as const,\n  },\n  body: {\n    fontSize: 16,\n    fontWeight: \"400\" as const,\n  },\n  small: {\n    fontSize: 14,\n    fontWeight: \"400\" as const,\n  },\n  link: {\n    fontSize: 16,\n    fontWeight: \"400\" as const,\n  },\n  caption: {\n    fontSize: 12,\n    fontWeight: \"400\" as const,\n  },\n};\n\nexport const Fonts = Platform.select({\n  ios: {\n    sans: \"system-ui\",\n    serif: \"ui-serif\",\n    rounded: \"ui-rounded\",\n    mono: \"ui-monospace\",\n  },\n  default: {\n    sans: \"normal\",\n    serif: \"serif\",\n    rounded: \"normal\",\n    mono: \"monospace\",\n  },\n  web: {\n    sans: \"system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif\",\n    serif: \"Georgia, 'Times New Roman', serif\",\n    rounded:\n      \"'SF Pro Rounded', 'Hiragino Maru Gothic ProN', Meiryo, 'MS PGothic', sans-serif\",\n    mono: \"SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace\",\n  },\n});\n","path":null,"size_bytes":2396,"size_tokens":null},"hooks/useScreenInsets.ts":{"content":"import { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\n\nimport { Spacing } from \"@/constants/theme\";\n\nexport function useScreenInsets() {\n  const insets = useSafeAreaInsets();\n  const headerHeight = useHeaderHeight();\n  const tabBarHeight = useBottomTabBarHeight();\n\n  return {\n    paddingTop: headerHeight + Spacing.xl,\n    paddingBottom: tabBarHeight + Spacing.xxl,\n    tabBarHeight,\n    headerHeight,\n    scrollInsetBottom: insets.bottom + 16,\n    insets,\n  };\n}\n\nexport function useBasicInsets() {\n  const insets = useSafeAreaInsets();\n\n  return {\n    paddingTop: insets.top + Spacing.xl,\n    paddingBottom: insets.bottom + Spacing.xxl,\n    scrollInsetBottom: insets.bottom + 16,\n    insets,\n  };\n}\n","path":null,"size_bytes":849,"size_tokens":null},"context/TripContext.tsx":{"content":"import React, { createContext, useContext, ReactNode } from \"react\";\nimport { useTrip } from \"@/hooks/useTrip\";\n\ntype TripContextType = ReturnType<typeof useTrip>;\n\nconst TripContext = createContext<TripContextType | null>(null);\n\nexport function TripProvider({ children }: { children: ReactNode }) {\n  const tripState = useTrip();\n\n  return (\n    <TripContext.Provider value={tripState}>{children}</TripContext.Provider>\n  );\n}\n\nexport function useTripContext() {\n  const context = useContext(TripContext);\n  if (!context) {\n    throw new Error(\"useTripContext must be used within a TripProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":624,"size_tokens":null},"screens/HistoryScreen.tsx":{"content":"import React, { useCallback, useState, useEffect } from \"react\";\nimport { StyleSheet, View } from \"react-native\";\nimport { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { useFocusEffect } from \"@react-navigation/native\";\n\nimport { ScreenFlatList } from \"@/components/ScreenFlatList\";\nimport { TripCard } from \"@/components/TripCard\";\nimport { EmptyState } from \"@/components/EmptyState\";\nimport { useTripContext } from \"@/context/TripContext\";\nimport { Trip, getAllSiteVisits, SiteVisit } from \"@/utils/storage\";\nimport { Spacing } from \"@/constants/theme\";\nimport { HistoryStackParamList } from \"@/navigation/HistoryStackNavigator\";\n\ntype HistoryScreenProps = {\n  navigation: NativeStackNavigationProp<HistoryStackParamList, \"History\">;\n};\n\nexport default function HistoryScreen({ navigation }: HistoryScreenProps) {\n  const { trips, settings, loadData } = useTripContext();\n  const [siteVisits, setSiteVisits] = useState<SiteVisit[]>([]);\n\n  useFocusEffect(\n    useCallback(() => {\n      loadData();\n      loadSiteVisits();\n    }, [loadData])\n  );\n\n  const loadSiteVisits = async () => {\n    const visits = await getAllSiteVisits();\n    setSiteVisits(visits);\n  };\n\n  const getSiteVisitCount = (tripId: string) => {\n    return siteVisits.filter((v) => v.tripId === tripId).length;\n  };\n\n  const sortedTrips = [...trips].sort((a, b) => b.startTime - a.startTime);\n\n  const renderItem = ({ item }: { item: Trip }) => (\n    <TripCard\n      trip={item}\n      useKilometers={settings.useKilometers}\n      siteVisitCount={getSiteVisitCount(item.id)}\n      onPress={() => navigation.navigate(\"TripDetails\", { tripId: item.id })}\n    />\n  );\n\n  const renderEmpty = () => (\n    <View style={styles.emptyContainer}>\n      <EmptyState\n        icon=\"clock\"\n        title=\"No Trip History\"\n        message=\"Your completed trips will appear here. Start a trip from the Home tab to get started.\"\n      />\n    </View>\n  );\n\n  return (\n    <ScreenFlatList\n      data={sortedTrips}\n      renderItem={renderItem}\n      keyExtractor={(item) => item.id}\n      ListEmptyComponent={renderEmpty}\n      showsVerticalScrollIndicator={false}\n    />\n  );\n}\n\nconst styles = StyleSheet.create({\n  emptyContainer: {\n    flex: 1,\n    justifyContent: \"center\",\n    paddingTop: Spacing.xxl,\n  },\n});\n","path":null,"size_bytes":2296,"size_tokens":null},"components/ThemedText.tsx":{"content":"import { Text, type TextProps } from \"react-native\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Typography } from \"@/constants/theme\";\n\nexport type ThemedTextProps = TextProps & {\n  lightColor?: string;\n  darkColor?: string;\n  type?: \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"body\" | \"small\" | \"link\" | \"caption\";\n};\n\nexport function ThemedText({\n  style,\n  lightColor,\n  darkColor,\n  type = \"body\",\n  ...rest\n}: ThemedTextProps) {\n  const { theme, isDark } = useTheme();\n\n  const getColor = () => {\n    if (isDark && darkColor) {\n      return darkColor;\n    }\n\n    if (!isDark && lightColor) {\n      return lightColor;\n    }\n\n    if (type === \"link\") {\n      return theme.link;\n    }\n\n    return theme.text;\n  };\n\n  const getTypeStyle = () => {\n    switch (type) {\n      case \"h1\":\n        return Typography.h1;\n      case \"h2\":\n        return Typography.h2;\n      case \"h3\":\n        return Typography.h3;\n      case \"h4\":\n        return Typography.h4;\n      case \"body\":\n        return Typography.body;\n      case \"small\":\n        return Typography.small;\n      case \"link\":\n        return Typography.link;\n      case \"caption\":\n        return Typography.caption;\n      default:\n        return Typography.body;\n    }\n  };\n\n  return (\n    <Text style={[{ color: getColor() }, getTypeStyle(), style]} {...rest} />\n  );\n}\n","path":null,"size_bytes":1320,"size_tokens":null},"screens/TripDetailsScreen.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { StyleSheet, View } from \"react-native\";\nimport { NativeStackScreenProps } from \"@react-navigation/native-stack\";\n\nimport { ScreenScrollView } from \"@/components/ScreenScrollView\";\nimport { StatCard } from \"@/components/StatCard\";\nimport { TimelineEvent, EventType } from \"@/components/TimelineEvent\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { TripMap } from \"@/components/TripMap\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useTripContext } from \"@/context/TripContext\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\nimport {\n  Trip,\n  SiteVisit,\n  formatDate,\n  formatTime,\n  formatDuration,\n  formatDistance,\n} from \"@/utils/storage\";\nimport { getSiteVisits, formatAllowanceAdvanced } from \"@/utils/dataAccess\";\nimport { HomeStackParamList } from \"@/navigation/HomeStackNavigator\";\n\ntype TripDetailsScreenProps = NativeStackScreenProps<\n  HomeStackParamList,\n  \"TripDetails\"\n>;\n\ninterface TimelineEventData {\n  id: string;\n  type: EventType;\n  time: number;\n  title: string;\n  subtitle?: string;\n  photoUri?: string;\n}\n\nexport default function TripDetailsScreen({\n  route,\n}: TripDetailsScreenProps) {\n  const { theme } = useTheme();\n  const { trips, settings } = useTripContext();\n  const { tripId } = route.params;\n\n  const [siteVisits, setSiteVisits] = useState<SiteVisit[]>([]);\n  const trip = trips.find((t) => t.id === tripId);\n\n  useEffect(() => {\n    loadSiteVisits();\n  }, [tripId]);\n\n  const loadSiteVisits = async () => {\n    const visits = await getSiteVisits(tripId);\n    setSiteVisits(visits);\n  };\n\n  if (!trip) {\n    return (\n      <ScreenScrollView>\n        <ThemedText type=\"body\">Trip not found</ThemedText>\n      </ScreenScrollView>\n    );\n  }\n\n  const buildTimelineEvents = (): TimelineEventData[] => {\n    const events: TimelineEventData[] = [];\n\n    events.push({\n      id: \"start\",\n      type: \"start\",\n      time: trip.startTime,\n      title: \"Left Home\",\n      subtitle: \"Trip started\",\n    });\n\n    siteVisits.forEach((visit) => {\n      events.push({\n        id: `arrival-${visit.id}`,\n        type: \"site_arrival\",\n        time: visit.arrivalTime,\n        title: `Arrived at ${visit.siteName}`,\n        subtitle: visit.notes,\n        photoUri: visit.photoUri,\n      });\n\n      if (visit.departureTime) {\n        events.push({\n          id: `departure-${visit.id}`,\n          type: \"site_departure\",\n          time: visit.departureTime,\n          title: `Departed ${visit.siteName}`,\n        });\n      }\n    });\n\n    if (trip.endTime) {\n      events.push({\n        id: \"end\",\n        type: \"end\",\n        time: trip.endTime,\n        title: \"Returned Home\",\n        subtitle: \"Trip completed\",\n      });\n    }\n\n    events.sort((a, b) => a.time - b.time);\n\n    return events;\n  };\n\n  const timelineEvents = buildTimelineEvents();\n\n  return (\n    <ScreenScrollView showsVerticalScrollIndicator={false}>\n      <View\n        style={[\n          styles.header,\n          {\n            backgroundColor: theme.backgroundDefault,\n            borderColor: theme.backgroundSecondary,\n          },\n        ]}\n      >\n        <ThemedText type=\"h3\">{formatDate(trip.startTime)}</ThemedText>\n        <ThemedText\n          type=\"small\"\n          style={[styles.timeRange, { color: theme.textSecondary }]}\n        >\n          {formatTime(trip.startTime)}\n          {trip.endTime ? ` - ${formatTime(trip.endTime)}` : \" - In Progress\"}\n        </ThemedText>\n      </View>\n\n      <ThemedText type=\"h4\" style={styles.sectionTitle}>\n        Route Map\n      </ThemedText>\n      <TripMap trip={trip} height={220} />\n\n      <View style={styles.statsGrid}>\n        <View style={styles.statsRow}>\n          <StatCard\n            title=\"Total Distance\"\n            value={formatDistance(trip.totalDistance, settings.useKilometers)}\n            icon=\"navigation\"\n            iconColor={AppColors.primary}\n          />\n          <View style={styles.statSpacer} />\n          <StatCard\n            title=\"Travel Allowance\"\n            value={formatAllowanceAdvanced(trip.totalDistance, settings)}\n            icon=\"dollar-sign\"\n            iconColor={AppColors.accent}\n          />\n        </View>\n        <View style={styles.statsRow}>\n          <StatCard\n            title=\"Duration\"\n            value={formatDuration(trip.startTime, trip.endTime)}\n            icon=\"clock\"\n            iconColor={AppColors.warning}\n          />\n          <View style={styles.statSpacer} />\n          <StatCard\n            title=\"Site Visits\"\n            value={siteVisits.length.toString()}\n            icon=\"map-pin\"\n            iconColor={AppColors.secondary}\n          />\n        </View>\n      </View>\n\n      <View style={styles.timelineContainer}>\n        <ThemedText type=\"h4\" style={styles.sectionTitle}>\n          Trip Timeline\n        </ThemedText>\n        {timelineEvents.map((event, index) => (\n          <TimelineEvent\n            key={event.id}\n            type={event.type}\n            time={event.time}\n            title={event.title}\n            subtitle={event.subtitle}\n            photoUri={event.photoUri}\n            isLast={index === timelineEvents.length - 1}\n          />\n        ))}\n      </View>\n    </ScreenScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  header: {\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    borderWidth: 1,\n    marginBottom: Spacing.md,\n  },\n  timeRange: {\n    marginTop: Spacing.xs,\n  },\n  statsGrid: {\n    gap: Spacing.md,\n    marginBottom: Spacing.lg,\n  },\n  statsRow: {\n    flexDirection: \"row\",\n  },\n  statSpacer: {\n    width: Spacing.md,\n  },\n  timelineContainer: {\n    marginTop: Spacing.md,\n  },\n  sectionTitle: {\n    marginBottom: Spacing.md,\n  },\n});\n","path":null,"size_bytes":5734,"size_tokens":null},"navigation/screenOptions.ts":{"content":"import { Platform } from \"react-native\";\nimport { NativeStackNavigationOptions } from \"@react-navigation/native-stack\";\nimport { isLiquidGlassAvailable } from \"expo-glass-effect\";\n\ninterface ScreenOptionsParams {\n  theme: {\n    backgroundRoot: string;\n    text: string;\n  };\n  isDark: boolean;\n  transparent?: boolean;\n}\n\nexport const getCommonScreenOptions = ({\n  theme,\n  isDark,\n  transparent = true,\n}: ScreenOptionsParams): NativeStackNavigationOptions => ({\n  headerTitleAlign: \"center\",\n  headerTransparent: transparent,\n  headerBlurEffect: isDark ? \"dark\" : \"light\",\n  headerTintColor: theme.text,\n  headerStyle: {\n    backgroundColor: Platform.select({\n      ios: undefined,\n      android: theme.backgroundRoot,\n      web: theme.backgroundRoot,\n    }),\n  },\n  gestureEnabled: true,\n  gestureDirection: \"horizontal\",\n  fullScreenGestureEnabled: isLiquidGlassAvailable() ? false : true,\n  contentStyle: {\n    backgroundColor: theme.backgroundRoot,\n  },\n});\n","path":null,"size_bytes":964,"size_tokens":null},"utils/storage.ts":{"content":"import AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nconst STORAGE_KEYS = {\n  TRIPS: \"@routetracker_trips\",\n  ACTIVE_TRIP: \"@routetracker_active_trip\",\n  GPS_POINTS: \"@routetracker_gps_points\",\n  SITE_VISITS: \"@routetracker_site_visits\",\n  USER_SETTINGS: \"@routetracker_user_settings\",\n};\n\nexport interface GPSPoint {\n  id: string;\n  tripId: string;\n  latitude: number;\n  longitude: number;\n  timestamp: number;\n  accuracy?: number;\n  isStationary?: boolean;\n  motionConfidence?: number;\n}\n\nexport interface SiteVisit {\n  id: string;\n  tripId: string;\n  siteName: string;\n  notes?: string;\n  photoUri?: string;\n  arrivalTime: number;\n  arrivalLatitude: number;\n  arrivalLongitude: number;\n  departureTime?: number;\n  departureLatitude?: number;\n  departureLongitude?: number;\n  schemeName?: string;\n  schemeNumber?: string;\n  esrDetails?: string;\n  village?: string;\n  issueReported?: string;\n  resolution?: string;\n  currentStatus?: string;\n}\n\nexport interface Trip {\n  id: string;\n  startTime: number;\n  endTime?: number;\n  startLatitude: number;\n  startLongitude: number;\n  endLatitude?: number;\n  endLongitude?: number;\n  totalDistance: number;\n  siteVisits: string[];\n  isActive: boolean;\n}\n\nexport interface UserSettings {\n  workerName: string;\n  workerId: string;\n  useKilometers: boolean;\n  allowanceRate: number;\n  gpsUpdateFrequency: \"low\" | \"medium\" | \"high\";\n}\n\nconst defaultSettings: UserSettings = {\n  workerName: \"\",\n  workerId: \"\",\n  useKilometers: true,\n  allowanceRate: 3.5,\n  gpsUpdateFrequency: \"medium\",\n};\n\nexport async function getTrips(): Promise<Trip[]> {\n  try {\n    const data = await AsyncStorage.getItem(STORAGE_KEYS.TRIPS);\n    return data ? JSON.parse(data) : [];\n  } catch (error) {\n    console.error(\"Error loading trips:\", error);\n    return [];\n  }\n}\n\nexport async function saveTrips(trips: Trip[]): Promise<void> {\n  try {\n    await AsyncStorage.setItem(STORAGE_KEYS.TRIPS, JSON.stringify(trips));\n  } catch (error) {\n    console.error(\"Error saving trips:\", error);\n  }\n}\n\nexport async function getActiveTrip(): Promise<Trip | null> {\n  try {\n    const data = await AsyncStorage.getItem(STORAGE_KEYS.ACTIVE_TRIP);\n    return data ? JSON.parse(data) : null;\n  } catch (error) {\n    console.error(\"Error loading active trip:\", error);\n    return null;\n  }\n}\n\nexport async function saveActiveTrip(trip: Trip | null): Promise<void> {\n  try {\n    if (trip) {\n      await AsyncStorage.setItem(STORAGE_KEYS.ACTIVE_TRIP, JSON.stringify(trip));\n    } else {\n      await AsyncStorage.removeItem(STORAGE_KEYS.ACTIVE_TRIP);\n    }\n  } catch (error) {\n    console.error(\"Error saving active trip:\", error);\n  }\n}\n\nexport async function getGPSPoints(tripId: string): Promise<GPSPoint[]> {\n  try {\n    const data = await AsyncStorage.getItem(STORAGE_KEYS.GPS_POINTS);\n    const allPoints: GPSPoint[] = data ? JSON.parse(data) : [];\n    return allPoints.filter((p) => p.tripId === tripId);\n  } catch (error) {\n    console.error(\"Error loading GPS points:\", error);\n    return [];\n  }\n}\n\nexport async function saveGPSPoint(point: GPSPoint): Promise<void> {\n  try {\n    const data = await AsyncStorage.getItem(STORAGE_KEYS.GPS_POINTS);\n    const allPoints: GPSPoint[] = data ? JSON.parse(data) : [];\n    allPoints.push(point);\n    await AsyncStorage.setItem(STORAGE_KEYS.GPS_POINTS, JSON.stringify(allPoints));\n  } catch (error) {\n    console.error(\"Error saving GPS point:\", error);\n  }\n}\n\nexport async function clearGPSPointsForTrip(tripId: string): Promise<void> {\n  try {\n    const data = await AsyncStorage.getItem(STORAGE_KEYS.GPS_POINTS);\n    const allPoints: GPSPoint[] = data ? JSON.parse(data) : [];\n    const filtered = allPoints.filter((p) => p.tripId !== tripId);\n    await AsyncStorage.setItem(STORAGE_KEYS.GPS_POINTS, JSON.stringify(filtered));\n  } catch (error) {\n    console.error(\"Error clearing GPS points:\", error);\n  }\n}\n\nexport async function getSiteVisits(tripId: string): Promise<SiteVisit[]> {\n  try {\n    const data = await AsyncStorage.getItem(STORAGE_KEYS.SITE_VISITS);\n    const allVisits: SiteVisit[] = data ? JSON.parse(data) : [];\n    return allVisits.filter((v) => v.tripId === tripId);\n  } catch (error) {\n    console.error(\"Error loading site visits:\", error);\n    return [];\n  }\n}\n\nexport async function saveSiteVisit(visit: SiteVisit): Promise<void> {\n  try {\n    const data = await AsyncStorage.getItem(STORAGE_KEYS.SITE_VISITS);\n    const allVisits: SiteVisit[] = data ? JSON.parse(data) : [];\n    const existingIndex = allVisits.findIndex((v) => v.id === visit.id);\n    if (existingIndex >= 0) {\n      allVisits[existingIndex] = visit;\n    } else {\n      allVisits.push(visit);\n    }\n    await AsyncStorage.setItem(STORAGE_KEYS.SITE_VISITS, JSON.stringify(allVisits));\n  } catch (error) {\n    console.error(\"Error saving site visit:\", error);\n  }\n}\n\nexport async function getAllSiteVisits(): Promise<SiteVisit[]> {\n  try {\n    const data = await AsyncStorage.getItem(STORAGE_KEYS.SITE_VISITS);\n    return data ? JSON.parse(data) : [];\n  } catch (error) {\n    console.error(\"Error loading all site visits:\", error);\n    return [];\n  }\n}\n\nexport async function getUserSettings(): Promise<UserSettings> {\n  try {\n    const data = await AsyncStorage.getItem(STORAGE_KEYS.USER_SETTINGS);\n    return data ? { ...defaultSettings, ...JSON.parse(data) } : defaultSettings;\n  } catch (error) {\n    console.error(\"Error loading user settings:\", error);\n    return defaultSettings;\n  }\n}\n\nexport async function saveUserSettings(settings: UserSettings): Promise<void> {\n  try {\n    await AsyncStorage.setItem(STORAGE_KEYS.USER_SETTINGS, JSON.stringify(settings));\n  } catch (error) {\n    console.error(\"Error saving user settings:\", error);\n  }\n}\n\nexport function calculateDistance(\n  lat1: number,\n  lon1: number,\n  lat2: number,\n  lon2: number\n): number {\n  const R = 6371;\n  const dLat = toRad(lat2 - lat1);\n  const dLon = toRad(lon2 - lon1);\n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(toRad(lat1)) *\n      Math.cos(toRad(lat2)) *\n      Math.sin(dLon / 2) *\n      Math.sin(dLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\nfunction toRad(deg: number): number {\n  return deg * (Math.PI / 180);\n}\n\nexport function calculateTotalDistance(points: GPSPoint[]): number {\n  if (points.length < 2) return 0;\n  \n  const sortedPoints = [...points].sort((a, b) => a.timestamp - b.timestamp);\n  let totalDistance = 0;\n  \n  const MAX_JUMP_KM = 10;\n  const MAX_SPEED_KMH = 200;\n  const MIN_SPEED_KMH = 1.5;\n  const MAX_ACCURACY_METERS = 30;\n  const MIN_MOVEMENT_METERS = 15;\n  \n  let lastValidPoint: GPSPoint | null = null;\n  let consecutiveMoving = 0;\n  \n  for (let i = 0; i < sortedPoints.length; i++) {\n    const curr = sortedPoints[i];\n    \n    if (curr.latitude === 0 && curr.longitude === 0) {\n      continue;\n    }\n    \n    const currAccuracy = curr.accuracy || 15;\n    if (currAccuracy > MAX_ACCURACY_METERS) {\n      continue;\n    }\n    \n    if (curr.isStationary === true) {\n      consecutiveMoving = 0;\n      continue;\n    }\n    \n    consecutiveMoving++;\n    \n    if (consecutiveMoving < 2) {\n      lastValidPoint = curr;\n      continue;\n    }\n    \n    if (!lastValidPoint) {\n      lastValidPoint = curr;\n      continue;\n    }\n    \n    const segmentDistance = calculateDistance(\n      lastValidPoint.latitude, lastValidPoint.longitude,\n      curr.latitude, curr.longitude\n    );\n    const segmentDistanceMeters = segmentDistance * 1000;\n    \n    if (segmentDistanceMeters < MIN_MOVEMENT_METERS) {\n      continue;\n    }\n    \n    if (segmentDistance >= MAX_JUMP_KM) {\n      lastValidPoint = curr;\n      continue;\n    }\n    \n    const timeDiffMs = curr.timestamp - lastValidPoint.timestamp;\n    const timeDiffHours = timeDiffMs / (1000 * 60 * 60);\n    if (timeDiffHours > 0) {\n      const speedKmh = segmentDistance / timeDiffHours;\n      if (speedKmh > MAX_SPEED_KMH || speedKmh < MIN_SPEED_KMH) {\n        continue;\n      }\n    }\n    \n    totalDistance += segmentDistance;\n    lastValidPoint = curr;\n  }\n  \n  return totalDistance;\n}\n\nexport function formatDistance(km: number, useKilometers: boolean): string {\n  if (useKilometers) {\n    return km < 1 ? `${Math.round(km * 1000)} m` : `${km.toFixed(2)} km`;\n  } else {\n    const miles = km * 0.621371;\n    return miles < 1\n      ? `${Math.round(miles * 5280)} ft`\n      : `${miles.toFixed(2)} mi`;\n  }\n}\n\nexport function formatAllowance(km: number, rate: number): string {\n  const amount = km * rate;\n  return `Rs ${amount.toFixed(2)}`;\n}\n\nexport function formatTime(timestamp: number): string {\n  const date = new Date(timestamp);\n  return date.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\n}\n\nexport function formatDate(timestamp: number): string {\n  const date = new Date(timestamp);\n  return date.toLocaleDateString([], {\n    weekday: \"short\",\n    month: \"short\",\n    day: \"numeric\",\n  });\n}\n\nexport function formatDuration(startTime: number, endTime?: number): string {\n  const end = endTime || Date.now();\n  const diff = end - startTime;\n  const hours = Math.floor(diff / (1000 * 60 * 60));\n  const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n  \n  if (hours > 0) {\n    return `${hours}h ${minutes}m`;\n  }\n  return `${minutes}m`;\n}\n\nexport function generateId(): string {\n  return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n","path":null,"size_bytes":9363,"size_tokens":null},"design_guidelines.md":{"content":"# GPS Route Tracker - Design Guidelines\n\n## Architecture Decisions\n\n### Authentication\n**No Authentication Required**\n- This is a single-user utility app for individual workers\n- Data stored locally on device\n- Include a Profile tab with:\n  - Worker avatar (generate 1 professional worker-themed preset avatar)\n  - Worker name/ID field\n  - App preferences (units: km/miles, allowance rate per km/mile)\n\n### Navigation Structure\n**Tab Navigation (4 tabs)**\n- Home (active trip tracking & today's summary)\n- History (past trips)\n- Reports (summaries & exports)\n- Profile (settings & worker info)\n\n**Core Action**: Floating Action Button (FAB) for primary trip controls\n- Position: Bottom-right corner, above tab bar\n- Dynamic states:\n  - No active trip: \"Start Trip\" (green)\n  - Active trip: \"End Trip\" (red)\n\n**Modal Screens**:\n- Site Visit Entry (slide-up modal during active trip)\n- Trip Details (full-screen from history)\n- Report Settings (full-screen from reports)\n\n---\n\n## Screen Specifications\n\n### 1. Home Screen\n**Purpose**: Display current trip status and today's statistics\n\n**Layout**:\n- Header: Custom transparent header with date and \"Today\" title\n  - Right button: Info icon (explains how distance is calculated)\n- Main content: Scrollable\n  - Top inset: headerHeight + Spacing.xl\n  - Bottom inset: tabBarHeight + Spacing.xxl (extra space for FAB)\n\n**Components**:\n1. **Stats Cards** (top section):\n   - Total Distance Today (large, prominent number with unit)\n   - Travel Allowance Earned (currency format)\n   - Cards use subtle elevation, not heavy shadows\n   \n2. **Active Trip Indicator** (when trip running):\n   - Live elapsed time\n   - Current distance this trip\n   - Pulsing location dot icon\n   - Background: subtle accent color fill\n   \n3. **Timeline View**:\n   - Vertical timeline with dots and connecting lines\n   - Events: \"Left Home\" → \"Arrived Site A\" → \"Departed Site A\" → etc.\n   - Each event shows time and optional location name\n   - Use Material Design timeline pattern\n   \n4. **Quick Actions** (when trip active):\n   - Large button: \"Record Site Arrival\"\n   - Large button: \"Record Site Departure\"\n   - Full-width, minimum 56dp height, rounded corners\n\n**FAB Specification**:\n- Size: 56dp diameter\n- Position: 16dp from right, 72dp from bottom (16dp above tab bar)\n- Shadow: shadowOffset: {width: 0, height: 2}, shadowOpacity: 0.10, shadowRadius: 2\n- Icon: Play icon (start) / Stop icon (end)\n\n### 2. History Screen\n**Purpose**: View all past trips\n\n**Layout**:\n- Header: Default navigation header with \"Trip History\" title\n  - Right button: Filter icon\n- Main content: FlatList\n  - Top inset: Spacing.xl\n  - Bottom inset: tabBarHeight + Spacing.xl\n\n**Components**:\n- Trip cards (list items):\n  - Date (prominent)\n  - Total distance\n  - Duration\n  - Number of site visits\n  - Route preview (simple line connecting start/end points on mini map if feasible, otherwise just icons)\n  - Tap to view full trip details\n  - Card style: outlined, not elevated\n\n### 3. Reports Screen\n**Purpose**: View summaries and export data\n\n**Layout**:\n- Header: Default navigation header with \"Reports\" title\n  - Right button: Share/Export icon\n- Main content: Scrollable\n  - Top inset: Spacing.xl\n  - Bottom inset: tabBarHeight + Spacing.xl\n\n**Components**:\n1. Date range selector (top)\n2. Summary metrics:\n   - Total trips\n   - Total distance\n   - Total allowance\n   - Average distance per trip\n3. Export button (full-width)\n4. Optional: Simple bar chart showing distance per day\n\n### 4. Profile Screen\n**Purpose**: Worker info and app settings\n\n**Layout**:\n- Header: Default navigation header with \"Profile\" title\n- Main content: Scrollable form\n  - Top inset: Spacing.xl\n  - Bottom inset: tabBarHeight + Spacing.xl\n\n**Components**:\n1. Avatar picker (circular, 80dp, centered at top)\n2. Form fields:\n   - Worker Name\n   - Worker ID (optional)\n3. Settings section:\n   - Unit preference (km/miles toggle)\n   - Allowance rate (number input with currency)\n   - GPS update frequency (Low/Medium/High)\n4. App info footer\n\n### 5. Site Visit Modal\n**Purpose**: Quick entry for site arrival/departure\n\n**Layout**:\n- Modal slide-up from bottom (70% screen height)\n- Header: \"Record Site Visit\" with close button\n- Main content: Form\n  - Bottom submit button\n\n**Components**:\n- Auto-captured: Time, GPS coordinates\n- User inputs:\n  - Site name (text input)\n  - Notes (multiline text input, optional)\n- Large \"Save\" button at bottom\n\n---\n\n## Design System\n\n### Color Palette\n**Primary**: \n- Green (#4CAF50) - for active/start actions\n- Dark Green (#388E3C) - pressed state\n\n**Secondary**: \n- Red (#F44336) - for end/stop actions\n- Dark Red (#D32F2F) - pressed state\n\n**Neutral**:\n- Background: #FAFAFA (light gray)\n- Card background: #FFFFFF\n- Text primary: #212121\n- Text secondary: #757575\n- Dividers: #E0E0E0\n\n**Accent**:\n- Blue (#2196F3) - for info, links\n- Light Blue (#E3F2FD) - for active trip background\n\n### Typography\n- **Headline**: 32sp, bold (today's distance)\n- **Title**: 20sp, medium (screen titles)\n- **Body**: 16sp, regular (main text)\n- **Caption**: 14sp, regular (timestamps, labels)\n- **Button Text**: 16sp, medium, uppercase\n\n### Spacing Scale\n- xs: 4dp\n- sm: 8dp\n- md: 16dp\n- lg: 24dp\n- xl: 32dp\n- xxl: 48dp\n\n### Component Specifications\n\n**Cards**:\n- Padding: Spacing.md\n- Border radius: 8dp\n- Border: 1dp solid #E0E0E0\n- NO drop shadow (use outline style)\n\n**Buttons**:\n- Height: 56dp minimum (extra large for worker-friendly tapping)\n- Border radius: 8dp\n- Pressed state: Darken by 10%, scale to 0.98\n- Disabled state: Opacity 0.5\n\n**Timeline Dots**:\n- Size: 16dp diameter\n- Connecting line: 2dp width\n- Active dot: Filled circle\n- Past dots: Outlined circle\n\n**FAB**:\n- Exactly as specified above in Home Screen section\n\n---\n\n## Interaction Design\n\n### Trip Flow\n1. User taps FAB \"Start Trip\" → Immediate GPS capture → FAB changes to \"End Trip\" → Timeline shows \"Left Home\"\n2. During trip: \"Record Site Arrival\" button appears → Opens modal → Save → Timeline updates\n3. User taps FAB \"End Trip\" → Confirmation dialog → Calculate final distance → Show summary toast\n\n### Visual Feedback\n- All buttons: Ripple effect on press (Android standard)\n- FAB: Scale animation on press\n- Active trip indicator: Subtle pulse animation (1.5s cycle)\n- GPS logging: Small dot icon blinks every 5 seconds\n\n### Loading States\n- Distance calculation: Show shimmer on stats cards\n- GPS acquiring: \"Acquiring GPS...\" text with spinner\n- Background tracking: Persistent notification (system design)\n\n---\n\n## Accessibility\n\n### Requirements\n- All touchable elements: Minimum 48dp x 48dp\n- Color contrast ratio: 4.5:1 for text\n- FAB and action buttons: Content descriptions for screen readers\n- Timeline events: Semantic grouping for TalkBack\n- Form inputs: Proper labels and hints\n- Distance/time values: Announce updates to screen readers when changed\n\n---\n\n## Critical Assets\n\n**Generate**:\n1. Worker avatar (1 preset) - Illustration style, professional worker with safety vest/hardhat, friendly, neutral expression\n\n**System Icons** (use Material Icons):\n- play_arrow (start trip)\n- stop (end trip)\n- location_on (site markers)\n- timeline (timeline view)\n- history (trip history)\n- assessment (reports)\n- person (profile)\n- info (information)\n- filter_list (filter)\n- share (export)\n\nNo custom imagery needed beyond the worker avatar. Keep UI clean and functional.","path":null,"size_bytes":7399,"size_tokens":null},"eslint.config.js":{"content":"// https://docs.expo.dev/guides/using-eslint/\nconst { defineConfig } = require(\"eslint/config\");\nconst expoConfig = require(\"eslint-config-expo/flat\");\nconst eslintPluginPrettierRecommended = require(\"eslint-plugin-prettier/recommended\");\n\nmodule.exports = defineConfig([\n  expoConfig,\n  eslintPluginPrettierRecommended,\n  {\n    ignores: [\"dist/*\"],\n  },\n]);\n","path":null,"size_bytes":359,"size_tokens":null},"components/ScreenKeyboardAwareScrollView.tsx":{"content":"import { Platform, StyleSheet } from \"react-native\";\nimport {\n  KeyboardAwareScrollView,\n  KeyboardAwareScrollViewProps,\n} from \"react-native-keyboard-controller\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useScreenInsets } from \"@/hooks/useScreenInsets\";\nimport { Spacing } from \"@/constants/theme\";\nimport { ScreenScrollView } from \"./ScreenScrollView\";\n\nexport function ScreenKeyboardAwareScrollView({\n  children,\n  contentContainerStyle,\n  style,\n  keyboardShouldPersistTaps = \"handled\",\n  ...scrollViewProps\n}: KeyboardAwareScrollViewProps) {\n  const { theme } = useTheme();\n  const { paddingTop, paddingBottom, scrollInsetBottom } = useScreenInsets();\n\n  if (Platform.OS === \"web\") {\n    return (\n      <ScreenScrollView\n        style={style}\n        contentContainerStyle={contentContainerStyle}\n        keyboardShouldPersistTaps={keyboardShouldPersistTaps}\n        {...scrollViewProps}\n      >\n        {children}\n      </ScreenScrollView>\n    );\n  }\n\n  return (\n    <KeyboardAwareScrollView\n      style={[\n        styles.container,\n        { backgroundColor: theme.backgroundRoot },\n        style,\n      ]}\n      contentContainerStyle={[\n        {\n          paddingTop,\n          paddingBottom,\n        },\n        styles.contentContainer,\n        contentContainerStyle,\n      ]}\n      scrollIndicatorInsets={{ bottom: scrollInsetBottom }}\n      keyboardShouldPersistTaps={keyboardShouldPersistTaps}\n      {...scrollViewProps}\n    >\n      {children}\n    </KeyboardAwareScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  contentContainer: {\n    paddingHorizontal: Spacing.xl,\n  },\n});\n","path":null,"size_bytes":1643,"size_tokens":null},"components/SettingsItem.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, View, Pressable, Switch } from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, AppColors } from \"@/constants/theme\";\n\ninterface SettingsItemProps {\n  icon: keyof typeof Feather.glyphMap;\n  title: string;\n  subtitle?: string;\n  value?: string;\n  onPress?: () => void;\n  switchValue?: boolean;\n  onSwitchChange?: (value: boolean) => void;\n  showChevron?: boolean;\n}\n\nexport function SettingsItem({\n  icon,\n  title,\n  subtitle,\n  value,\n  onPress,\n  switchValue,\n  onSwitchChange,\n  showChevron = false,\n}: SettingsItemProps) {\n  const { theme } = useTheme();\n\n  const content = (\n    <View style={[styles.container, { borderBottomColor: theme.backgroundSecondary }]}>\n      <View style={[styles.iconContainer, { backgroundColor: theme.backgroundSecondary }]}>\n        <Feather name={icon} size={18} color={theme.text} />\n      </View>\n      <View style={styles.content}>\n        <ThemedText type=\"body\" style={styles.title}>\n          {title}\n        </ThemedText>\n        {subtitle ? (\n          <ThemedText\n            type=\"small\"\n            style={[styles.subtitle, { color: theme.textSecondary }]}\n          >\n            {subtitle}\n          </ThemedText>\n        ) : null}\n      </View>\n      {value ? (\n        <ThemedText\n          type=\"body\"\n          style={[styles.value, { color: theme.textSecondary }]}\n        >\n          {value}\n        </ThemedText>\n      ) : null}\n      {onSwitchChange !== undefined ? (\n        <Switch\n          value={switchValue}\n          onValueChange={onSwitchChange}\n          trackColor={{ false: theme.backgroundSecondary, true: AppColors.primary }}\n          thumbColor=\"#FFFFFF\"\n        />\n      ) : null}\n      {showChevron ? (\n        <Feather name=\"chevron-right\" size={20} color={theme.textSecondary} />\n      ) : null}\n    </View>\n  );\n\n  if (onPress) {\n    return (\n      <Pressable\n        onPress={onPress}\n        style={({ pressed }) => [{ opacity: pressed ? 0.7 : 1 }]}\n      >\n        {content}\n      </Pressable>\n    );\n  }\n\n  return content;\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    paddingVertical: Spacing.md,\n    borderBottomWidth: 1,\n  },\n  iconContainer: {\n    width: 36,\n    height: 36,\n    borderRadius: 8,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.md,\n  },\n  content: {\n    flex: 1,\n  },\n  title: {\n    fontWeight: \"500\",\n  },\n  subtitle: {\n    marginTop: 2,\n  },\n  value: {\n    marginRight: Spacing.sm,\n  },\n});\n","path":null,"size_bytes":2669,"size_tokens":null},"hooks/useTheme.ts":{"content":"import { Colors } from \"@/constants/theme\";\nimport { useColorScheme } from \"@/hooks/useColorScheme\";\n\nexport function useTheme() {\n  const colorScheme = useColorScheme();\n  const isDark = colorScheme === \"dark\";\n  const theme = Colors[colorScheme ?? \"light\"];\n\n  return {\n    theme,\n    isDark,\n  };\n}\n","path":null,"size_bytes":302,"size_tokens":null},"components/Button.tsx":{"content":"import React, { ReactNode } from \"react\";\nimport { StyleSheet, Pressable, ViewStyle, StyleProp } from \"react-native\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { BorderRadius, Spacing } from \"@/constants/theme\";\n\ninterface ButtonProps {\n  onPress?: () => void;\n  children: ReactNode;\n  style?: StyleProp<ViewStyle>;\n  disabled?: boolean;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function Button({\n  onPress,\n  children,\n  style,\n  disabled = false,\n}: ButtonProps) {\n  const { theme } = useTheme();\n  const scale = useSharedValue(1);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    if (!disabled) {\n      scale.value = withSpring(0.98, springConfig);\n    }\n  };\n\n  const handlePressOut = () => {\n    if (!disabled) {\n      scale.value = withSpring(1, springConfig);\n    }\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={disabled ? undefined : onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      disabled={disabled}\n      style={[\n        styles.button,\n        {\n          backgroundColor: theme.link,\n          opacity: disabled ? 0.5 : 1,\n        },\n        style,\n        animatedStyle,\n      ]}\n    >\n      <ThemedText\n        type=\"body\"\n        style={[styles.buttonText, { color: theme.buttonText }]}\n      >\n        {children}\n      </ThemedText>\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  button: {\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.full,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  buttonText: {\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":2014,"size_tokens":null},"components/ErrorBoundary.tsx":{"content":"import React, { Component, ComponentType, PropsWithChildren } from \"react\";\nimport { ErrorFallback, ErrorFallbackProps } from \"@/components/ErrorFallback\";\n\nexport type ErrorBoundaryProps = PropsWithChildren<{\n  FallbackComponent?: ComponentType<ErrorFallbackProps>;\n  onError?: (error: Error, stackTrace: string) => void;\n}>;\n\ntype ErrorBoundaryState = { error: Error | null };\n\n/**\n * This is a special case for for using the class components. Error boundaries must be class components because React only provides error boundary functionality through lifecycle methods (componentDidCatch and getDerivedStateFromError) which are not available in functional components.\n * https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary\n */\n\nexport class ErrorBoundary extends Component<\n  ErrorBoundaryProps,\n  ErrorBoundaryState\n> {\n  state: ErrorBoundaryState = { error: null };\n\n  static defaultProps: {\n    FallbackComponent: ComponentType<ErrorFallbackProps>;\n  } = {\n    FallbackComponent: ErrorFallback,\n  };\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { error };\n  }\n\n  componentDidCatch(error: Error, info: { componentStack: string }): void {\n    if (typeof this.props.onError === \"function\") {\n      this.props.onError(error, info.componentStack);\n    }\n  }\n\n  resetError = (): void => {\n    this.setState({ error: null });\n  };\n\n  render() {\n    const { FallbackComponent } = this.props;\n\n    return this.state.error && FallbackComponent ? (\n      <FallbackComponent\n        error={this.state.error}\n        resetError={this.resetError}\n      />\n    ) : (\n      this.props.children\n    );\n  }\n}\n","path":null,"size_bytes":1674,"size_tokens":null},"navigation/HomeStackNavigator.tsx":{"content":"import React from \"react\";\nimport { createNativeStackNavigator } from \"@react-navigation/native-stack\";\nimport HomeScreen from \"@/screens/HomeScreen\";\nimport TripDetailsScreen from \"@/screens/TripDetailsScreen\";\nimport SiteVisitModal from \"@/screens/SiteVisitModal\";\nimport { HeaderTitle } from \"@/components/HeaderTitle\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { getCommonScreenOptions } from \"@/navigation/screenOptions\";\n\nexport type HomeStackParamList = {\n  Home: undefined;\n  TripDetails: { tripId: string };\n  SiteVisit: { mode: \"arrival\" | \"departure\"; visitId?: string };\n};\n\nconst Stack = createNativeStackNavigator<HomeStackParamList>();\n\nexport default function HomeStackNavigator() {\n  const { theme, isDark } = useTheme();\n\n  return (\n    <Stack.Navigator\n      screenOptions={{\n        ...getCommonScreenOptions({ theme, isDark }),\n      }}\n    >\n      <Stack.Screen\n        name=\"Home\"\n        component={HomeScreen}\n        options={{\n          headerTitle: () => <HeaderTitle title=\"RouteTracker\" />,\n        }}\n      />\n      <Stack.Screen\n        name=\"TripDetails\"\n        component={TripDetailsScreen}\n        options={{ headerTitle: \"Trip Details\" }}\n      />\n      <Stack.Screen\n        name=\"SiteVisit\"\n        component={SiteVisitModal}\n        options={{\n          headerTitle: \"Record Site Visit\",\n          presentation: \"modal\",\n        }}\n      />\n    </Stack.Navigator>\n  );\n}\n","path":null,"size_bytes":1421,"size_tokens":null},"components/Spacer.tsx":{"content":"import { View } from \"react-native\";\n\ntype Props = {\n  width?: number;\n  height?: number;\n};\n\nexport default function Spacer(props: Props) {\n  const width: number = props.width ?? 1;\n  const height: number = props.height ?? 1;\n\n  return (\n    <View\n      style={{\n        width,\n        height,\n      }}\n    />\n  );\n}\n","path":null,"size_bytes":318,"size_tokens":null},"components/ActionButton.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, Pressable, ViewStyle, StyleProp } from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\n\ninterface ActionButtonProps {\n  title: string;\n  icon: keyof typeof Feather.glyphMap;\n  onPress: () => void;\n  variant?: \"primary\" | \"secondary\" | \"outline\";\n  style?: StyleProp<ViewStyle>;\n  disabled?: boolean;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function ActionButton({\n  title,\n  icon,\n  onPress,\n  variant = \"primary\",\n  style,\n  disabled = false,\n}: ActionButtonProps) {\n  const { theme } = useTheme();\n  const scale = useSharedValue(1);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    if (!disabled) {\n      scale.value = withSpring(0.98, springConfig);\n    }\n  };\n\n  const handlePressOut = () => {\n    if (!disabled) {\n      scale.value = withSpring(1, springConfig);\n    }\n  };\n\n  const getBackgroundColor = () => {\n    switch (variant) {\n      case \"primary\":\n        return AppColors.primary;\n      case \"secondary\":\n        return AppColors.accent;\n      case \"outline\":\n        return \"transparent\";\n    }\n  };\n\n  const getTextColor = () => {\n    switch (variant) {\n      case \"outline\":\n        return theme.text;\n      default:\n        return \"#FFFFFF\";\n    }\n  };\n\n  const getBorderColor = () => {\n    switch (variant) {\n      case \"outline\":\n        return theme.backgroundSecondary;\n      default:\n        return \"transparent\";\n    }\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={disabled ? undefined : onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      disabled={disabled}\n      style={[\n        styles.button,\n        {\n          backgroundColor: getBackgroundColor(),\n          borderColor: getBorderColor(),\n          opacity: disabled ? 0.5 : 1,\n        },\n        style,\n        animatedStyle,\n      ]}\n    >\n      <Feather name={icon} size={20} color={getTextColor()} />\n      <ThemedText\n        type=\"body\"\n        style={[styles.buttonText, { color: getTextColor() }]}\n      >\n        {title}\n      </ThemedText>\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  button: {\n    flexDirection: \"row\",\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    gap: Spacing.sm,\n    borderWidth: 1,\n  },\n  buttonText: {\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":2927,"size_tokens":null},"hooks/useColorScheme.web.ts":{"content":"import { useEffect, useState } from \"react\";\nimport { useColorScheme as useRNColorScheme } from \"react-native\";\n\n/**\n * To support static rendering, this value needs to be re-calculated on the client side for web\n */\nexport function useColorScheme() {\n  const [hasHydrated, setHasHydrated] = useState(false);\n\n  useEffect(() => {\n    setHasHydrated(true);\n  }, []);\n\n  const colorScheme = useRNColorScheme();\n\n  if (hasHydrated) {\n    return colorScheme;\n  }\n\n  return \"light\";\n}\n","path":null,"size_bytes":480,"size_tokens":null},"navigation/HistoryStackNavigator.tsx":{"content":"import React from \"react\";\nimport { createNativeStackNavigator } from \"@react-navigation/native-stack\";\nimport HistoryScreen from \"@/screens/HistoryScreen\";\nimport TripDetailsScreen from \"@/screens/TripDetailsScreen\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { getCommonScreenOptions } from \"@/navigation/screenOptions\";\n\nexport type HistoryStackParamList = {\n  History: undefined;\n  TripDetails: { tripId: string };\n};\n\nconst Stack = createNativeStackNavigator<HistoryStackParamList>();\n\nexport default function HistoryStackNavigator() {\n  const { theme, isDark } = useTheme();\n\n  return (\n    <Stack.Navigator screenOptions={getCommonScreenOptions({ theme, isDark })}>\n      <Stack.Screen\n        name=\"History\"\n        component={HistoryScreen}\n        options={{\n          title: \"Trip History\",\n        }}\n      />\n      <Stack.Screen\n        name=\"TripDetails\"\n        component={TripDetailsScreen}\n        options={{ headerTitle: \"Trip Details\" }}\n      />\n    </Stack.Navigator>\n  );\n}\n","path":null,"size_bytes":1005,"size_tokens":null},"navigation/MainTabNavigator.tsx":{"content":"import React from \"react\";\nimport { createBottomTabNavigator } from \"@react-navigation/bottom-tabs\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { BlurView } from \"expo-blur\";\nimport { Platform, StyleSheet } from \"react-native\";\nimport HomeStackNavigator from \"@/navigation/HomeStackNavigator\";\nimport HistoryStackNavigator from \"@/navigation/HistoryStackNavigator\";\nimport ReportsStackNavigator from \"@/navigation/ReportsStackNavigator\";\nimport ProfileStackNavigator from \"@/navigation/ProfileStackNavigator\";\nimport { useTheme } from \"@/hooks/useTheme\";\n\nexport type MainTabParamList = {\n  HomeTab: undefined;\n  HistoryTab: undefined;\n  ReportsTab: undefined;\n  ProfileTab: undefined;\n};\n\nconst Tab = createBottomTabNavigator<MainTabParamList>();\n\nexport default function MainTabNavigator() {\n  const { theme, isDark } = useTheme();\n\n  return (\n    <Tab.Navigator\n      initialRouteName=\"HomeTab\"\n      screenOptions={{\n        tabBarActiveTintColor: theme.tabIconSelected,\n        tabBarInactiveTintColor: theme.tabIconDefault,\n        tabBarStyle: {\n          position: \"absolute\",\n          backgroundColor: Platform.select({\n            ios: \"transparent\",\n            android: theme.backgroundRoot,\n          }),\n          borderTopWidth: 0,\n          elevation: 0,\n        },\n        tabBarBackground: () =>\n          Platform.OS === \"ios\" ? (\n            <BlurView\n              intensity={100}\n              tint={isDark ? \"dark\" : \"light\"}\n              style={StyleSheet.absoluteFill}\n            />\n          ) : null,\n        headerShown: false,\n      }}\n    >\n      <Tab.Screen\n        name=\"HomeTab\"\n        component={HomeStackNavigator}\n        options={{\n          title: \"Today\",\n          tabBarIcon: ({ color, size }) => (\n            <Feather name=\"home\" size={size} color={color} />\n          ),\n        }}\n      />\n      <Tab.Screen\n        name=\"HistoryTab\"\n        component={HistoryStackNavigator}\n        options={{\n          title: \"History\",\n          tabBarIcon: ({ color, size }) => (\n            <Feather name=\"clock\" size={size} color={color} />\n          ),\n        }}\n      />\n      <Tab.Screen\n        name=\"ReportsTab\"\n        component={ReportsStackNavigator}\n        options={{\n          title: \"Reports\",\n          tabBarIcon: ({ color, size }) => (\n            <Feather name=\"bar-chart-2\" size={size} color={color} />\n          ),\n        }}\n      />\n      <Tab.Screen\n        name=\"ProfileTab\"\n        component={ProfileStackNavigator}\n        options={{\n          title: \"Profile\",\n          tabBarIcon: ({ color, size }) => (\n            <Feather name=\"user\" size={size} color={color} />\n          ),\n        }}\n      />\n    </Tab.Navigator>\n  );\n}\n","path":null,"size_bytes":2704,"size_tokens":null},"components/ScreenFlatList.tsx":{"content":"import React from \"react\";\nimport { FlatList, FlatListProps, StyleSheet } from \"react-native\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useScreenInsets } from \"@/hooks/useScreenInsets\";\nimport { Spacing } from \"@/constants/theme\";\n\nexport function ScreenFlatList<T>({\n  contentContainerStyle,\n  style,\n  ...flatListProps\n}: FlatListProps<T>) {\n  const { theme } = useTheme();\n  const { paddingTop, paddingBottom, scrollInsetBottom } = useScreenInsets();\n\n  return (\n    <FlatList\n      style={[\n        styles.container,\n        { backgroundColor: theme.backgroundRoot },\n        style,\n      ]}\n      contentContainerStyle={[\n        {\n          paddingTop,\n          paddingBottom,\n        },\n        styles.contentContainer,\n        contentContainerStyle,\n      ]}\n      scrollIndicatorInsets={{ bottom: scrollInsetBottom }}\n      {...flatListProps}\n    />\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  contentContainer: {\n    paddingHorizontal: Spacing.xl,\n  },\n});\n","path":null,"size_bytes":1016,"size_tokens":null},"screens/SiteVisitModal.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  StyleSheet,\n  View,\n  TextInput,\n  Alert,\n  Pressable,\n  Platform,\n  ScrollView,\n} from \"react-native\";\nimport { NativeStackScreenProps } from \"@react-navigation/native-stack\";\nimport * as Haptics from \"expo-haptics\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport { Image } from \"expo-image\";\nimport { Feather } from \"@expo/vector-icons\";\n\nimport { ScreenKeyboardAwareScrollView } from \"@/components/ScreenKeyboardAwareScrollView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useTripContext } from \"@/context/TripContext\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\nimport { HomeStackParamList } from \"@/navigation/HomeStackNavigator\";\n\ntype SiteVisitModalProps = NativeStackScreenProps<\n  HomeStackParamList,\n  \"SiteVisit\"\n>;\n\nconst STATUS_OPTIONS = [\"Pending\", \"In Progress\", \"Resolved\", \"Live\", \"Closed\"];\n\nexport default function SiteVisitModal({\n  navigation,\n  route,\n}: SiteVisitModalProps) {\n  const { theme } = useTheme();\n  const { recordSiteArrival } = useTripContext();\n  const { mode } = route.params;\n\n  const [schemeName, setSchemeName] = useState(\"\");\n  const [schemeNumber, setSchemeNumber] = useState(\"\");\n  const [esrDetails, setEsrDetails] = useState(\"\");\n  const [village, setVillage] = useState(\"\");\n  const [issueReported, setIssueReported] = useState(\"\");\n  const [resolution, setResolution] = useState(\"\");\n  const [currentStatus, setCurrentStatus] = useState(\"\");\n  const [notes, setNotes] = useState(\"\");\n  const [photoUri, setPhotoUri] = useState<string | undefined>();\n  const [isSaving, setIsSaving] = useState(false);\n  const [showStatusPicker, setShowStatusPicker] = useState(false);\n\n  const handleTakePhoto = async () => {\n    if (Platform.OS === \"web\") {\n      Alert.alert(\n        \"Not Available\",\n        \"Camera is available on mobile devices via Expo Go.\"\n      );\n      return;\n    }\n\n    const permissionResult = await ImagePicker.requestCameraPermissionsAsync();\n    if (!permissionResult.granted) {\n      if (!permissionResult.canAskAgain) {\n        Alert.alert(\n          \"Permission Required\",\n          \"Camera access is required. Please enable it in Settings.\",\n          [\n            { text: \"Cancel\", style: \"cancel\" },\n            {\n              text: \"Open Settings\",\n              onPress: async () => {\n                try {\n                  const { Linking } = await import(\"expo-linking\");\n                  await Linking.openSettings();\n                } catch {\n                  Alert.alert(\"Error\", \"Unable to open Settings.\");\n                }\n              },\n            },\n          ]\n        );\n      } else {\n        Alert.alert(\n          \"Permission Denied\",\n          \"Camera permission is required to take photos.\"\n        );\n      }\n      return;\n    }\n\n    const result = await ImagePicker.launchCameraAsync({\n      mediaTypes: [\"images\"],\n      allowsEditing: true,\n      aspect: [4, 3],\n      quality: 0.8,\n    });\n\n    if (!result.canceled && result.assets && result.assets.length > 0) {\n      setPhotoUri(result.assets[0].uri);\n      await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n  };\n\n  const handleChoosePhoto = async () => {\n    if (Platform.OS === \"web\") {\n      Alert.alert(\n        \"Not Available\",\n        \"Photo gallery is available on mobile devices via Expo Go.\"\n      );\n      return;\n    }\n\n    const permissionResult =\n      await ImagePicker.requestMediaLibraryPermissionsAsync();\n    if (!permissionResult.granted) {\n      if (!permissionResult.canAskAgain) {\n        Alert.alert(\n          \"Permission Required\",\n          \"Photo library access is required. Please enable it in Settings.\",\n          [\n            { text: \"Cancel\", style: \"cancel\" },\n            {\n              text: \"Open Settings\",\n              onPress: async () => {\n                try {\n                  const { Linking } = await import(\"expo-linking\");\n                  await Linking.openSettings();\n                } catch {\n                  Alert.alert(\"Error\", \"Unable to open Settings.\");\n                }\n              },\n            },\n          ]\n        );\n      } else {\n        Alert.alert(\n          \"Permission Denied\",\n          \"Photo library permission is required to select photos.\"\n        );\n      }\n      return;\n    }\n\n    const result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: [\"images\"],\n      allowsEditing: true,\n      aspect: [4, 3],\n      quality: 0.8,\n    });\n\n    if (!result.canceled && result.assets && result.assets.length > 0) {\n      setPhotoUri(result.assets[0].uri);\n      await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n  };\n\n  const handleRemovePhoto = () => {\n    setPhotoUri(undefined);\n  };\n\n  const handleSave = async () => {\n    if (!schemeName.trim()) {\n      Alert.alert(\"Error\", \"Please enter the Scheme Name.\");\n      return;\n    }\n\n    if (!village.trim()) {\n      Alert.alert(\"Error\", \"Please enter the Village name.\");\n      return;\n    }\n\n    setIsSaving(true);\n    try {\n      await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n      await recordSiteArrival(\n        schemeName.trim(),\n        notes.trim() || undefined,\n        photoUri,\n        {\n          schemeName: schemeName.trim(),\n          schemeNumber: schemeNumber.trim() || undefined,\n          esrDetails: esrDetails.trim() || undefined,\n          village: village.trim(),\n          issueReported: issueReported.trim() || undefined,\n          resolution: resolution.trim() || undefined,\n          currentStatus: currentStatus || undefined,\n        }\n      );\n      navigation.goBack();\n    } catch (error) {\n      Alert.alert(\"Error\", \"Failed to record site visit. Please try again.\");\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const selectStatus = (status: string) => {\n    setCurrentStatus(status);\n    setShowStatusPicker(false);\n  };\n\n  return (\n    <ScreenKeyboardAwareScrollView showsVerticalScrollIndicator={false}>\n      <View style={styles.infoContainer}>\n        <ThemedText\n          type=\"small\"\n          style={[styles.infoText, { color: theme.textSecondary }]}\n        >\n          Your current time and GPS location will be automatically recorded.\n        </ThemedText>\n      </View>\n\n      <View style={styles.inputContainer}>\n        <ThemedText type=\"body\" style={styles.inputLabel}>\n          Scheme Name <ThemedText style={styles.required}>*</ThemedText>\n        </ThemedText>\n        <TextInput\n          style={[\n            styles.input,\n            {\n              backgroundColor: theme.backgroundDefault,\n              color: theme.text,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n          value={schemeName}\n          onChangeText={setSchemeName}\n          placeholder=\"e.g., Jal Jeevan Mission\"\n          placeholderTextColor={theme.textSecondary}\n          autoFocus\n        />\n      </View>\n\n      <View style={styles.inputContainer}>\n        <ThemedText type=\"body\" style={styles.inputLabel}>\n          Scheme Number\n        </ThemedText>\n        <TextInput\n          style={[\n            styles.input,\n            {\n              backgroundColor: theme.backgroundDefault,\n              color: theme.text,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n          value={schemeNumber}\n          onChangeText={setSchemeNumber}\n          placeholder=\"e.g., 11111111\"\n          placeholderTextColor={theme.textSecondary}\n          keyboardType=\"default\"\n        />\n      </View>\n\n      <View style={styles.inputContainer}>\n        <ThemedText type=\"body\" style={styles.inputLabel}>\n          ESR Details\n        </ThemedText>\n        <TextInput\n          style={[\n            styles.input,\n            {\n              backgroundColor: theme.backgroundDefault,\n              color: theme.text,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n          value={esrDetails}\n          onChangeText={setEsrDetails}\n          placeholder=\"e.g., Existing 5.5 LL\"\n          placeholderTextColor={theme.textSecondary}\n        />\n      </View>\n\n      <View style={styles.inputContainer}>\n        <ThemedText type=\"body\" style={styles.inputLabel}>\n          Village <ThemedText style={styles.required}>*</ThemedText>\n        </ThemedText>\n        <TextInput\n          style={[\n            styles.input,\n            {\n              backgroundColor: theme.backgroundDefault,\n              color: theme.text,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n          value={village}\n          onChangeText={setVillage}\n          placeholder=\"e.g., Saoner\"\n          placeholderTextColor={theme.textSecondary}\n        />\n      </View>\n\n      <View style={styles.inputContainer}>\n        <ThemedText type=\"body\" style={styles.inputLabel}>\n          Issue Reported\n        </ThemedText>\n        <TextInput\n          style={[\n            styles.textArea,\n            {\n              backgroundColor: theme.backgroundDefault,\n              color: theme.text,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n          value={issueReported}\n          onChangeText={setIssueReported}\n          placeholder=\"e.g., Flow Meter Not Connected\"\n          placeholderTextColor={theme.textSecondary}\n          multiline\n          numberOfLines={2}\n          textAlignVertical=\"top\"\n        />\n      </View>\n\n      <View style={styles.inputContainer}>\n        <ThemedText type=\"body\" style={styles.inputLabel}>\n          Resolution\n        </ThemedText>\n        <TextInput\n          style={[\n            styles.textArea,\n            {\n              backgroundColor: theme.backgroundDefault,\n              color: theme.text,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n          value={resolution}\n          onChangeText={setResolution}\n          placeholder=\"e.g., Restart Modem\"\n          placeholderTextColor={theme.textSecondary}\n          multiline\n          numberOfLines={2}\n          textAlignVertical=\"top\"\n        />\n      </View>\n\n      <View style={styles.inputContainer}>\n        <ThemedText type=\"body\" style={styles.inputLabel}>\n          Current Status\n        </ThemedText>\n        <Pressable\n          onPress={() => setShowStatusPicker(!showStatusPicker)}\n          style={[\n            styles.statusSelector,\n            {\n              backgroundColor: theme.backgroundDefault,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n        >\n          <ThemedText\n            type=\"body\"\n            style={{ color: currentStatus ? theme.text : theme.textSecondary }}\n          >\n            {currentStatus || \"Select Status\"}\n          </ThemedText>\n          <Feather\n            name={showStatusPicker ? \"chevron-up\" : \"chevron-down\"}\n            size={20}\n            color={theme.textSecondary}\n          />\n        </Pressable>\n        {showStatusPicker ? (\n          <View\n            style={[\n              styles.statusOptions,\n              {\n                backgroundColor: theme.backgroundDefault,\n                borderColor: theme.backgroundSecondary,\n              },\n            ]}\n          >\n            {STATUS_OPTIONS.map((status) => (\n              <Pressable\n                key={status}\n                onPress={() => selectStatus(status)}\n                style={({ pressed }) => [\n                  styles.statusOption,\n                  {\n                    backgroundColor: pressed\n                      ? theme.backgroundSecondary\n                      : \"transparent\",\n                  },\n                ]}\n              >\n                <ThemedText type=\"body\">{status}</ThemedText>\n                {currentStatus === status ? (\n                  <Feather name=\"check\" size={18} color={AppColors.primary} />\n                ) : null}\n              </Pressable>\n            ))}\n          </View>\n        ) : null}\n      </View>\n\n      <View style={styles.inputContainer}>\n        <ThemedText type=\"body\" style={styles.inputLabel}>\n          Additional Notes (Optional)\n        </ThemedText>\n        <TextInput\n          style={[\n            styles.textArea,\n            {\n              backgroundColor: theme.backgroundDefault,\n              color: theme.text,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n          value={notes}\n          onChangeText={setNotes}\n          placeholder=\"Add any additional notes about this site visit...\"\n          placeholderTextColor={theme.textSecondary}\n          multiline\n          numberOfLines={3}\n          textAlignVertical=\"top\"\n        />\n      </View>\n\n      <View style={styles.inputContainer}>\n        <ThemedText type=\"body\" style={styles.inputLabel}>\n          Photo (Optional)\n        </ThemedText>\n        {photoUri ? (\n          <View style={styles.photoPreviewContainer}>\n            <Image\n              source={{ uri: photoUri }}\n              style={styles.photoPreview}\n              contentFit=\"cover\"\n            />\n            <Pressable\n              onPress={handleRemovePhoto}\n              style={[\n                styles.removePhotoButton,\n                { backgroundColor: AppColors.error },\n              ]}\n            >\n              <Feather name=\"x\" size={16} color=\"#FFFFFF\" />\n            </Pressable>\n          </View>\n        ) : (\n          <View style={styles.photoButtonsContainer}>\n            <Pressable\n              onPress={handleTakePhoto}\n              style={({ pressed }) => [\n                styles.photoButton,\n                {\n                  backgroundColor: theme.backgroundDefault,\n                  borderColor: theme.backgroundSecondary,\n                  opacity: pressed ? 0.8 : 1,\n                },\n              ]}\n            >\n              <Feather name=\"camera\" size={24} color={AppColors.primary} />\n              <ThemedText\n                type=\"small\"\n                style={[styles.photoButtonText, { color: theme.text }]}\n              >\n                Take Photo\n              </ThemedText>\n            </Pressable>\n            <Pressable\n              onPress={handleChoosePhoto}\n              style={({ pressed }) => [\n                styles.photoButton,\n                {\n                  backgroundColor: theme.backgroundDefault,\n                  borderColor: theme.backgroundSecondary,\n                  opacity: pressed ? 0.8 : 1,\n                },\n              ]}\n            >\n              <Feather name=\"image\" size={24} color={AppColors.primary} />\n              <ThemedText\n                type=\"small\"\n                style={[styles.photoButtonText, { color: theme.text }]}\n              >\n                Choose Photo\n              </ThemedText>\n            </Pressable>\n          </View>\n        )}\n      </View>\n\n      <Pressable\n        onPress={handleSave}\n        disabled={isSaving}\n        style={({ pressed }) => [\n          styles.saveButton,\n          {\n            backgroundColor: AppColors.primary,\n            opacity: pressed || isSaving ? 0.8 : 1,\n          },\n        ]}\n      >\n        <ThemedText\n          type=\"body\"\n          style={[styles.saveButtonText, { color: \"#FFFFFF\" }]}\n        >\n          {isSaving ? \"Saving...\" : \"Save Site Visit\"}\n        </ThemedText>\n      </Pressable>\n    </ScreenKeyboardAwareScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  infoContainer: {\n    marginBottom: Spacing.lg,\n  },\n  infoText: {\n    textAlign: \"center\",\n  },\n  inputContainer: {\n    marginBottom: Spacing.md,\n  },\n  inputLabel: {\n    marginBottom: Spacing.sm,\n    fontWeight: \"500\",\n  },\n  required: {\n    color: AppColors.secondary,\n  },\n  input: {\n    height: Spacing.inputHeight,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.md,\n    fontSize: 16,\n    borderWidth: 1,\n  },\n  textArea: {\n    minHeight: 70,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.md,\n    fontSize: 16,\n    borderWidth: 1,\n  },\n  statusSelector: {\n    height: Spacing.inputHeight,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.md,\n    fontSize: 16,\n    borderWidth: 1,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n  statusOptions: {\n    marginTop: Spacing.xs,\n    borderRadius: BorderRadius.sm,\n    borderWidth: 1,\n    overflow: \"hidden\",\n  },\n  statusOption: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    paddingHorizontal: Spacing.md,\n    paddingVertical: Spacing.sm,\n  },\n  photoButtonsContainer: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  photoButton: {\n    flex: 1,\n    height: 80,\n    borderRadius: BorderRadius.sm,\n    borderWidth: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    gap: Spacing.xs,\n  },\n  photoButtonText: {\n    fontWeight: \"500\",\n  },\n  photoPreviewContainer: {\n    position: \"relative\",\n    width: \"100%\",\n    height: 200,\n    borderRadius: BorderRadius.sm,\n    overflow: \"hidden\",\n  },\n  photoPreview: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n  removePhotoButton: {\n    position: \"absolute\",\n    top: Spacing.sm,\n    right: Spacing.sm,\n    width: 28,\n    height: 28,\n    borderRadius: 14,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  saveButton: {\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginTop: Spacing.md,\n  },\n  saveButtonText: {\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":17620,"size_tokens":null},"components/EmptyState.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, View } from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius } from \"@/constants/theme\";\n\ninterface EmptyStateProps {\n  icon: keyof typeof Feather.glyphMap;\n  title: string;\n  message: string;\n}\n\nexport function EmptyState({ icon, title, message }: EmptyStateProps) {\n  const { theme } = useTheme();\n\n  return (\n    <View style={styles.container}>\n      <View\n        style={[\n          styles.iconContainer,\n          { backgroundColor: theme.backgroundSecondary },\n        ]}\n      >\n        <Feather name={icon} size={32} color={theme.textSecondary} />\n      </View>\n      <ThemedText type=\"h4\" style={styles.title}>\n        {title}\n      </ThemedText>\n      <ThemedText\n        type=\"body\"\n        style={[styles.message, { color: theme.textSecondary }]}\n      >\n        {message}\n      </ThemedText>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    padding: Spacing.xl,\n  },\n  iconContainer: {\n    width: 80,\n    height: 80,\n    borderRadius: BorderRadius.full,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  title: {\n    textAlign: \"center\",\n    marginBottom: Spacing.sm,\n  },\n  message: {\n    textAlign: \"center\",\n    opacity: 0.7,\n  },\n});\n","path":null,"size_bytes":1467,"size_tokens":null},"components/TripCard.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, View, Pressable } from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\nimport { Trip, formatDate, formatDuration, formatDistance } from \"@/utils/storage\";\n\ninterface TripCardProps {\n  trip: Trip;\n  useKilometers: boolean;\n  onPress: () => void;\n  siteVisitCount?: number;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function TripCard({\n  trip,\n  useKilometers,\n  onPress,\n  siteVisitCount = 0,\n}: TripCardProps) {\n  const { theme } = useTheme();\n  const scale = useSharedValue(1);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    scale.value = withSpring(0.98, springConfig);\n  };\n\n  const handlePressOut = () => {\n    scale.value = withSpring(1, springConfig);\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      style={[\n        styles.card,\n        {\n          backgroundColor: theme.backgroundDefault,\n          borderColor: theme.backgroundSecondary,\n        },\n        animatedStyle,\n      ]}\n    >\n      <View style={styles.header}>\n        <ThemedText type=\"body\" style={styles.date}>\n          {formatDate(trip.startTime)}\n        </ThemedText>\n        <Feather name=\"chevron-right\" size={20} color={theme.textSecondary} />\n      </View>\n\n      <View style={styles.statsRow}>\n        <View style={styles.stat}>\n          <View style={styles.statIcon}>\n            <Feather name=\"navigation\" size={14} color={AppColors.primary} />\n          </View>\n          <View>\n            <ThemedText type=\"caption\" style={styles.statLabel}>\n              Distance\n            </ThemedText>\n            <ThemedText type=\"small\" style={styles.statValue}>\n              {formatDistance(trip.totalDistance, useKilometers)}\n            </ThemedText>\n          </View>\n        </View>\n\n        <View style={styles.stat}>\n          <View style={styles.statIcon}>\n            <Feather name=\"clock\" size={14} color={AppColors.accent} />\n          </View>\n          <View>\n            <ThemedText type=\"caption\" style={styles.statLabel}>\n              Duration\n            </ThemedText>\n            <ThemedText type=\"small\" style={styles.statValue}>\n              {formatDuration(trip.startTime, trip.endTime)}\n            </ThemedText>\n          </View>\n        </View>\n\n        <View style={styles.stat}>\n          <View style={styles.statIcon}>\n            <Feather name=\"map-pin\" size={14} color={AppColors.warning} />\n          </View>\n          <View>\n            <ThemedText type=\"caption\" style={styles.statLabel}>\n              Sites\n            </ThemedText>\n            <ThemedText type=\"small\" style={styles.statValue}>\n              {siteVisitCount}\n            </ThemedText>\n          </View>\n        </View>\n      </View>\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  card: {\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    borderWidth: 1,\n    marginBottom: Spacing.md,\n  },\n  header: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    marginBottom: Spacing.md,\n  },\n  date: {\n    fontWeight: \"600\",\n  },\n  statsRow: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n  },\n  stat: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n  },\n  statIcon: {\n    width: 28,\n    height: 28,\n    borderRadius: 14,\n    backgroundColor: \"rgba(0,0,0,0.05)\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  statLabel: {\n    opacity: 0.7,\n  },\n  statValue: {\n    fontWeight: \"500\",\n  },\n});\n","path":null,"size_bytes":4126,"size_tokens":null},"components/FAB.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, Pressable, ViewStyle, StyleProp } from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { Spacing, AppColors, BorderRadius } from \"@/constants/theme\";\n\ninterface FABProps {\n  icon: keyof typeof Feather.glyphMap;\n  onPress: () => void;\n  color?: string;\n  style?: StyleProp<ViewStyle>;\n  disabled?: boolean;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function FAB({\n  icon,\n  onPress,\n  color = AppColors.primary,\n  style,\n  disabled = false,\n}: FABProps) {\n  const scale = useSharedValue(1);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    if (!disabled) {\n      scale.value = withSpring(0.92, springConfig);\n    }\n  };\n\n  const handlePressOut = () => {\n    if (!disabled) {\n      scale.value = withSpring(1, springConfig);\n    }\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={disabled ? undefined : onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      disabled={disabled}\n      style={[\n        styles.fab,\n        {\n          backgroundColor: color,\n          opacity: disabled ? 0.5 : 1,\n        },\n        style,\n        animatedStyle,\n      ]}\n    >\n      <Feather name={icon} size={24} color=\"#FFFFFF\" />\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  fab: {\n    width: Spacing.fabSize,\n    height: Spacing.fabSize,\n    borderRadius: BorderRadius.full,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 0,\n      height: 2,\n    },\n    shadowOpacity: 0.15,\n    shadowRadius: 4,\n    elevation: 4,\n  },\n});\n","path":null,"size_bytes":1997,"size_tokens":null},"App.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, View, ActivityIndicator } from \"react-native\";\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport { GestureHandlerRootView } from \"react-native-gesture-handler\";\nimport { KeyboardProvider } from \"react-native-keyboard-controller\";\nimport { SafeAreaProvider } from \"react-native-safe-area-context\";\nimport { StatusBar } from \"expo-status-bar\";\n\nimport MainTabNavigator from \"@/navigation/MainTabNavigator\";\nimport AuthStackNavigator from \"@/navigation/AuthStackNavigator\";\nimport { ErrorBoundary } from \"@/components/ErrorBoundary\";\nimport { TripProvider } from \"@/context/TripContext\";\nimport { AuthProvider, useAuth } from \"@/context/AuthContext\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { AppColors } from \"@/constants/theme\";\n\nfunction AppContent() {\n  const { isAuthenticated, isLoading } = useAuth();\n  const { theme } = useTheme();\n\n  if (isLoading) {\n    return (\n      <View style={[styles.loadingContainer, { backgroundColor: theme.backgroundRoot }]}>\n        <ActivityIndicator size=\"large\" color={AppColors.primary} />\n      </View>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return <AuthStackNavigator />;\n  }\n\n  return (\n    <TripProvider>\n      <MainTabNavigator />\n    </TripProvider>\n  );\n}\n\nexport default function App() {\n  return (\n    <ErrorBoundary>\n      <SafeAreaProvider>\n        <GestureHandlerRootView style={styles.root}>\n          <KeyboardProvider>\n            <AuthProvider>\n              <NavigationContainer>\n                <AppContent />\n              </NavigationContainer>\n            </AuthProvider>\n            <StatusBar style=\"auto\" />\n          </KeyboardProvider>\n        </GestureHandlerRootView>\n      </SafeAreaProvider>\n    </ErrorBoundary>\n  );\n}\n\nconst styles = StyleSheet.create({\n  root: {\n    flex: 1,\n  },\n  loadingContainer: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n});\n","path":null,"size_bytes":1937,"size_tokens":null},"hooks/useTrip.ts":{"content":"import { useState, useEffect, useCallback, useRef } from \"react\";\nimport * as Location from \"expo-location\";\nimport { Platform } from \"react-native\";\nimport {\n  Trip,\n  GPSPoint,\n  SiteVisit,\n  generateId,\n} from \"@/utils/storage\";\nimport {\n  initializeDataLayer,\n  getTrips,\n  saveTrip,\n  saveTrips,\n  getActiveTrip,\n  saveActiveTrip,\n  getGPSPoints,\n  saveGPSPoint,\n  getSiteVisits,\n  saveSiteVisit,\n  getUserSettings,\n  saveUserSettings,\n  ExtendedUserSettings,\n} from \"@/utils/dataAccess\";\nimport { useMotionDetection, setGlobalMotionState, getGlobalMotionState, analyzeGPSMotion, resetGPSMotionBuffer } from \"./useMotionDetection\";\nimport { getGPSFilter, resetGPSFilter, calculateFilteredDistance } from \"@/utils/gpsFilter\";\n\nexport interface TripState {\n  trips: Trip[];\n  activeTrip: Trip | null;\n  gpsPoints: GPSPoint[];\n  siteVisits: SiteVisit[];\n  settings: ExtendedUserSettings;\n  isLoading: boolean;\n  locationPermission: boolean;\n  currentLocation: Location.LocationObject | null;\n}\n\nexport function useTrip() {\n  const [state, setState] = useState<TripState>({\n    trips: [],\n    activeTrip: null,\n    gpsPoints: [],\n    siteVisits: [],\n    settings: {\n      workerName: \"\",\n      workerId: \"\",\n      useKilometers: true,\n      allowanceRate: 3.5,\n      gpsUpdateFrequency: \"medium\",\n      allowanceRatePerMile: 0.8,\n      minDistanceForAllowance: 0,\n      maxDailyAllowance: 0,\n    },\n    isLoading: true,\n    locationPermission: false,\n    currentLocation: null,\n  });\n\n  const locationSubscription = useRef<Location.LocationSubscription | null>(null);\n  const { isMoving, motionState, motionConfidence, startMotionDetection, stopMotionDetection } = useMotionDetection();\n\n  useEffect(() => {\n    setGlobalMotionState(motionState, isMoving, motionConfidence);\n  }, [motionState, isMoving, motionConfidence]);\n\n  const loadData = useCallback(async () => {\n    try {\n      await initializeDataLayer();\n\n      const [trips, activeTrip, settings] = await Promise.all([\n        getTrips(),\n        getActiveTrip(),\n        getUserSettings(),\n      ]);\n\n      let gpsPoints: GPSPoint[] = [];\n      let siteVisits: SiteVisit[] = [];\n\n      if (activeTrip) {\n        [gpsPoints, siteVisits] = await Promise.all([\n          getGPSPoints(activeTrip.id),\n          getSiteVisits(activeTrip.id),\n        ]);\n      }\n\n      setState((prev) => ({\n        ...prev,\n        trips,\n        activeTrip,\n        gpsPoints,\n        siteVisits,\n        settings,\n        isLoading: false,\n      }));\n    } catch (error) {\n      console.error(\"Error loading data:\", error);\n      setState((prev) => ({ ...prev, isLoading: false }));\n    }\n  }, []);\n\n  const requestLocationPermission = useCallback(async () => {\n    if (Platform.OS === \"web\") {\n      console.log(\"Location tracking not supported on web\");\n      return false;\n    }\n    try {\n      const { status } = await Location.requestForegroundPermissionsAsync();\n      const granted = status === \"granted\";\n      setState((prev) => ({ ...prev, locationPermission: granted }));\n      return granted;\n    } catch (error) {\n      console.error(\"Error requesting location permission:\", error);\n      return false;\n    }\n  }, []);\n\n  const getCurrentLocation = useCallback(async () => {\n    if (Platform.OS === \"web\") {\n      console.log(\"Location tracking not supported on web\");\n      return null;\n    }\n    try {\n      const location = await Location.getCurrentPositionAsync({\n        accuracy: Location.Accuracy.High,\n      });\n      setState((prev) => ({ ...prev, currentLocation: location }));\n      return location;\n    } catch (error) {\n      console.error(\"Error getting current location:\", error);\n      return null;\n    }\n  }, []);\n\n  const startLocationTracking = useCallback(\n    async (tripId: string) => {\n      if (Platform.OS === \"web\") {\n        console.log(\"Location tracking not supported on web\");\n        return;\n      }\n\n      if (locationSubscription.current) {\n        try {\n          locationSubscription.current.remove();\n        } catch (e) {\n          console.log(\"Error removing subscription:\", e);\n        }\n        locationSubscription.current = null;\n      }\n\n      const intervalMap = {\n        low: 20000,     // 20 seconds - battery saver\n        medium: 10000,  // 10 seconds - balanced\n        high: 3000,     // 3 seconds - fitness app accuracy\n      };\n\n      const distanceMap = {\n        low: 30,    // 30 meters\n        medium: 10, // 10 meters\n        high: 5,    // 5 meters - captures turns and curves accurately\n      };\n\n      const interval = intervalMap[state.settings.gpsUpdateFrequency];\n      const distance = distanceMap[state.settings.gpsUpdateFrequency];\n\n      resetGPSMotionBuffer();\n      resetGPSFilter();\n      \n      try {\n        locationSubscription.current = await Location.watchPositionAsync(\n          {\n            accuracy: Location.Accuracy.High,\n            timeInterval: interval,\n            distanceInterval: distance,\n          },\n          async (location) => {\n            let motionInfo = getGlobalMotionState();\n            \n            const accelConfidence = motionInfo.state !== \"unknown\" ? motionInfo.confidence : undefined;\n            \n            const gpsMotion = analyzeGPSMotion({\n              latitude: location.coords.latitude,\n              longitude: location.coords.longitude,\n              timestamp: location.timestamp,\n              accuracy: location.coords.accuracy || undefined,\n              speed: location.coords.speed,\n              heading: location.coords.heading,\n            }, accelConfidence);\n            \n            if (motionInfo.state === \"unknown\" || Platform.OS === \"web\") {\n              motionInfo = {\n                state: gpsMotion.isStationary ? \"stationary\" : \"moving\",\n                isMoving: !gpsMotion.isStationary,\n                confidence: gpsMotion.motionConfidence,\n              };\n            } else {\n              motionInfo = {\n                ...motionInfo,\n                confidence: Math.max(motionInfo.confidence, gpsMotion.motionConfidence),\n              };\n            }\n            \n            const gpsFilter = getGPSFilter();\n            const filterResult = gpsFilter.processPoint(\n              location.coords.latitude,\n              location.coords.longitude,\n              location.timestamp,\n              location.coords.accuracy || undefined,\n              location.coords.speed,\n              motionInfo.confidence\n            );\n            \n            const point: GPSPoint = {\n              id: generateId(),\n              tripId,\n              latitude: location.coords.latitude,\n              longitude: location.coords.longitude,\n              timestamp: location.timestamp,\n              accuracy: location.coords.accuracy || undefined,\n              isStationary: !filterResult.isMoving,\n              motionConfidence: motionInfo.confidence,\n            };\n\n            await saveGPSPoint(point);\n\n            setState((prev) => {\n              const newPoints = [...prev.gpsPoints, point];\n              \n              let totalDistance = prev.activeTrip?.totalDistance || 0;\n              totalDistance += filterResult.distance;\n\n              if (prev.activeTrip) {\n                const updatedTrip = { ...prev.activeTrip, totalDistance };\n                saveActiveTrip(updatedTrip);\n                return {\n                  ...prev,\n                  gpsPoints: newPoints,\n                  activeTrip: updatedTrip,\n                  currentLocation: location,\n                };\n              }\n\n              return { ...prev, gpsPoints: newPoints, currentLocation: location };\n            });\n          }\n        );\n      } catch (error) {\n        console.error(\"Error starting location tracking:\", error);\n      }\n    },\n    [state.settings.gpsUpdateFrequency]\n  );\n\n  const stopLocationTracking = useCallback(() => {\n    if (locationSubscription.current) {\n      try {\n        locationSubscription.current.remove();\n      } catch (e) {\n        console.log(\"Error removing location subscription:\", e);\n      }\n      locationSubscription.current = null;\n    }\n  }, []);\n\n  const startTrip = useCallback(async () => {\n    if (Platform.OS === \"web\") {\n      console.log(\"Trip tracking not supported on web\");\n      return null;\n    }\n\n    const hasPermission = await requestLocationPermission();\n    if (!hasPermission) {\n      return null;\n    }\n\n    const location = await getCurrentLocation();\n    if (!location) {\n      return null;\n    }\n\n    const trip: Trip = {\n      id: generateId(),\n      startTime: Date.now(),\n      startLatitude: location.coords.latitude,\n      startLongitude: location.coords.longitude,\n      totalDistance: 0,\n      siteVisits: [],\n      isActive: true,\n    };\n\n    await saveActiveTrip(trip);\n\n    const initialPoint: GPSPoint = {\n      id: generateId(),\n      tripId: trip.id,\n      latitude: location.coords.latitude,\n      longitude: location.coords.longitude,\n      timestamp: Date.now(),\n      accuracy: location.coords.accuracy || undefined,\n    };\n\n    await saveGPSPoint(initialPoint);\n\n    setState((prev) => ({\n      ...prev,\n      activeTrip: trip,\n      gpsPoints: [initialPoint],\n      siteVisits: [],\n    }));\n\n    await startMotionDetection();\n    await startLocationTracking(trip.id);\n\n    return trip;\n  }, [requestLocationPermission, getCurrentLocation, startLocationTracking, startMotionDetection]);\n\n  const endTrip = useCallback(async () => {\n    if (!state.activeTrip) return null;\n\n    stopLocationTracking();\n    stopMotionDetection();\n    resetGPSFilter();\n\n    const location = await getCurrentLocation();\n    const finalPoints = await getGPSPoints(state.activeTrip.id);\n    const totalDistance = calculateFilteredDistance(finalPoints);\n\n    const completedTrip: Trip = {\n      ...state.activeTrip,\n      endTime: Date.now(),\n      endLatitude: location?.coords.latitude,\n      endLongitude: location?.coords.longitude,\n      totalDistance,\n      isActive: false,\n    };\n\n    await saveTrip(completedTrip);\n    \n    const updatedTrips = [...state.trips, completedTrip];\n\n    setState((prev) => ({\n      ...prev,\n      trips: updatedTrips,\n      activeTrip: null,\n      gpsPoints: [],\n      siteVisits: [],\n    }));\n\n    return completedTrip;\n  }, [state.activeTrip, state.trips, stopLocationTracking, stopMotionDetection, getCurrentLocation]);\n\n  const recordSiteArrival = useCallback(\n    async (\n      siteName: string,\n      notes?: string,\n      photoUri?: string,\n      additionalFields?: {\n        schemeName?: string;\n        schemeNumber?: string;\n        esrDetails?: string;\n        village?: string;\n        issueReported?: string;\n        resolution?: string;\n        currentStatus?: string;\n      }\n    ) => {\n      if (!state.activeTrip) return null;\n\n      const location = await getCurrentLocation();\n      if (!location && Platform.OS !== \"web\") return null;\n\n      const visit: SiteVisit = {\n        id: generateId(),\n        tripId: state.activeTrip.id,\n        siteName,\n        notes,\n        photoUri,\n        arrivalTime: Date.now(),\n        arrivalLatitude: location?.coords.latitude || 0,\n        arrivalLongitude: location?.coords.longitude || 0,\n        schemeName: additionalFields?.schemeName,\n        schemeNumber: additionalFields?.schemeNumber,\n        esrDetails: additionalFields?.esrDetails,\n        village: additionalFields?.village,\n        issueReported: additionalFields?.issueReported,\n        resolution: additionalFields?.resolution,\n        currentStatus: additionalFields?.currentStatus,\n      };\n\n      await saveSiteVisit(visit);\n\n      const updatedTrip = {\n        ...state.activeTrip,\n        siteVisits: [...state.activeTrip.siteVisits, visit.id],\n      };\n      await saveActiveTrip(updatedTrip);\n\n      setState((prev) => ({\n        ...prev,\n        siteVisits: [...prev.siteVisits, visit],\n        activeTrip: updatedTrip,\n      }));\n\n      return visit;\n    },\n    [state.activeTrip, getCurrentLocation]\n  );\n\n  const recordSiteDeparture = useCallback(\n    async (visitId: string) => {\n      if (!state.activeTrip) return null;\n\n      const location = await getCurrentLocation();\n\n      const visit = state.siteVisits.find((v) => v.id === visitId);\n      if (!visit) return null;\n\n      const updatedVisit: SiteVisit = {\n        ...visit,\n        departureTime: Date.now(),\n        departureLatitude: location?.coords.latitude || visit.arrivalLatitude,\n        departureLongitude: location?.coords.longitude || visit.arrivalLongitude,\n      };\n\n      await saveSiteVisit(updatedVisit);\n\n      setState((prev) => ({\n        ...prev,\n        siteVisits: prev.siteVisits.map((v) =>\n          v.id === visitId ? updatedVisit : v\n        ),\n      }));\n\n      return updatedVisit;\n    },\n    [state.activeTrip, state.siteVisits, getCurrentLocation]\n  );\n\n  const updateSettings = useCallback(async (newSettings: Partial<ExtendedUserSettings>) => {\n    const updatedSettings = { ...state.settings, ...newSettings };\n    await saveUserSettings(updatedSettings);\n    setState((prev) => ({\n      ...prev,\n      settings: updatedSettings,\n    }));\n  }, [state.settings]);\n\n  const getTodaysTrips = useCallback(() => {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const todayStart = today.getTime();\n\n    return state.trips.filter((trip) => trip.startTime >= todayStart);\n  }, [state.trips]);\n\n  const getTodaysDistance = useCallback(() => {\n    const todaysTrips = getTodaysTrips();\n    const tripDistance = todaysTrips.reduce(\n      (sum, trip) => sum + trip.totalDistance,\n      0\n    );\n    const activeDistance = state.activeTrip?.totalDistance || 0;\n    return tripDistance + activeDistance;\n  }, [getTodaysTrips, state.activeTrip]);\n\n  const getTodaysAllowance = useCallback(() => {\n    const distance = getTodaysDistance();\n    const rate = state.settings.useKilometers\n      ? state.settings.allowanceRate\n      : state.settings.allowanceRatePerMile || 0.8;\n    \n    let allowance = distance * rate;\n    \n    if (state.settings.minDistanceForAllowance && distance < state.settings.minDistanceForAllowance) {\n      allowance = 0;\n    }\n    \n    if (state.settings.maxDailyAllowance && state.settings.maxDailyAllowance > 0) {\n      allowance = Math.min(allowance, state.settings.maxDailyAllowance);\n    }\n    \n    return allowance;\n  }, [getTodaysDistance, state.settings]);\n\n  useEffect(() => {\n    loadData();\n\n    return () => {\n      stopLocationTracking();\n    };\n  }, [loadData, stopLocationTracking]);\n\n  useEffect(() => {\n    if (state.activeTrip && state.locationPermission && Platform.OS !== \"web\") {\n      startLocationTracking(state.activeTrip.id);\n    }\n  }, [state.activeTrip?.id, state.locationPermission, startLocationTracking]);\n\n  return {\n    ...state,\n    startTrip,\n    endTrip,\n    recordSiteArrival,\n    recordSiteDeparture,\n    updateSettings,\n    getTodaysTrips,\n    getTodaysDistance,\n    getTodaysAllowance,\n    requestLocationPermission,\n    getCurrentLocation,\n    loadData,\n  };\n}\n","path":null,"size_bytes":14967,"size_tokens":null},"replit.md":{"content":"# RouteTracker - GPS Route Tracking App\n\n## Overview\nRouteTracker is a mobile application designed for workers to track their actual travel routes using continuous GPS logging and calculate total distance based on the real path traveled (not just straight-line distance between points). It calculates travel allowances automatically based on configurable rates.\n\n## Current State\n- Fully functional MVP with GPS route tracking\n- Local data persistence using AsyncStorage\n- iOS/Android compatible via Expo Go\n- Web preview available for testing\n\n## Project Architecture\n\n### Stack\n- **Framework**: React Native with Expo SDK 54\n- **Navigation**: React Navigation 7 with bottom tabs\n- **State Management**: React Context + Custom Hooks\n- **Storage**: SQLite (native) + AsyncStorage (web fallback)\n- **Location**: expo-location for GPS tracking\n- **Maps**: react-native-maps (native) with web fallback\n- **Media**: expo-image-picker for photo capture\n\n### Directory Structure\n```\n/\n├── App.tsx                   # Root component with providers\n├── app.json                  # Expo configuration\n├── assets/images/            # App icons and images\n├── components/               # Reusable UI components\n│   ├── ActionButton.tsx      # Large action buttons\n│   ├── ActiveTripCard.tsx    # Shows active trip status\n│   ├── Card.tsx              # Base card component\n│   ├── EmptyState.tsx        # Empty state display\n│   ├── ErrorBoundary.tsx     # Error handling wrapper\n│   ├── ErrorFallback.tsx     # Error UI component\n│   ├── FAB.tsx               # Floating action button\n│   ├── HeaderTitle.tsx       # Custom header with logo\n│   ├── SettingsItem.tsx      # Settings list item\n│   ├── StatCard.tsx          # Stats display card\n│   ├── TimelineEvent.tsx     # Timeline event with photo support\n│   ├── TripCard.tsx          # Trip history card\n│   ├── TripMap.native.tsx    # Native map with MapView (iOS/Android)\n│   └── TripMap.web.tsx       # Web fallback for maps\n├── constants/theme.ts        # Design tokens and colors\n├── context/TripContext.tsx   # Trip state context provider\n├── hooks/\n│   ├── useTrip.ts            # Trip management hook\n│   ├── useScreenInsets.ts    # Safe area hook\n│   └── useTheme.ts           # Theme hook\n├── navigation/               # Navigation configuration\n│   ├── MainTabNavigator.tsx  # Bottom tab navigator\n│   ├── HomeStackNavigator.tsx\n│   ├── HistoryStackNavigator.tsx\n│   ├── ReportsStackNavigator.tsx\n│   └── ProfileStackNavigator.tsx\n├── screens/                  # Screen components\n│   ├── HomeScreen.tsx        # Main tracking screen\n│   ├── HistoryScreen.tsx     # Trip history list\n│   ├── ReportsScreen.tsx     # Statistics and reports\n│   ├── ProfileScreen.tsx     # User settings\n│   ├── TripDetailsScreen.tsx # Individual trip details\n│   └── SiteVisitModal.tsx    # Site visit recording\n└── utils/\n    ├── storage.ts            # Data types, Haversine formula, formatters\n    ├── database.ts           # SQLite database operations (native)\n    └── dataAccess.ts         # Unified data layer (SQLite + AsyncStorage)\n```\n\n### Key Features\n1. **Trip Tracking**: Start/end trips with GPS location capture\n2. **Continuous GPS Logging**: Records coordinates during active trips\n3. **Distance Calculation**: Uses Haversine formula on sequential GPS points\n4. **Site Visits**: Record arrival/departure at work sites with photos\n5. **Photo Documentation**: Attach photos to site visits for proof of arrival\n6. **Route Visualization**: Interactive maps showing travel routes (native platforms)\n7. **Timeline View**: Visual timeline of trip events with embedded photos\n8. **Travel Allowance**: Automatic calculation with advanced rate settings\n9. **Trip History**: View all past trips with details\n10. **Reports**: Statistics with daily/weekly/monthly views and CSV export\n11. **Settings**: Configurable units, rates, GPS frequency, and allowance rules\n\n## User Preferences\n- Distance units: Kilometers (default) or Miles\n- Allowance rate: Configurable per km/mile\n- GPS update frequency: Low (30s), Medium (15s), High (5s)\n- Advanced Allowance Settings:\n  - Rate Per Mile: Used for US/Imperial units (default $0.80)\n  - Min Distance for Allowance: Minimum travel distance before allowance applies\n  - Max Daily Allowance: Cap on total daily travel reimbursement\n\n## Recent Changes\n- Initial MVP implementation (November 2024)\n- Generated app icon and worker avatar\n- Implemented all 4 tabs: Today, History, Reports, Profile\n- Added real-time GPS tracking with Haversine distance calculation\n- Local storage persistence for trips, GPS points, site visits\n- Added SQLite database support for native platforms (expo-sqlite)\n- Implemented platform-specific TripMap component (TripMap.native.tsx / TripMap.web.tsx)\n- Added photo attachment functionality for site visits using expo-image-picker\n- Implemented advanced allowance settings:\n  - Rate per mile (for US/Imperial units)\n  - Minimum distance threshold for allowance\n  - Maximum daily allowance cap\n- Updated ProfileScreen with Extended Allowance Settings section\n- CSV export now available for trip data\n- **December 2024 - Advanced GPS Filtering** (utils/gpsFilter.ts):\n  - Kalman filter to smooth GPS coordinates and reduce noise\n  - Stationary lock requiring sustained movement before counting distance\n  - Dwell zone clustering (20m radius) to prevent drift accumulation\n  - Speed validation (minimum 1.5 km/h, maximum 200 km/h)\n  - Accuracy filtering (rejects points with accuracy >30m)\n  - Consecutive moving point requirement before counting segments\n\n## Running the App\n- **Development**: `npm run dev` starts Expo development server\n- **Testing**: Scan QR code with Expo Go app on physical device\n- **Web Preview**: Available at localhost:8081 (limited GPS features)\n\n## Notes\n- GPS tracking works best on physical devices via Expo Go\n- Web version shows fallback messages for GPS-dependent features\n- Background location tracking available on iOS/Android only\n","path":null,"size_bytes":6278,"size_tokens":null},"components/ThemedView.tsx":{"content":"import { View, type ViewProps } from \"react-native\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\n\nexport type ThemedViewProps = ViewProps & {\n  lightColor?: string;\n  darkColor?: string;\n};\n\nexport function ThemedView({\n  style,\n  lightColor,\n  darkColor,\n  ...otherProps\n}: ThemedViewProps) {\n  const { theme, isDark } = useTheme();\n\n  const backgroundColor =\n    isDark && darkColor\n      ? darkColor\n      : !isDark && lightColor\n        ? lightColor\n        : theme.backgroundRoot;\n\n  return <View style={[{ backgroundColor }, style]} {...otherProps} />;\n}\n","path":null,"size_bytes":563,"size_tokens":null},"screens/HomeScreen.tsx":{"content":"import React, { useState, useCallback } from \"react\";\nimport { StyleSheet, View, Alert, Platform, Linking } from \"react-native\";\nimport { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { useFocusEffect } from \"@react-navigation/native\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ScreenScrollView } from \"@/components/ScreenScrollView\";\nimport { StatCard } from \"@/components/StatCard\";\nimport { ActiveTripCard } from \"@/components/ActiveTripCard\";\nimport { TimelineEvent, EventType } from \"@/components/TimelineEvent\";\nimport { ActionButton } from \"@/components/ActionButton\";\nimport { FAB } from \"@/components/FAB\";\nimport { EmptyState } from \"@/components/EmptyState\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useTripContext } from \"@/context/TripContext\";\nimport { Spacing, AppColors } from \"@/constants/theme\";\nimport { formatDistance, SiteVisit } from \"@/utils/storage\";\nimport { formatAllowanceAdvanced } from \"@/utils/dataAccess\";\nimport { HomeStackParamList } from \"@/navigation/HomeStackNavigator\";\nimport { useScreenInsets } from \"@/hooks/useScreenInsets\";\n\ntype HomeScreenProps = {\n  navigation: NativeStackNavigationProp<HomeStackParamList, \"Home\">;\n};\n\ninterface TimelineEventData {\n  id: string;\n  type: EventType;\n  time: number;\n  title: string;\n  subtitle?: string;\n}\n\nexport default function HomeScreen({ navigation }: HomeScreenProps) {\n  const { theme } = useTheme();\n  const { tabBarHeight } = useScreenInsets();\n  const {\n    activeTrip,\n    siteVisits,\n    settings,\n    isLoading,\n    locationPermission,\n    startTrip,\n    endTrip,\n    recordSiteDeparture,\n    getTodaysDistance,\n    getTodaysAllowance,\n    requestLocationPermission,\n    loadData,\n  } = useTripContext();\n\n  const [isStarting, setIsStarting] = useState(false);\n  const [isEnding, setIsEnding] = useState(false);\n\n  useFocusEffect(\n    useCallback(() => {\n      loadData();\n    }, [loadData])\n  );\n\n  const handleStartTrip = async () => {\n    setIsStarting(true);\n    try {\n      if (Platform.OS === \"web\") {\n        Alert.alert(\n          \"Trip Tracking Not Available\",\n          \"Trip tracking requires GPS access which is not available on web. Please use Expo Go on a physical device or an emulator to track trips.\"\n        );\n        return;\n      }\n\n      if (!locationPermission) {\n        const granted = await requestLocationPermission();\n        if (!granted) {\n          Alert.alert(\n            \"Location Permission Required\",\n            \"RouteTracker needs access to your location to track your trips. Please enable location access.\",\n            [\n              { text: \"Cancel\", style: \"cancel\" },\n              {\n                text: \"Open Settings\",\n                onPress: async () => {\n                  try {\n                    await Linking.openSettings();\n                  } catch {\n                  }\n                },\n              },\n            ]\n          );\n          return;\n        }\n      }\n\n      await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n      await startTrip();\n    } catch (error) {\n      Alert.alert(\"Error\", \"Failed to start trip. Please try again.\");\n    } finally {\n      setIsStarting(false);\n    }\n  };\n\n  const handleEndTrip = async () => {\n    Alert.alert(\"End Trip\", \"Are you sure you want to end this trip?\", [\n      { text: \"Cancel\", style: \"cancel\" },\n      {\n        text: \"End Trip\",\n        style: \"destructive\",\n        onPress: async () => {\n          setIsEnding(true);\n          try {\n            await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n            const completedTrip = await endTrip();\n            if (completedTrip) {\n              Alert.alert(\n                \"Trip Completed\",\n                `You traveled ${formatDistance(completedTrip.totalDistance, settings.useKilometers)} and earned ${formatAllowanceAdvanced(completedTrip.totalDistance, settings)}.`\n              );\n            }\n          } catch (error) {\n            Alert.alert(\"Error\", \"Failed to end trip. Please try again.\");\n          } finally {\n            setIsEnding(false);\n          }\n        },\n      },\n    ]);\n  };\n\n  const handleRecordArrival = () => {\n    navigation.navigate(\"SiteVisit\", { mode: \"arrival\" });\n  };\n\n  const handleRecordDeparture = (visit: SiteVisit) => {\n    Alert.alert(\n      \"Record Departure\",\n      `Record departure from ${visit.siteName}?`,\n      [\n        { text: \"Cancel\", style: \"cancel\" },\n        {\n          text: \"Confirm\",\n          onPress: async () => {\n            await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n            await recordSiteDeparture(visit.id);\n          },\n        },\n      ]\n    );\n  };\n\n  const buildTimelineEvents = (): TimelineEventData[] => {\n    const events: TimelineEventData[] = [];\n\n    if (activeTrip) {\n      events.push({\n        id: \"start\",\n        type: \"start\",\n        time: activeTrip.startTime,\n        title: \"Left Home\",\n        subtitle: \"Trip started\",\n      });\n\n      siteVisits.forEach((visit) => {\n        events.push({\n          id: `arrival-${visit.id}`,\n          type: \"site_arrival\",\n          time: visit.arrivalTime,\n          title: `Arrived at ${visit.siteName}`,\n          subtitle: visit.notes,\n        });\n\n        if (visit.departureTime) {\n          events.push({\n            id: `departure-${visit.id}`,\n            type: \"site_departure\",\n            time: visit.departureTime,\n            title: `Departed ${visit.siteName}`,\n          });\n        }\n      });\n\n      events.sort((a, b) => a.time - b.time);\n\n      events.push({\n        id: \"current\",\n        type: \"current\",\n        time: Date.now(),\n        title: \"Current Location\",\n        subtitle: \"Tracking in progress\",\n      });\n    }\n\n    return events;\n  };\n\n  const timelineEvents = buildTimelineEvents();\n  const pendingDepartures = siteVisits.filter((v) => !v.departureTime);\n  const todaysDistance = getTodaysDistance();\n  const todaysAllowance = getTodaysAllowance();\n\n  return (\n    <>\n      <ScreenScrollView\n        contentContainerStyle={styles.contentContainer}\n        showsVerticalScrollIndicator={false}\n      >\n        <View style={styles.statsRow}>\n          <StatCard\n            title=\"Distance Today\"\n            value={formatDistance(todaysDistance, settings.useKilometers)}\n            icon=\"navigation\"\n            iconColor={AppColors.primary}\n          />\n          <View style={styles.statSpacer} />\n          <StatCard\n            title=\"Allowance\"\n            value={`Rs ${todaysAllowance.toFixed(2)}`}\n            icon=\"credit-card\"\n            iconColor={AppColors.accent}\n          />\n        </View>\n\n        {activeTrip ? (\n          <>\n            <ActiveTripCard\n              startTime={activeTrip.startTime}\n              distance={activeTrip.totalDistance}\n              useKilometers={settings.useKilometers}\n            />\n\n            <View style={styles.actionsContainer}>\n              <ActionButton\n                title=\"Record Site Arrival\"\n                icon=\"log-in\"\n                onPress={handleRecordArrival}\n                variant=\"secondary\"\n                style={styles.actionButton}\n              />\n              {pendingDepartures.length > 0 ? (\n                <ActionButton\n                  title={`Depart ${pendingDepartures[pendingDepartures.length - 1].siteName}`}\n                  icon=\"log-out\"\n                  onPress={() =>\n                    handleRecordDeparture(\n                      pendingDepartures[pendingDepartures.length - 1]\n                    )\n                  }\n                  variant=\"outline\"\n                  style={styles.actionButton}\n                />\n              ) : null}\n            </View>\n\n            <View style={styles.timelineContainer}>\n              <ThemedText type=\"h4\" style={styles.sectionTitle}>\n                Trip Timeline\n              </ThemedText>\n              {timelineEvents.map((event, index) => (\n                <TimelineEvent\n                  key={event.id}\n                  type={event.type}\n                  time={event.time}\n                  title={event.title}\n                  subtitle={event.subtitle}\n                  isLast={index === timelineEvents.length - 1}\n                />\n              ))}\n            </View>\n          </>\n        ) : (\n          <EmptyState\n            icon=\"navigation\"\n            title=\"No Active Trip\"\n            message=\"Tap the button below to start tracking your route and calculate your travel distance.\"\n          />\n        )}\n      </ScreenScrollView>\n\n      <FAB\n        icon={activeTrip ? \"square\" : \"play\"}\n        color={activeTrip ? AppColors.secondary : AppColors.primary}\n        onPress={activeTrip ? handleEndTrip : handleStartTrip}\n        disabled={isStarting || isEnding}\n        style={[\n          styles.fab,\n          { bottom: tabBarHeight + Spacing.md },\n        ]}\n      />\n    </>\n  );\n}\n\nconst styles = StyleSheet.create({\n  contentContainer: {\n    paddingBottom: Spacing.xxl + Spacing.fabSize,\n  },\n  statsRow: {\n    flexDirection: \"row\",\n    marginBottom: Spacing.md,\n  },\n  statSpacer: {\n    width: Spacing.md,\n  },\n  actionsContainer: {\n    gap: Spacing.sm,\n    marginBottom: Spacing.lg,\n  },\n  actionButton: {\n    flex: 1,\n  },\n  timelineContainer: {\n    marginTop: Spacing.md,\n  },\n  sectionTitle: {\n    marginBottom: Spacing.md,\n  },\n  fab: {\n    position: \"absolute\",\n    right: Spacing.md,\n  },\n});\n","path":null,"size_bytes":9470,"size_tokens":null},"components/Card.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, Pressable } from \"react-native\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius } from \"@/constants/theme\";\n\ninterface CardProps {\n  elevation: number;\n  onPress?: () => void;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst getBackgroundColorForElevation = (\n  elevation: number,\n  theme: any,\n): string => {\n  switch (elevation) {\n    case 1:\n      return theme.backgroundDefault;\n    case 2:\n      return theme.backgroundSecondary;\n    case 3:\n      return theme.backgroundTertiary;\n    default:\n      return theme.backgroundRoot;\n  }\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function Card({ elevation, onPress }: CardProps) {\n  const { theme } = useTheme();\n  const scale = useSharedValue(1);\n\n  const cardBackgroundColor = getBackgroundColorForElevation(elevation, theme);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    scale.value = withSpring(0.98, springConfig);\n  };\n\n  const handlePressOut = () => {\n    scale.value = withSpring(1, springConfig);\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      style={[\n        styles.card,\n        {\n          backgroundColor: cardBackgroundColor,\n        },\n        animatedStyle,\n      ]}\n    >\n      <ThemedText type=\"h4\" style={styles.cardTitle}>\n        Card - Elevation {elevation}\n      </ThemedText>\n      <ThemedText type=\"small\" style={styles.cardDescription}>\n        This card has an elevation of {elevation}\n      </ThemedText>\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  card: {\n    padding: Spacing.xl,\n    borderRadius: BorderRadius[\"2xl\"],\n  },\n  cardTitle: {\n    marginBottom: Spacing.sm,\n  },\n  cardDescription: {\n    opacity: 0.7,\n  },\n});\n","path":null,"size_bytes":2211,"size_tokens":null},"navigation/ProfileStackNavigator.tsx":{"content":"import React from \"react\";\nimport { createNativeStackNavigator } from \"@react-navigation/native-stack\";\nimport ProfileScreen from \"@/screens/ProfileScreen\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { getCommonScreenOptions } from \"@/navigation/screenOptions\";\n\nexport type ProfileStackParamList = {\n  Profile: undefined;\n};\n\nconst Stack = createNativeStackNavigator<ProfileStackParamList>();\n\nexport default function ProfileStackNavigator() {\n  const { theme, isDark } = useTheme();\n\n  return (\n    <Stack.Navigator screenOptions={getCommonScreenOptions({ theme, isDark })}>\n      <Stack.Screen\n        name=\"Profile\"\n        component={ProfileScreen}\n        options={{\n          title: \"Profile\",\n        }}\n      />\n    </Stack.Navigator>\n  );\n}\n","path":null,"size_bytes":760,"size_tokens":null},"components/ErrorFallback.tsx":{"content":"import React, { useState } from \"react\";\nimport { reloadAppAsync } from \"expo\";\nimport {\n  StyleSheet,\n  View,\n  Pressable,\n  ScrollView,\n  Text,\n  Modal,\n} from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius, Fonts } from \"@/constants/theme\";\n\nexport type ErrorFallbackProps = {\n  error: Error;\n  resetError: () => void;\n};\n\nexport function ErrorFallback({ error, resetError }: ErrorFallbackProps) {\n  const { theme } = useTheme();\n  const [isModalVisible, setIsModalVisible] = useState(false);\n\n  const handleRestart = async () => {\n    try {\n      await reloadAppAsync();\n    } catch (restartError) {\n      console.error(\"Failed to restart app:\", restartError);\n      resetError();\n    }\n  };\n\n  const formatErrorDetails = (): string => {\n    let details = `Error: ${error.message}\\n\\n`;\n    if (error.stack) {\n      details += `Stack Trace:\\n${error.stack}`;\n    }\n    return details;\n  };\n\n  return (\n    <ThemedView style={styles.container}>\n      {__DEV__ ? (\n        <Pressable\n          onPress={() => setIsModalVisible(true)}\n          style={({ pressed }) => [\n            styles.topButton,\n            {\n              backgroundColor: theme.backgroundDefault,\n              opacity: pressed ? 0.8 : 1,\n            },\n          ]}\n        >\n          <Feather name=\"alert-circle\" size={20} color={theme.text} />\n        </Pressable>\n      ) : null}\n\n      <View style={styles.content}>\n        <ThemedText type=\"h2\" style={styles.title}>\n          RouteTracker Hit a Bump\n        </ThemedText>\n\n        <ThemedText type=\"body\" style={styles.message}>\n          Something unexpected happened. Tap below to get back on track.\n        </ThemedText>\n\n        <Pressable\n          onPress={handleRestart}\n          style={({ pressed }) => [\n            styles.button,\n            {\n              backgroundColor: theme.link,\n              opacity: pressed ? 0.9 : 1,\n              transform: [{ scale: pressed ? 0.98 : 1 }],\n            },\n          ]}\n        >\n          <ThemedText\n            type=\"body\"\n            style={[styles.buttonText, { color: theme.buttonText }]}\n          >\n            Restart RouteTracker\n          </ThemedText>\n        </Pressable>\n      </View>\n\n      {__DEV__ ? (\n        <Modal\n          visible={isModalVisible}\n          animationType=\"slide\"\n          transparent={true}\n          onRequestClose={() => setIsModalVisible(false)}\n        >\n          <View style={styles.modalOverlay}>\n            <ThemedView style={styles.modalContainer}>\n              <View style={styles.modalHeader}>\n                <ThemedText type=\"h2\" style={styles.modalTitle}>\n                  Error Details\n                </ThemedText>\n                <Pressable\n                  onPress={() => setIsModalVisible(false)}\n                  style={({ pressed }) => [\n                    styles.closeButton,\n                    { opacity: pressed ? 0.6 : 1 },\n                  ]}\n                >\n                  <Feather name=\"x\" size={24} color={theme.text} />\n                </Pressable>\n              </View>\n\n              <ScrollView\n                style={styles.modalScrollView}\n                contentContainerStyle={styles.modalScrollContent}\n                showsVerticalScrollIndicator\n              >\n                <View\n                  style={[\n                    styles.errorContainer,\n                    { backgroundColor: theme.backgroundDefault },\n                  ]}\n                >\n                  <Text\n                    style={[\n                      styles.errorText,\n                      {\n                        color: theme.text,\n                        fontFamily: Fonts?.mono || \"monospace\",\n                      },\n                    ]}\n                    selectable\n                  >\n                    {formatErrorDetails()}\n                  </Text>\n                </View>\n              </ScrollView>\n            </ThemedView>\n          </View>\n        </Modal>\n      ) : null}\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    width: \"100%\",\n    height: \"100%\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: Spacing.xl,\n  },\n  content: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    gap: Spacing.lg,\n    width: \"100%\",\n    maxWidth: 600,\n  },\n  title: {\n    textAlign: \"center\",\n  },\n  message: {\n    textAlign: \"center\",\n    opacity: 0.7,\n  },\n  topButton: {\n    position: \"absolute\",\n    top: Spacing.xl + Spacing.lg,\n    right: Spacing.lg,\n    width: 44,\n    height: 44,\n    borderRadius: BorderRadius.md,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    zIndex: 10,\n  },\n  button: {\n    paddingVertical: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    paddingHorizontal: Spacing.xl,\n    minWidth: 200,\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 0,\n      height: 2,\n    },\n    shadowOpacity: 0.1,\n    shadowRadius: 4,\n    elevation: 3,\n  },\n  buttonText: {\n    fontWeight: \"600\",\n    textAlign: \"center\",\n    fontSize: 16,\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n    justifyContent: \"flex-end\",\n  },\n  modalContainer: {\n    width: \"100%\",\n    height: \"90%\",\n    borderTopLeftRadius: BorderRadius.lg,\n    borderTopRightRadius: BorderRadius.lg,\n  },\n  modalHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.lg,\n    paddingTop: Spacing.lg,\n    paddingBottom: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: \"rgba(128, 128, 128, 0.2)\",\n  },\n  modalTitle: {\n    fontWeight: \"600\",\n  },\n  closeButton: {\n    padding: Spacing.xs,\n  },\n  modalScrollView: {\n    flex: 1,\n  },\n  modalScrollContent: {\n    padding: Spacing.lg,\n  },\n  errorContainer: {\n    width: \"100%\",\n    borderRadius: BorderRadius.md,\n    overflow: \"hidden\",\n    padding: Spacing.lg,\n  },\n  errorText: {\n    fontSize: 12,\n    lineHeight: 18,\n    width: \"100%\",\n  },\n});\n","path":null,"size_bytes":6184,"size_tokens":null},"screens/ProfileScreen.tsx":{"content":"import React, { useState, useCallback } from \"react\";\nimport { StyleSheet, View, Image, TextInput, Alert, Pressable } from \"react-native\";\nimport { useFocusEffect } from \"@react-navigation/native\";\nimport { Feather } from \"@expo/vector-icons\";\n\nimport { ScreenKeyboardAwareScrollView } from \"@/components/ScreenKeyboardAwareScrollView\";\nimport { SettingsItem } from \"@/components/SettingsItem\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useTripContext } from \"@/context/TripContext\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\nimport { saveUserSettings, ExtendedUserSettings } from \"@/utils/dataAccess\";\n\nconst GPS_FREQUENCIES = [\n  { value: \"low\", label: \"Low (30s)\", description: \"Saves battery\" },\n  { value: \"medium\", label: \"Medium (15s)\", description: \"Balanced\" },\n  { value: \"high\", label: \"High (5s)\", description: \"Most accurate\" },\n];\n\nexport default function ProfileScreen() {\n  const { theme } = useTheme();\n  const { settings, loadData } = useTripContext();\n  const { user, logout } = useAuth();\n  const [localSettings, setLocalSettings] = useState<ExtendedUserSettings>({\n    ...settings,\n    allowanceRatePerMile: settings.allowanceRatePerMile ?? 0.8,\n    minDistanceForAllowance: settings.minDistanceForAllowance ?? 0,\n    maxDailyAllowance: settings.maxDailyAllowance ?? 0,\n  });\n  const [hasChanges, setHasChanges] = useState(false);\n\n  useFocusEffect(\n    useCallback(() => {\n      setLocalSettings({\n        ...settings,\n        allowanceRatePerMile: settings.allowanceRatePerMile ?? 0.8,\n        minDistanceForAllowance: settings.minDistanceForAllowance ?? 0,\n        maxDailyAllowance: settings.maxDailyAllowance ?? 0,\n      });\n      setHasChanges(false);\n    }, [settings])\n  );\n\n  const updateSetting = <K extends keyof ExtendedUserSettings>(\n    key: K,\n    value: ExtendedUserSettings[K]\n  ) => {\n    setLocalSettings((prev) => ({ ...prev, [key]: value }));\n    setHasChanges(true);\n  };\n\n  const handleSave = async () => {\n    try {\n      await saveUserSettings(localSettings);\n      await loadData();\n      setHasChanges(false);\n      Alert.alert(\"Success\", \"Settings saved successfully.\");\n    } catch (error) {\n      Alert.alert(\"Error\", \"Failed to save settings.\");\n    }\n  };\n\n  const handleLogout = () => {\n    Alert.alert(\n      \"Logout\",\n      \"Are you sure you want to logout?\",\n      [\n        { text: \"Cancel\", style: \"cancel\" },\n        {\n          text: \"Logout\",\n          style: \"destructive\",\n          onPress: async () => {\n            await logout();\n          },\n        },\n      ]\n    );\n  };\n\n  const handleGPSFrequencyChange = () => {\n    const options = GPS_FREQUENCIES.map((f) => ({\n      text: `${f.label} - ${f.description}`,\n      onPress: () => updateSetting(\"gpsUpdateFrequency\", f.value as \"low\" | \"medium\" | \"high\"),\n    }));\n    options.push({ text: \"Cancel\", onPress: () => {} });\n\n    Alert.alert(\n      \"GPS Update Frequency\",\n      \"Choose how often GPS coordinates are recorded during trips.\",\n      options\n    );\n  };\n\n  const getCurrentFrequencyLabel = () => {\n    const freq = GPS_FREQUENCIES.find(\n      (f) => f.value === localSettings.gpsUpdateFrequency\n    );\n    return freq?.label || \"Medium\";\n  };\n\n  return (\n    <ScreenKeyboardAwareScrollView showsVerticalScrollIndicator={false}>\n      <View style={styles.avatarContainer}>\n        <Image\n          source={require(\"../assets/images/worker-avatar.png\")}\n          style={styles.avatar}\n          resizeMode=\"cover\"\n        />\n        {user ? (\n          <View style={styles.userInfo}>\n            <ThemedText type=\"h4\" style={styles.userName}>\n              {user.name}\n            </ThemedText>\n            <ThemedText\n              type=\"small\"\n              style={[styles.userDetail, { color: theme.textSecondary }]}\n            >\n              Employee ID: {user.employeeId}\n            </ThemedText>\n            <ThemedText\n              type=\"caption\"\n              style={[styles.userDetail, { color: theme.textSecondary }]}\n            >\n              {user.email}\n            </ThemedText>\n          </View>\n        ) : null}\n      </View>\n\n      <View\n        style={[\n          styles.section,\n          {\n            backgroundColor: theme.backgroundDefault,\n            borderColor: theme.backgroundSecondary,\n          },\n        ]}\n      >\n        <ThemedText type=\"small\" style={styles.sectionTitle}>\n          Personal Information\n        </ThemedText>\n\n        <View style={styles.infoRow}>\n          <View style={styles.infoItem}>\n            <ThemedText type=\"caption\" style={[styles.infoLabel, { color: theme.textSecondary }]}>\n              Name\n            </ThemedText>\n            <ThemedText type=\"body\">{user?.name || \"Not set\"}</ThemedText>\n          </View>\n        </View>\n\n        <View style={styles.infoRow}>\n          <View style={styles.infoItem}>\n            <ThemedText type=\"caption\" style={[styles.infoLabel, { color: theme.textSecondary }]}>\n              Employee ID\n            </ThemedText>\n            <ThemedText type=\"body\">{user?.employeeId || \"Not set\"}</ThemedText>\n          </View>\n        </View>\n\n        <View style={styles.infoRow}>\n          <View style={styles.infoItem}>\n            <ThemedText type=\"caption\" style={[styles.infoLabel, { color: theme.textSecondary }]}>\n              Email\n            </ThemedText>\n            <ThemedText type=\"body\">{user?.email || \"Not set\"}</ThemedText>\n          </View>\n        </View>\n      </View>\n\n      <View\n        style={[\n          styles.section,\n          {\n            backgroundColor: theme.backgroundDefault,\n            borderColor: theme.backgroundSecondary,\n          },\n        ]}\n      >\n        <ThemedText type=\"small\" style={styles.sectionTitle}>\n          Preferences\n        </ThemedText>\n\n        <SettingsItem\n          icon=\"globe\"\n          title=\"Use Kilometers\"\n          subtitle={localSettings.useKilometers ? \"Distance in km\" : \"Distance in miles\"}\n          switchValue={localSettings.useKilometers}\n          onSwitchChange={(value) => updateSetting(\"useKilometers\", value)}\n        />\n\n        <View style={styles.infoRow}>\n          <View style={styles.infoItem}>\n            <ThemedText type=\"caption\" style={[styles.infoLabel, { color: theme.textSecondary }]}>\n              Allowance Rate\n            </ThemedText>\n            <ThemedText type=\"body\">Rs 3.5 per kilometer (Fixed)</ThemedText>\n          </View>\n        </View>\n\n        <View style={styles.infoRow}>\n          <View style={styles.infoItem}>\n            <ThemedText type=\"caption\" style={[styles.infoLabel, { color: theme.textSecondary }]}>\n              GPS Update Frequency\n            </ThemedText>\n            <ThemedText type=\"body\">Medium (15 seconds) (Fixed)</ThemedText>\n          </View>\n        </View>\n      </View>\n\n      <Pressable\n        onPress={handleLogout}\n        style={({ pressed }) => [\n          styles.logoutButton,\n          {\n            backgroundColor: theme.backgroundSecondary,\n            borderColor: AppColors.secondary,\n            opacity: pressed ? 0.8 : 1,\n          },\n        ]}\n      >\n        <Feather name=\"log-out\" size={20} color={AppColors.secondary} />\n        <ThemedText\n          type=\"body\"\n          style={[styles.logoutButtonText, { color: AppColors.secondary }]}\n        >\n          Logout\n        </ThemedText>\n      </Pressable>\n\n      <View style={styles.footer}>\n        <ThemedText\n          type=\"caption\"\n          style={[styles.footerText, { color: theme.textSecondary }]}\n        >\n          RouteTracker v1.0.0\n        </ThemedText>\n        <ThemedText\n          type=\"caption\"\n          style={[styles.footerText, { color: theme.textSecondary }]}\n        >\n          GPS route tracking for field workers\n        </ThemedText>\n      </View>\n    </ScreenKeyboardAwareScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  avatarContainer: {\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  avatar: {\n    width: 100,\n    height: 100,\n    borderRadius: 50,\n  },\n  userInfo: {\n    alignItems: \"center\",\n    marginTop: Spacing.md,\n  },\n  userName: {\n    marginBottom: Spacing.xs,\n  },\n  userDetail: {\n    marginBottom: Spacing.xs,\n  },\n  section: {\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    borderWidth: 1,\n    marginBottom: Spacing.md,\n  },\n  sectionTitle: {\n    fontWeight: \"600\",\n    marginBottom: Spacing.md,\n    opacity: 0.7,\n    textTransform: \"uppercase\",\n    letterSpacing: 0.5,\n  },\n  infoRow: {\n    marginBottom: Spacing.md,\n  },\n  infoItem: {},\n  infoLabel: {\n    marginBottom: Spacing.xs,\n  },\n  inputContainer: {\n    marginBottom: Spacing.md,\n  },\n  inputLabel: {\n    marginBottom: Spacing.xs,\n    opacity: 0.7,\n  },\n  input: {\n    height: Spacing.inputHeight,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.md,\n    fontSize: 16,\n    borderWidth: 1,\n  },\n  helperText: {\n    marginTop: Spacing.xs,\n    fontSize: 12,\n    fontStyle: \"italic\",\n  },\n  saveButton: {\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginTop: Spacing.sm,\n    marginBottom: Spacing.md,\n  },\n  saveButtonText: {\n    fontWeight: \"600\",\n  },\n  logoutButton: {\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    flexDirection: \"row\",\n    gap: Spacing.sm,\n    borderWidth: 1,\n    marginBottom: Spacing.md,\n  },\n  logoutButtonText: {\n    fontWeight: \"600\",\n  },\n  footer: {\n    alignItems: \"center\",\n    paddingVertical: Spacing.lg,\n  },\n  footerText: {\n    marginBottom: Spacing.xs,\n  },\n});\n","path":null,"size_bytes":9730,"size_tokens":null},"hooks/useColorScheme.ts":{"content":"export { useColorScheme } from \"react-native\";\n","path":null,"size_bytes":47,"size_tokens":null},"screens/ReportsScreen.tsx":{"content":"import React, { useState, useMemo, useCallback } from \"react\";\nimport { StyleSheet, View, Pressable, Alert, Platform, TextInput, Modal } from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { useFocusEffect } from \"@react-navigation/native\";\nimport { documentDirectory, cacheDirectory, writeAsStringAsync, getInfoAsync, EncodingType } from \"expo-file-system\";\nimport * as Sharing from \"expo-sharing\";\n\nimport { ScreenScrollView } from \"@/components/ScreenScrollView\";\nimport { StatCard } from \"@/components/StatCard\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { EmptyState } from \"@/components/EmptyState\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useTripContext } from \"@/context/TripContext\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\nimport { formatDistance, formatDuration, SiteVisit, Trip } from \"@/utils/storage\";\nimport { getAllSiteVisits, getTrips } from \"@/utils/dataAccess\";\n\ntype ReportType = \"current\" | \"dateRange\";\n\nfunction formatDateDDMMYYYY(timestamp: number): string {\n  const date = new Date(timestamp);\n  const day = String(date.getDate()).padStart(2, \"0\");\n  const month = String(date.getMonth() + 1).padStart(2, \"0\");\n  const year = date.getFullYear();\n  return `${day}-${month}-${year}`;\n}\n\nfunction parseDateDDMMYYYY(dateStr: string): number | null {\n  const parts = dateStr.split(\"-\");\n  if (parts.length !== 3) return null;\n  const [day, month, year] = parts.map(Number);\n  if (isNaN(day) || isNaN(month) || isNaN(year)) return null;\n  const date = new Date(year, month - 1, day);\n  return date.getTime();\n}\n\nexport default function ReportsScreen() {\n  const { theme } = useTheme();\n  const { trips, settings, loadData } = useTripContext();\n  const { user } = useAuth();\n  const [reportType, setReportType] = useState<ReportType>(\"current\");\n  const [startDate, setStartDate] = useState(formatDateDDMMYYYY(Date.now()));\n  const [endDate, setEndDate] = useState(formatDateDDMMYYYY(Date.now()));\n  const [isExporting, setIsExporting] = useState(false);\n  const [allSiteVisits, setAllSiteVisits] = useState<SiteVisit[]>([]);\n  const [showDateModal, setShowDateModal] = useState(false);\n  const [tempStartDate, setTempStartDate] = useState(\"\");\n  const [tempEndDate, setTempEndDate] = useState(\"\");\n\n  useFocusEffect(\n    useCallback(() => {\n      loadData();\n      loadSiteVisits();\n    }, [loadData])\n  );\n\n  const loadSiteVisits = async () => {\n    const visits = await getAllSiteVisits();\n    setAllSiteVisits(visits);\n  };\n\n  const getDateRangeBounds = useCallback(() => {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const todayStart = today.getTime();\n    const todayEnd = todayStart + 24 * 60 * 60 * 1000 - 1;\n\n    if (reportType === \"current\") {\n      return { start: todayStart, end: todayEnd };\n    }\n\n    const start = parseDateDDMMYYYY(startDate);\n    const end = parseDateDDMMYYYY(endDate);\n    \n    if (start && end) {\n      return { \n        start, \n        end: end + 24 * 60 * 60 * 1000 - 1 \n      };\n    }\n\n    return { start: todayStart, end: todayEnd };\n  }, [reportType, startDate, endDate]);\n\n  const filteredTrips = useMemo(() => {\n    const { start, end } = getDateRangeBounds();\n    return trips.filter((t) => t.startTime >= start && t.startTime <= end);\n  }, [trips, getDateRangeBounds]);\n\n  const filteredSiteVisits = useMemo(() => {\n    const { start, end } = getDateRangeBounds();\n    return allSiteVisits.filter(\n      (v) => v.arrivalTime >= start && v.arrivalTime <= end\n    );\n  }, [allSiteVisits, getDateRangeBounds]);\n\n  const stats = useMemo(() => {\n    const completedTrips = filteredTrips.filter(t => t.endTime && !t.isActive);\n    \n    const totalDistance = filteredTrips.reduce(\n      (sum, t) => sum + t.totalDistance,\n      0\n    );\n    const totalTrips = filteredTrips.length;\n    const avgDistance = totalTrips > 0 ? totalDistance / totalTrips : 0;\n\n    const rate = settings.allowanceRate || 3.5;\n    const totalAllowance = totalDistance * rate;\n\n    const totalDuration = completedTrips.reduce((sum, t) => {\n      return sum + (t.endTime! - t.startTime);\n    }, 0);\n\n    const completedCount = completedTrips.length;\n    const avgDuration = completedCount > 0 ? totalDuration / completedCount : 0;\n\n    return { totalDistance, totalTrips, avgDistance, totalAllowance, totalDuration, avgDuration };\n  }, [filteredTrips, settings]);\n\n  const dailyStats = useMemo(() => {\n    const days: { [key: string]: number } = {};\n\n    filteredTrips.forEach((trip) => {\n      const date = new Date(trip.startTime);\n      const key = `${date.getMonth() + 1}/${date.getDate()}`;\n      days[key] = (days[key] || 0) + trip.totalDistance;\n    });\n\n    const entries = Object.entries(days)\n      .sort((a, b) => {\n        const [am, ad] = a[0].split(\"/\").map(Number);\n        const [bm, bd] = b[0].split(\"/\").map(Number);\n        return am - bm || ad - bd;\n      })\n      .slice(-7);\n\n    const maxDistance = Math.max(...entries.map(([_, d]) => d), 1);\n\n    return { entries, maxDistance };\n  }, [filteredTrips]);\n\n  const generateExcelContent = async (): Promise<string> => {\n    const allTrips = await getTrips();\n    const allVisits = await getAllSiteVisits();\n    const { start, end } = getDateRangeBounds();\n\n    const rangeTrips = allTrips.filter(\n      (t) => t.startTime >= start && t.startTime <= end\n    );\n\n    const employeeName = user?.name || \"Unknown\";\n    const employeeCode = user?.employeeId || \"Unknown\";\n    const rate = settings.allowanceRate || 3.5;\n\n    let csv = `Employee Name,${employeeName},Employee Code,${employeeCode}\\n`;\n    csv += `Sr.No,Date,Scheme Name,Scheme Number,ESR Details,Village,Issue Reported,Resolution,Current Status,LAT,LONG,Km,Rate\\n`;\n\n    let srNo = 1;\n    \n    for (const trip of rangeTrips) {\n      const tripVisits = allVisits.filter((v) => v.tripId === trip.id);\n      const tripDate = formatDateDDMMYYYY(trip.startTime);\n\n      csv += `${srNo},${tripDate},Home,,,,,,,,${trip.startLatitude.toFixed(6)},${trip.startLongitude.toFixed(6)},0,\\n`;\n      srNo++;\n\n      for (const visit of tripVisits) {\n        const km = trip.totalDistance > 0 ? (trip.totalDistance / (tripVisits.length + 1)).toFixed(1) : \"0\";\n        const allowance = (parseFloat(km) * rate).toFixed(1);\n\n        csv += `${srNo},`;\n        csv += `${formatDateDDMMYYYY(visit.arrivalTime)},`;\n        csv += `\"${visit.schemeName || visit.siteName}\",`;\n        csv += `${visit.schemeNumber || \"\"},`;\n        csv += `\"${visit.esrDetails || \"\"}\",`;\n        csv += `\"${visit.village || \"\"}\",`;\n        csv += `\"${visit.issueReported || \"\"}\",`;\n        csv += `\"${visit.resolution || \"\"}\",`;\n        csv += `${visit.currentStatus || \"\"},`;\n        csv += `${visit.arrivalLatitude.toFixed(6)},`;\n        csv += `${visit.arrivalLongitude.toFixed(6)},`;\n        csv += `${km},`;\n        csv += `${allowance}\\n`;\n        srNo++;\n      }\n\n      if (trip.endTime) {\n        const endKm = (trip.totalDistance / (tripVisits.length + 1)).toFixed(1);\n        const endAllowance = (parseFloat(endKm) * rate).toFixed(1);\n        csv += `${srNo},${tripDate},Home,,,,,,,,${trip.endLatitude?.toFixed(6) || \"\"},${trip.endLongitude?.toFixed(6) || \"\"},${endKm},${endAllowance}\\n`;\n        srNo++;\n      }\n    }\n\n    return csv;\n  };\n\n  const downloadCSVWeb = (csvContent: string, fileName: string) => {\n    const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.setAttribute(\"href\", url);\n    link.setAttribute(\"download\", fileName);\n    link.style.visibility = \"hidden\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n  };\n\n  const handleExportCSV = useCallback(async () => {\n    if (reportType === \"dateRange\") {\n      const start = parseDateDDMMYYYY(startDate);\n      const end = parseDateDDMMYYYY(endDate);\n      \n      if (!start || !end) {\n        Alert.alert(\"Invalid Date\", \"Please enter valid dates in DD-MM-YYYY format.\");\n        return;\n      }\n\n      if (start > end) {\n        Alert.alert(\"Invalid Date Range\", \"Start date must be before end date.\");\n        return;\n      }\n    }\n\n    setIsExporting(true);\n    try {\n      const csvContent = await generateExcelContent();\n      \n      if (!csvContent || csvContent.trim().length === 0) {\n        Alert.alert(\"No Data\", \"There is no trip data to export for the selected date range.\");\n        return;\n      }\n      \n      const dateStr = reportType === \"current\" \n        ? formatDateDDMMYYYY(Date.now()).replace(/-/g, \"\")\n        : `${startDate.replace(/-/g, \"\")}_to_${endDate.replace(/-/g, \"\")}`;\n      \n      const fileName = `trip-report-${dateStr}.csv`;\n      \n      if (Platform.OS === \"web\") {\n        downloadCSVWeb(csvContent, fileName);\n        Alert.alert(\"Success\", \"Your trip report has been downloaded.\");\n        return;\n      }\n      \n      const fileDir = documentDirectory || cacheDirectory;\n      if (!fileDir) {\n        Alert.alert(\n          \"Export Failed\", \n          \"Unable to access file system. Please try using the Expo Go app on your mobile device, or access this feature from a web browser.\",\n          [{ text: \"OK\" }]\n        );\n        return;\n      }\n      \n      const filePath = `${fileDir}${fileName}`;\n\n      await writeAsStringAsync(filePath, csvContent, {\n        encoding: EncodingType.UTF8,\n      });\n\n      const fileInfo = await getInfoAsync(filePath);\n      if (!fileInfo.exists) {\n        Alert.alert(\"Export Failed\", \"Failed to create the export file.\");\n        return;\n      }\n\n      const canShare = await Sharing.isAvailableAsync();\n      if (canShare) {\n        await Sharing.shareAsync(filePath, {\n          mimeType: \"text/csv\",\n          dialogTitle: \"Export Trip Report\",\n          UTI: \"public.comma-separated-values-text\",\n        });\n      } else {\n        Alert.alert(\n          \"Sharing Not Available\",\n          \"File sharing is not available on this device. The report was generated but cannot be shared.\",\n          [{ text: \"OK\" }]\n        );\n      }\n    } catch (error) {\n      console.error(\"Export error:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Unknown error\";\n      Alert.alert(\"Export Failed\", `There was an error exporting your trip data: ${errorMessage}`);\n    } finally {\n      setIsExporting(false);\n    }\n  }, [reportType, startDate, endDate, settings, user]);\n\n  const openDateModal = () => {\n    setTempStartDate(startDate);\n    setTempEndDate(endDate);\n    setShowDateModal(true);\n  };\n\n  const applyDateRange = () => {\n    const start = parseDateDDMMYYYY(tempStartDate);\n    const end = parseDateDDMMYYYY(tempEndDate);\n    \n    if (!start || !end) {\n      Alert.alert(\"Invalid Date\", \"Please enter valid dates in DD-MM-YYYY format.\");\n      return;\n    }\n\n    if (start > end) {\n      Alert.alert(\"Invalid Date Range\", \"Start date must be before end date.\");\n      return;\n    }\n\n    setStartDate(tempStartDate);\n    setEndDate(tempEndDate);\n    setShowDateModal(false);\n  };\n\n  const ReportTypeButton = ({\n    value,\n    label,\n  }: {\n    value: ReportType;\n    label: string;\n  }) => (\n    <Pressable\n      onPress={() => setReportType(value)}\n      style={[\n        styles.rangeButton,\n        {\n          backgroundColor:\n            reportType === value\n              ? AppColors.primary\n              : theme.backgroundSecondary,\n        },\n      ]}\n    >\n      <ThemedText\n        type=\"small\"\n        style={[\n          styles.rangeButtonText,\n          { color: reportType === value ? \"#FFFFFF\" : theme.text },\n        ]}\n      >\n        {label}\n      </ThemedText>\n    </Pressable>\n  );\n\n  if (trips.length === 0) {\n    return (\n      <ScreenScrollView>\n        <EmptyState\n          icon=\"bar-chart-2\"\n          title=\"No Reports Yet\"\n          message=\"Complete some trips to see your travel reports and statistics here.\"\n        />\n      </ScreenScrollView>\n    );\n  }\n\n  return (\n    <ScreenScrollView showsVerticalScrollIndicator={false}>\n      <View style={styles.rangeContainer}>\n        <ReportTypeButton value=\"current\" label=\"Current Date\" />\n        <ReportTypeButton value=\"dateRange\" label=\"Date Range\" />\n      </View>\n\n      {reportType === \"dateRange\" ? (\n        <Pressable\n          onPress={openDateModal}\n          style={[\n            styles.dateRangeDisplay,\n            {\n              backgroundColor: theme.backgroundDefault,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n        >\n          <Feather name=\"calendar\" size={20} color={theme.textSecondary} />\n          <ThemedText type=\"body\">\n            {startDate} to {endDate}\n          </ThemedText>\n          <Feather name=\"edit-2\" size={16} color={theme.textSecondary} />\n        </Pressable>\n      ) : (\n        <View\n          style={[\n            styles.dateRangeDisplay,\n            {\n              backgroundColor: theme.backgroundDefault,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n        >\n          <Feather name=\"calendar\" size={20} color={theme.textSecondary} />\n          <ThemedText type=\"body\">\n            Today: {formatDateDDMMYYYY(Date.now())}\n          </ThemedText>\n        </View>\n      )}\n\n      <View style={styles.statsGrid}>\n        <View style={styles.statsRow}>\n          <StatCard\n            title=\"Total Distance\"\n            value={formatDistance(stats.totalDistance, settings.useKilometers)}\n            icon=\"navigation\"\n            iconColor={AppColors.primary}\n          />\n          <View style={styles.statSpacer} />\n          <StatCard\n            title=\"Total Allowance\"\n            value={`Rs ${stats.totalAllowance.toFixed(2)}`}\n            icon=\"credit-card\"\n            iconColor={AppColors.accent}\n          />\n        </View>\n        <View style={styles.statsRow}>\n          <StatCard\n            title=\"Trips\"\n            value={stats.totalTrips.toString()}\n            icon=\"map\"\n            iconColor={AppColors.warning}\n          />\n          <View style={styles.statSpacer} />\n          <StatCard\n            title=\"Site Visits\"\n            value={filteredSiteVisits.length.toString()}\n            icon=\"map-pin\"\n            iconColor={AppColors.error}\n          />\n        </View>\n        <View style={styles.statsRow}>\n          <StatCard\n            title=\"Total Time\"\n            value={formatDuration(0, stats.totalDuration)}\n            icon=\"clock\"\n            iconColor={AppColors.info}\n          />\n          <View style={styles.statSpacer} />\n          <StatCard\n            title=\"Avg Distance\"\n            value={formatDistance(stats.avgDistance, settings.useKilometers)}\n            icon=\"trending-up\"\n            iconColor={AppColors.secondary}\n          />\n        </View>\n        <View style={styles.statsRow}>\n          <StatCard\n            title=\"Avg Trip Time\"\n            value={formatDuration(0, stats.avgDuration)}\n            icon=\"watch\"\n            iconColor={AppColors.primary}\n          />\n          <View style={styles.statSpacer} />\n          <StatCard\n            title=\"Completed Trips\"\n            value={filteredTrips.filter(t => t.endTime && !t.isActive).length.toString()}\n            icon=\"check-circle\"\n            iconColor={AppColors.success}\n          />\n        </View>\n      </View>\n\n      {dailyStats.entries.length > 0 ? (\n        <View\n          style={[\n            styles.chartContainer,\n            {\n              backgroundColor: theme.backgroundDefault,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n        >\n          <ThemedText type=\"h4\" style={styles.chartTitle}>\n            Daily Distance\n          </ThemedText>\n          <View style={styles.chart}>\n            {dailyStats.entries.map(([day, distance]) => {\n              const height =\n                (distance / dailyStats.maxDistance) * 100;\n              return (\n                <View key={day} style={styles.barContainer}>\n                  <View style={styles.barWrapper}>\n                    <View\n                      style={[\n                        styles.bar,\n                        {\n                          height: `${Math.max(height, 5)}%`,\n                          backgroundColor: AppColors.primary,\n                        },\n                      ]}\n                    />\n                  </View>\n                  <ThemedText\n                    type=\"caption\"\n                    style={[styles.barLabel, { color: theme.textSecondary }]}\n                  >\n                    {day}\n                  </ThemedText>\n                </View>\n              );\n            })}\n          </View>\n        </View>\n      ) : null}\n\n      <Pressable\n        onPress={handleExportCSV}\n        disabled={isExporting || filteredTrips.length === 0}\n        style={({ pressed }) => [\n          styles.exportButton,\n          {\n            backgroundColor: isExporting\n              ? theme.backgroundSecondary\n              : AppColors.primary,\n            opacity: pressed ? 0.8 : 1,\n          },\n        ]}\n      >\n        <Feather\n          name={isExporting ? \"loader\" : \"download\"}\n          size={20}\n          color=\"#FFFFFF\"\n        />\n        <ThemedText style={styles.exportButtonText}>\n          {isExporting ? \"Exporting...\" : \"Download Excel Report\"}\n        </ThemedText>\n      </Pressable>\n\n      {filteredTrips.length === 0 ? (\n        <View\n          style={[\n            styles.noDataContainer,\n            { backgroundColor: theme.backgroundSecondary },\n          ]}\n        >\n          <Feather name=\"info\" size={20} color={theme.textSecondary} />\n          <ThemedText\n            type=\"small\"\n            style={[styles.noDataText, { color: theme.textSecondary }]}\n          >\n            No trips found for the selected date range.\n          </ThemedText>\n        </View>\n      ) : null}\n\n      <Modal\n        visible={showDateModal}\n        transparent\n        animationType=\"fade\"\n        onRequestClose={() => setShowDateModal(false)}\n      >\n        <Pressable\n          style={styles.modalOverlay}\n          onPress={() => setShowDateModal(false)}\n        >\n          <Pressable\n            style={[\n              styles.modalContent,\n              { backgroundColor: theme.backgroundDefault },\n            ]}\n            onPress={(e) => e.stopPropagation()}\n          >\n            <ThemedText type=\"h4\" style={styles.modalTitle}>\n              Select Date Range\n            </ThemedText>\n\n            <View style={styles.modalInputContainer}>\n              <ThemedText type=\"caption\" style={styles.modalInputLabel}>\n                Start Date (DD-MM-YYYY)\n              </ThemedText>\n              <TextInput\n                style={[\n                  styles.modalInput,\n                  {\n                    backgroundColor: theme.backgroundSecondary,\n                    color: theme.text,\n                    borderColor: theme.backgroundTertiary,\n                  },\n                ]}\n                value={tempStartDate}\n                onChangeText={setTempStartDate}\n                placeholder=\"DD-MM-YYYY\"\n                placeholderTextColor={theme.textSecondary}\n                keyboardType=\"numbers-and-punctuation\"\n              />\n            </View>\n\n            <View style={styles.modalInputContainer}>\n              <ThemedText type=\"caption\" style={styles.modalInputLabel}>\n                End Date (DD-MM-YYYY)\n              </ThemedText>\n              <TextInput\n                style={[\n                  styles.modalInput,\n                  {\n                    backgroundColor: theme.backgroundSecondary,\n                    color: theme.text,\n                    borderColor: theme.backgroundTertiary,\n                  },\n                ]}\n                value={tempEndDate}\n                onChangeText={setTempEndDate}\n                placeholder=\"DD-MM-YYYY\"\n                placeholderTextColor={theme.textSecondary}\n                keyboardType=\"numbers-and-punctuation\"\n              />\n            </View>\n\n            <View style={styles.modalButtons}>\n              <Pressable\n                onPress={() => setShowDateModal(false)}\n                style={[\n                  styles.modalButton,\n                  { backgroundColor: theme.backgroundSecondary },\n                ]}\n              >\n                <ThemedText type=\"body\">Cancel</ThemedText>\n              </Pressable>\n              <Pressable\n                onPress={applyDateRange}\n                style={[\n                  styles.modalButton,\n                  { backgroundColor: AppColors.primary },\n                ]}\n              >\n                <ThemedText type=\"body\" style={{ color: \"#FFFFFF\" }}>\n                  Apply\n                </ThemedText>\n              </Pressable>\n            </View>\n          </Pressable>\n        </Pressable>\n      </Modal>\n    </ScreenScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  rangeContainer: {\n    flexDirection: \"row\",\n    marginBottom: Spacing.md,\n    gap: Spacing.sm,\n  },\n  rangeButton: {\n    flex: 1,\n    paddingVertical: Spacing.sm,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n  },\n  rangeButtonText: {\n    fontWeight: \"600\",\n  },\n  dateRangeDisplay: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.sm,\n    padding: Spacing.md,\n    borderRadius: BorderRadius.sm,\n    borderWidth: 1,\n    marginBottom: Spacing.lg,\n  },\n  statsGrid: {\n    gap: Spacing.md,\n    marginBottom: Spacing.lg,\n  },\n  statsRow: {\n    flexDirection: \"row\",\n  },\n  statSpacer: {\n    width: Spacing.md,\n  },\n  chartContainer: {\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    borderWidth: 1,\n    marginBottom: Spacing.lg,\n  },\n  chartTitle: {\n    marginBottom: Spacing.md,\n  },\n  chart: {\n    flexDirection: \"row\",\n    height: 150,\n    alignItems: \"flex-end\",\n    justifyContent: \"space-between\",\n  },\n  barContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    marginHorizontal: 2,\n  },\n  barWrapper: {\n    flex: 1,\n    width: \"80%\",\n    justifyContent: \"flex-end\",\n  },\n  bar: {\n    width: \"100%\",\n    borderRadius: BorderRadius.xs,\n    minHeight: 4,\n  },\n  barLabel: {\n    marginTop: Spacing.xs,\n    fontSize: 10,\n  },\n  exportButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n    marginBottom: Spacing.lg,\n  },\n  exportButtonText: {\n    color: \"#FFFFFF\",\n    fontWeight: \"600\",\n    fontSize: 16,\n  },\n  noDataContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.sm,\n  },\n  noDataText: {\n    textAlign: \"center\",\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: Spacing.lg,\n  },\n  modalContent: {\n    width: \"100%\",\n    maxWidth: 400,\n    padding: Spacing.lg,\n    borderRadius: BorderRadius.md,\n  },\n  modalTitle: {\n    marginBottom: Spacing.lg,\n    textAlign: \"center\",\n  },\n  modalInputContainer: {\n    marginBottom: Spacing.md,\n  },\n  modalInputLabel: {\n    marginBottom: Spacing.xs,\n    opacity: 0.7,\n  },\n  modalInput: {\n    height: Spacing.inputHeight,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.md,\n    fontSize: 16,\n    borderWidth: 1,\n  },\n  modalButtons: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n    marginTop: Spacing.md,\n  },\n  modalButton: {\n    flex: 1,\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n});\n","path":null,"size_bytes":23758,"size_tokens":null},"scripts/build.js":{"content":"const fs = require(\"fs\");\nconst path = require(\"path\");\nconst { spawn } = require(\"child_process\");\nconst { Readable } = require(\"stream\");\nconst { pipeline } = require(\"stream/promises\");\n\nlet metroProcess = null;\n\nfunction exitWithError(message) {\n  console.error(message);\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(1);\n}\n\nfunction setupSignalHandlers() {\n  const cleanup = () => {\n    if (metroProcess) {\n      console.log(\"Cleaning up Metro process...\");\n      metroProcess.kill();\n    }\n    process.exit(0);\n  };\n\n  process.on(\"SIGINT\", cleanup);\n  process.on(\"SIGTERM\", cleanup);\n  process.on(\"SIGHUP\", cleanup);\n}\n\nfunction getDeploymentUrl() {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    console.log(\"Using REPLIT_INTERNAL_APP_DOMAIN:\", url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    console.log(\"Using REPLIT_DEV_DOMAIN:\", url);\n    return url;\n  }\n\n  console.error(\n    \"ERROR: REPLIT_INTERNAL_APP_DOMAIN and REPLIT_DEV_DOMAIN not set\",\n  );\n  process.exit(1);\n}\n\nfunction prepareDirectories(timestamp) {\n  console.log(\"Preparing build directories...\");\n\n  if (fs.existsSync(\"static-build\")) {\n    fs.rmSync(\"static-build\", { recursive: true });\n  }\n\n  const dirs = [\n    path.join(\"static-build\", timestamp, \"_expo\", \"static\", \"js\", \"ios\"),\n    path.join(\"static-build\", timestamp, \"_expo\", \"static\", \"js\", \"android\"),\n    path.join(\"static-build\", \"ios\"),\n    path.join(\"static-build\", \"android\"),\n  ];\n\n  for (const dir of dirs) {\n    fs.mkdirSync(dir, { recursive: true });\n  }\n\n  console.log(\"Build:\", timestamp);\n}\n\nfunction clearMetroCache() {\n  console.log(\"Clearing Metro cache...\");\n\n  const cacheDirs = [\n    ...fs.globSync(\".metro-cache\"),\n    ...fs.globSync(\"node_modules/.cache/metro\"),\n  ];\n\n  for (const dir of cacheDirs) {\n    fs.rmSync(dir, { recursive: true, force: true });\n  }\n\n  console.log(\"Cache cleared\");\n}\n\nasync function checkMetroHealth() {\n  try {\n    const response = await fetch(\"http://localhost:8081/status\");\n    return response.ok;\n  } catch {\n    return false;\n  }\n}\n\nasync function startMetro() {\n  const isRunning = await checkMetroHealth();\n  if (isRunning) {\n    return;\n  }\n\n  console.log(\"Starting Metro...\");\n  metroProcess = spawn(\"npm\", [\"run\", \"dev\"], {\n    stdio: [\"ignore\", \"ignore\", \"ignore\"],\n    detached: false,\n  });\n\n  for (let i = 0; i < 30; i++) {\n    await new Promise((resolve) => setTimeout(resolve, 1000));\n    const healthy = await checkMetroHealth();\n    if (healthy) {\n      console.log(\"Metro ready\");\n      return;\n    }\n  }\n\n  console.error(\"Metro timeout\");\n  process.exit(1);\n}\n\nasync function downloadFile(url, outputPath) {\n  try {\n    const response = await fetch(url);\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const file = fs.createWriteStream(outputPath);\n    await pipeline(Readable.fromWeb(response.body), file);\n\n    const fileSize = fs.statSync(outputPath).size;\n\n    if (fileSize === 0) {\n      fs.unlinkSync(outputPath);\n      throw new Error(\"Downloaded file is empty\");\n    }\n  } catch (error) {\n    if (fs.existsSync(outputPath)) {\n      fs.unlinkSync(outputPath);\n    }\n    throw error;\n  }\n}\n\nasync function downloadBundle(platform, timestamp) {\n  const url = new URL(\"http://localhost:8081/index.bundle\");\n  url.searchParams.set(\"platform\", platform);\n  url.searchParams.set(\"dev\", \"false\");\n  url.searchParams.set(\"hot\", \"false\");\n  url.searchParams.set(\"lazy\", \"false\");\n  url.searchParams.set(\"minify\", \"true\");\n\n  const output = path.join(\n    \"static-build\",\n    timestamp,\n    \"_expo\",\n    \"static\",\n    \"js\",\n    platform,\n    \"bundle.js\",\n  );\n\n  try {\n    await downloadFile(url.toString(), output);\n  } catch (error) {\n    exitWithError(`Failed to download ${platform} bundle: ${error.message}`);\n  }\n}\n\nasync function downloadManifest(platform) {\n  const response = await fetch(\"http://localhost:8081/manifest\", {\n    headers: { \"expo-platform\": platform },\n  });\n\n  if (!response.ok) {\n    throw new Error(`HTTP ${response.status}`);\n  }\n\n  return await response.json();\n}\n\nasync function downloadBundlesAndManifests(timestamp) {\n  console.log(\"Downloading bundles and manifests...\");\n\n  try {\n    const [, , iosManifest, androidManifest] = await Promise.all([\n      downloadBundle(\"ios\", timestamp),\n      downloadBundle(\"android\", timestamp),\n      downloadManifest(\"ios\"),\n      downloadManifest(\"android\"),\n    ]);\n    console.log(\"Downloaded\");\n    return { ios: iosManifest, android: androidManifest };\n  } catch (error) {\n    exitWithError(`Download failed: ${error.message}`);\n  }\n}\n\nfunction extractAssets(timestamp) {\n  const bundles = {\n    ios: fs.readFileSync(\n      path.join(\n        \"static-build\",\n        timestamp,\n        \"_expo\",\n        \"static\",\n        \"js\",\n        \"ios\",\n        \"bundle.js\",\n      ),\n      \"utf-8\",\n    ),\n    android: fs.readFileSync(\n      path.join(\n        \"static-build\",\n        timestamp,\n        \"_expo\",\n        \"static\",\n        \"js\",\n        \"android\",\n        \"bundle.js\",\n      ),\n      \"utf-8\",\n    ),\n  };\n\n  const assetsMap = new Map();\n  const assetPattern =\n    /httpServerLocation:\"([^\"]+)\"[^}]*hash:\"([^\"]+)\"[^}]*name:\"([^\"]+)\"[^}]*type:\"([^\"]+)\"/g;\n\n  const extractFromBundle = (bundle, platform) => {\n    for (const match of bundle.matchAll(assetPattern)) {\n      const originalPath = match[1];\n      const filename = match[3] + \".\" + match[4];\n\n      const tempUrl = new URL(`http://localhost:8081${originalPath}`);\n      const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n      if (!unstablePath) {\n        throw new Error(`Asset missing unstable_path: ${originalPath}`);\n      }\n\n      const decodedPath = decodeURIComponent(unstablePath).replace(/^\\.\\//, \"\");\n      const key = path.posix.join(decodedPath, filename);\n\n      if (!assetsMap.has(key)) {\n        const asset = {\n          url: path.posix.join(\"/\", decodedPath, filename),\n          originalPath: originalPath,\n          filename: filename,\n          relativePath: decodedPath,\n          hash: match[2],\n          platforms: new Set(),\n        };\n\n        assetsMap.set(key, asset);\n      }\n      assetsMap.get(key).platforms.add(platform);\n    }\n  };\n\n  extractFromBundle(bundles.ios, \"ios\");\n  extractFromBundle(bundles.android, \"android\");\n\n  return Array.from(assetsMap.values());\n}\n\nasync function downloadAssets(assets, timestamp) {\n  if (assets.length === 0) {\n    return 0;\n  }\n\n  console.log(\"Downloading assets...\");\n  let successCount = 0;\n  const failures = [];\n\n  const downloadPromises = assets.map(async (asset) => {\n    const platform = Array.from(asset.platforms)[0];\n\n    const tempUrl = new URL(`http://localhost:8081${asset.originalPath}`);\n    const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n    if (!unstablePath) {\n      throw new Error(`Asset missing unstable_path: ${asset.originalPath}`);\n    }\n\n    const decodedPath = decodeURIComponent(unstablePath).replace(/^\\./, \"\");\n    const metroUrl = new URL(\n      `http://localhost:8081${path.posix.join(\"/assets\", decodedPath, asset.filename)}`,\n    );\n    metroUrl.searchParams.set(\"platform\", platform);\n    metroUrl.searchParams.set(\"hash\", asset.hash);\n\n    const outputDir = path.join(\n      \"static-build\",\n      timestamp,\n      \"_expo\",\n      \"static\",\n      \"js\",\n      asset.relativePath,\n    );\n    fs.mkdirSync(outputDir, { recursive: true });\n    const output = path.join(outputDir, asset.filename);\n\n    try {\n      await downloadFile(metroUrl.toString(), output);\n      successCount++;\n    } catch (error) {\n      failures.push({\n        filename: asset.filename,\n        error: error.message,\n        url: metroUrl.toString(),\n      });\n    }\n  });\n\n  await Promise.all(downloadPromises);\n\n  if (failures.length > 0) {\n    const errorMsg =\n      `Failed to download ${failures.length} asset(s):\\n` +\n      failures\n        .map((f) => `  - ${f.filename}: ${f.error} (${f.url})`)\n        .join(\"\\n\");\n    exitWithError(errorMsg);\n  }\n\n  console.log(`Downloaded ${successCount} assets`);\n  return successCount;\n}\n\nfunction updateBundleUrls(timestamp, baseUrl) {\n  const updateForPlatform = (platform) => {\n    const bundlePath = path.join(\n      \"static-build\",\n      timestamp,\n      \"_expo\",\n      \"static\",\n      \"js\",\n      platform,\n      \"bundle.js\",\n    );\n    let bundle = fs.readFileSync(bundlePath, \"utf-8\");\n\n    bundle = bundle.replace(\n      /httpServerLocation:\"(\\/[^\"]+)\"/g,\n      (_match, capturedPath) => {\n        const tempUrl = new URL(`http://localhost:8081${capturedPath}`);\n        const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n        if (!unstablePath) {\n          throw new Error(\n            `Asset missing unstable_path in bundle: ${capturedPath}`,\n          );\n        }\n\n        const decodedPath = decodeURIComponent(unstablePath).replace(\n          /^\\.\\//,\n          \"\",\n        );\n        return `httpServerLocation:\"${baseUrl}/${timestamp}/_expo/static/js/${decodedPath}\"`;\n      },\n    );\n\n    fs.writeFileSync(bundlePath, bundle);\n  };\n\n  updateForPlatform(\"ios\");\n  updateForPlatform(\"android\");\n  console.log(\"Updated bundle URLs\");\n}\n\nfunction updateManifests(manifests, timestamp, baseUrl, assetsByHash) {\n  const updateForPlatform = (platform, manifest) => {\n    if (!manifest.launchAsset || !manifest.extra) {\n      exitWithError(`Malformed manifest for ${platform}`);\n    }\n\n    manifest.launchAsset.url = `${baseUrl}/${timestamp}/_expo/static/js/${platform}/bundle.js`;\n    manifest.launchAsset.key = `bundle-${timestamp}`;\n    manifest.createdAt = new Date(\n      Number(timestamp.split(\"-\")[0]),\n    ).toISOString();\n    manifest.extra.expoClient.hostUri =\n      baseUrl.replace(\"https://\", \"\") + \"/\" + platform;\n    manifest.extra.expoGo.debuggerHost =\n      baseUrl.replace(\"https://\", \"\") + \"/\" + platform;\n    manifest.extra.expoGo.packagerOpts.dev = false;\n\n    if (manifest.assets && manifest.assets.length > 0) {\n      manifest.assets.forEach((asset) => {\n        if (!asset.url) return;\n\n        const hash = asset.hash;\n        if (!hash) return;\n\n        const assetInfo = assetsByHash.get(hash);\n        if (!assetInfo) return;\n\n        asset.url = `${baseUrl}/${timestamp}/_expo/static/js/${assetInfo.relativePath}/${assetInfo.filename}`;\n      });\n    }\n\n    fs.writeFileSync(\n      path.join(\"static-build\", platform, \"manifest.json\"),\n      JSON.stringify(manifest, null, 2),\n    );\n  };\n\n  updateForPlatform(\"ios\", manifests.ios);\n  updateForPlatform(\"android\", manifests.android);\n  console.log(\"Manifests updated\");\n}\n\nfunction createLandingPage(baseUrl) {\n  const expsUrl = baseUrl.replace(\"https://\", \"\");\n  const template = fs.readFileSync(\n    path.join(\"scripts\", \"landing-page-template.html\"),\n    \"utf-8\",\n  );\n\n  const html = template\n    .replace(/BASE_URL_PLACEHOLDER/g, baseUrl)\n    .replace(/EXPS_URL_PLACEHOLDER/g, expsUrl);\n\n  fs.writeFileSync(path.join(\"static-build\", \"index.html\"), html);\n  console.log(\"Complete\");\n}\n\nasync function main() {\n  console.log(\"Building static Expo Go deployment...\");\n\n  setupSignalHandlers();\n\n  const baseUrl = getDeploymentUrl();\n  const timestamp = `${Date.now()}-${process.pid}`;\n\n  prepareDirectories(timestamp);\n  clearMetroCache();\n\n  await startMetro();\n  const manifests = await downloadBundlesAndManifests(timestamp);\n\n  console.log(\"Processing assets...\");\n  const assets = extractAssets(timestamp);\n  console.log(\"Found\", assets.length, \"unique asset(s)\");\n\n  const assetsByHash = new Map();\n  for (const asset of assets) {\n    assetsByHash.set(asset.hash, {\n      relativePath: asset.relativePath,\n      filename: asset.filename,\n    });\n  }\n\n  const assetCount = await downloadAssets(assets, timestamp);\n\n  if (assetCount > 0) {\n    updateBundleUrls(timestamp, baseUrl);\n  }\n\n  console.log(\"Updating manifests and creating landing page...\");\n  updateManifests(manifests, timestamp, baseUrl, assetsByHash);\n  createLandingPage(baseUrl);\n\n  console.log(\"Build complete! Deploy to:\", baseUrl);\n\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(0);\n}\n\nmain().catch((error) => {\n  console.error(\"Build failed:\", error.message);\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(1);\n});\n","path":null,"size_bytes":12348,"size_tokens":null},"index.js":{"content":"import { registerRootComponent } from \"expo\";\n\nimport App from \"@/App\";\n\nregisterRootComponent(App);\n","path":null,"size_bytes":101,"size_tokens":null},"components/HeaderTitle.tsx":{"content":"import React from \"react\";\nimport { View, StyleSheet, Image } from \"react-native\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Spacing, AppColors } from \"@/constants/theme\";\n\ninterface HeaderTitleProps {\n  title: string;\n}\n\nexport function HeaderTitle({ title }: HeaderTitleProps) {\n  return (\n    <View style={styles.container}>\n      <Image\n        source={require(\"../assets/images/icon.png\")}\n        style={styles.icon}\n        resizeMode=\"contain\"\n      />\n      <ThemedText style={styles.title}>{title}</ThemedText>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"flex-start\",\n  },\n  icon: {\n    width: 28,\n    height: 28,\n    marginRight: Spacing.sm,\n    borderRadius: 6,\n  },\n  title: {\n    fontSize: 17,\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":861,"size_tokens":null},"components/StatCard.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, View, Pressable } from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\n\ninterface StatCardProps {\n  title: string;\n  value: string;\n  icon: keyof typeof Feather.glyphMap;\n  iconColor?: string;\n  onPress?: () => void;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function StatCard({\n  title,\n  value,\n  icon,\n  iconColor = AppColors.primary,\n  onPress,\n}: StatCardProps) {\n  const { theme } = useTheme();\n  const scale = useSharedValue(1);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    if (onPress) {\n      scale.value = withSpring(0.98, springConfig);\n    }\n  };\n\n  const handlePressOut = () => {\n    if (onPress) {\n      scale.value = withSpring(1, springConfig);\n    }\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      disabled={!onPress}\n      style={[\n        styles.card,\n        {\n          backgroundColor: theme.backgroundDefault,\n          borderColor: theme.backgroundSecondary,\n        },\n        animatedStyle,\n      ]}\n    >\n      <View style={[styles.iconContainer, { backgroundColor: `${iconColor}15` }]}>\n        <Feather name={icon} size={20} color={iconColor} />\n      </View>\n      <ThemedText type=\"caption\" style={styles.title}>\n        {title}\n      </ThemedText>\n      <ThemedText type=\"h3\" style={styles.value}>\n        {value}\n      </ThemedText>\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  card: {\n    flex: 1,\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    borderWidth: 1,\n  },\n  iconContainer: {\n    width: 36,\n    height: 36,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.sm,\n  },\n  title: {\n    opacity: 0.7,\n    marginBottom: Spacing.xs,\n  },\n  value: {\n    fontWeight: \"700\",\n  },\n});\n","path":null,"size_bytes":2445,"size_tokens":null},"babel.config.js":{"content":"module.exports = function (api) {\n  api.cache(true);\n  return {\n    presets: [\"babel-preset-expo\"],\n    plugins: [\n      [\n        \"module-resolver\",\n        {\n          root: [\"./\"],\n          alias: {\n            \"@\": \"./\",\n          },\n          extensions: [\".ios.js\", \".android.js\", \".js\", \".ts\", \".tsx\", \".json\"],\n        },\n      ],\n      \"react-native-reanimated/plugin\",\n    ],\n  };\n};\n","path":null,"size_bytes":395,"size_tokens":null},"components/ActiveTripCard.tsx":{"content":"import React, { useEffect } from \"react\";\nimport { StyleSheet, View } from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withRepeat,\n  withTiming,\n  Easing,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\nimport { formatDuration, formatDistance } from \"@/utils/storage\";\n\ninterface ActiveTripCardProps {\n  startTime: number;\n  distance: number;\n  useKilometers: boolean;\n}\n\nexport function ActiveTripCard({\n  startTime,\n  distance,\n  useKilometers,\n}: ActiveTripCardProps) {\n  const { theme, isDark } = useTheme();\n  const pulseOpacity = useSharedValue(1);\n  const [elapsedTime, setElapsedTime] = React.useState(\n    formatDuration(startTime)\n  );\n\n  useEffect(() => {\n    pulseOpacity.value = withRepeat(\n      withTiming(0.4, { duration: 1000, easing: Easing.inOut(Easing.ease) }),\n      -1,\n      true\n    );\n  }, [pulseOpacity]);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setElapsedTime(formatDuration(startTime));\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [startTime]);\n\n  const pulseStyle = useAnimatedStyle(() => ({\n    opacity: pulseOpacity.value,\n  }));\n\n  return (\n    <View\n      style={[\n        styles.card,\n        {\n          backgroundColor: isDark ? AppColors.accentLight + \"20\" : AppColors.accentLight,\n          borderColor: AppColors.accent,\n        },\n      ]}\n    >\n      <View style={styles.header}>\n        <View style={styles.statusContainer}>\n          <Animated.View style={[styles.pulseIndicator, pulseStyle]} />\n          <ThemedText\n            type=\"body\"\n            style={[styles.statusText, { color: AppColors.accent }]}\n          >\n            Trip in Progress\n          </ThemedText>\n        </View>\n        <View style={styles.durationContainer}>\n          <Feather name=\"clock\" size={14} color={AppColors.accent} />\n          <ThemedText\n            type=\"small\"\n            style={[styles.durationText, { color: AppColors.accent }]}\n          >\n            {elapsedTime}\n          </ThemedText>\n        </View>\n      </View>\n\n      <View style={styles.statsRow}>\n        <View style={styles.stat}>\n          <ThemedText type=\"caption\" style={styles.statLabel}>\n            Distance\n          </ThemedText>\n          <ThemedText type=\"h4\" style={styles.statValue}>\n            {formatDistance(distance, useKilometers)}\n          </ThemedText>\n        </View>\n        <View style={styles.stat}>\n          <ThemedText type=\"caption\" style={styles.statLabel}>\n            GPS Points\n          </ThemedText>\n          <View style={styles.gpsIndicator}>\n            <Feather name=\"navigation\" size={16} color={AppColors.primary} />\n            <ThemedText type=\"small\" style={styles.gpsText}>\n              Tracking\n            </ThemedText>\n          </View>\n        </View>\n      </View>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  card: {\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    borderWidth: 1,\n    marginBottom: Spacing.md,\n  },\n  header: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    marginBottom: Spacing.md,\n  },\n  statusContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  pulseIndicator: {\n    width: 10,\n    height: 10,\n    borderRadius: 5,\n    backgroundColor: AppColors.accent,\n    marginRight: Spacing.sm,\n  },\n  statusText: {\n    fontWeight: \"600\",\n  },\n  durationContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.xs,\n  },\n  durationText: {\n    fontWeight: \"500\",\n  },\n  statsRow: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n  },\n  stat: {\n    flex: 1,\n  },\n  statLabel: {\n    opacity: 0.7,\n    marginBottom: Spacing.xs,\n  },\n  statValue: {\n    fontWeight: \"600\",\n  },\n  gpsIndicator: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.xs,\n  },\n  gpsText: {\n    color: AppColors.primary,\n    fontWeight: \"500\",\n  },\n});\n","path":null,"size_bytes":4123,"size_tokens":null},"components/ScreenScrollView.tsx":{"content":"import { ScrollView, ScrollViewProps, StyleSheet } from \"react-native\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useScreenInsets } from \"@/hooks/useScreenInsets\";\nimport { Spacing } from \"@/constants/theme\";\n\nexport function ScreenScrollView({\n  children,\n  contentContainerStyle,\n  style,\n  ...scrollViewProps\n}: ScrollViewProps) {\n  const { theme } = useTheme();\n  const { paddingTop, paddingBottom, scrollInsetBottom } = useScreenInsets();\n\n  return (\n    <ScrollView\n      style={[\n        styles.container,\n        { backgroundColor: theme.backgroundRoot },\n        style,\n      ]}\n      contentContainerStyle={[\n        {\n          paddingTop,\n          paddingBottom,\n        },\n        styles.contentContainer,\n        contentContainerStyle,\n      ]}\n      scrollIndicatorInsets={{ bottom: scrollInsetBottom }}\n      keyboardShouldPersistTaps=\"handled\"\n      {...scrollViewProps}\n    >\n      {children}\n    </ScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  contentContainer: {\n    paddingHorizontal: Spacing.xl,\n  },\n});\n","path":null,"size_bytes":1085,"size_tokens":null},"components/TimelineEvent.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, View, Pressable } from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { Image } from \"expo-image\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\nimport { formatTime } from \"@/utils/storage\";\n\nexport type EventType =\n  | \"start\"\n  | \"end\"\n  | \"site_arrival\"\n  | \"site_departure\"\n  | \"current\";\n\ninterface TimelineEventProps {\n  type: EventType;\n  time: number;\n  title: string;\n  subtitle?: string;\n  photoUri?: string;\n  isLast?: boolean;\n  onPhotoPress?: (uri: string) => void;\n}\n\nconst getEventConfig = (type: EventType) => {\n  switch (type) {\n    case \"start\":\n      return {\n        icon: \"home\" as const,\n        color: AppColors.primary,\n        label: \"Left Home\",\n      };\n    case \"end\":\n      return {\n        icon: \"flag\" as const,\n        color: AppColors.secondary,\n        label: \"Returned Home\",\n      };\n    case \"site_arrival\":\n      return {\n        icon: \"log-in\" as const,\n        color: AppColors.accent,\n        label: \"Arrived\",\n      };\n    case \"site_departure\":\n      return {\n        icon: \"log-out\" as const,\n        color: AppColors.warning,\n        label: \"Departed\",\n      };\n    case \"current\":\n      return {\n        icon: \"navigation\" as const,\n        color: AppColors.accent,\n        label: \"Current\",\n      };\n  }\n};\n\nexport function TimelineEvent({\n  type,\n  time,\n  title,\n  subtitle,\n  photoUri,\n  isLast = false,\n  onPhotoPress,\n}: TimelineEventProps) {\n  const { theme } = useTheme();\n  const config = getEventConfig(type);\n\n  const handlePhotoPress = () => {\n    if (photoUri && onPhotoPress) {\n      onPhotoPress(photoUri);\n    }\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.indicator}>\n        <View\n          style={[\n            styles.dot,\n            { backgroundColor: config.color, borderColor: config.color },\n          ]}\n        >\n          <Feather name={config.icon} size={12} color=\"#FFFFFF\" />\n        </View>\n        {!isLast ? (\n          <View\n            style={[styles.line, { backgroundColor: theme.backgroundSecondary }]}\n          />\n        ) : null}\n      </View>\n\n      <View style={styles.content}>\n        <View style={styles.header}>\n          <ThemedText type=\"body\" style={styles.title}>\n            {title}\n          </ThemedText>\n          <ThemedText\n            type=\"caption\"\n            style={[styles.time, { color: theme.textSecondary }]}\n          >\n            {formatTime(time)}\n          </ThemedText>\n        </View>\n        {subtitle ? (\n          <ThemedText\n            type=\"small\"\n            style={[styles.subtitle, { color: theme.textSecondary }]}\n          >\n            {subtitle}\n          </ThemedText>\n        ) : null}\n        {photoUri ? (\n          <Pressable\n            onPress={handlePhotoPress}\n            style={({ pressed }) => [\n              styles.photoContainer,\n              { opacity: pressed && onPhotoPress ? 0.8 : 1 },\n            ]}\n          >\n            <Image\n              source={{ uri: photoUri }}\n              style={styles.photo}\n              contentFit=\"cover\"\n            />\n            <View style={styles.photoOverlay}>\n              <Feather name=\"camera\" size={12} color=\"#FFFFFF\" />\n            </View>\n          </Pressable>\n        ) : null}\n      </View>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flexDirection: \"row\",\n    minHeight: 60,\n  },\n  indicator: {\n    width: 30,\n    alignItems: \"center\",\n  },\n  dot: {\n    width: 24,\n    height: 24,\n    borderRadius: 12,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderWidth: 2,\n  },\n  line: {\n    width: 2,\n    flex: 1,\n    marginTop: Spacing.xs,\n    marginBottom: Spacing.xs,\n  },\n  content: {\n    flex: 1,\n    paddingLeft: Spacing.md,\n    paddingBottom: Spacing.md,\n  },\n  header: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n  },\n  title: {\n    fontWeight: \"500\",\n  },\n  time: {\n    fontWeight: \"500\",\n  },\n  subtitle: {\n    marginTop: Spacing.xs,\n  },\n  photoContainer: {\n    marginTop: Spacing.sm,\n    borderRadius: BorderRadius.sm,\n    overflow: \"hidden\",\n    width: 80,\n    height: 60,\n  },\n  photo: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n  photoOverlay: {\n    position: \"absolute\",\n    bottom: Spacing.xs,\n    right: Spacing.xs,\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n    borderRadius: 10,\n    width: 20,\n    height: 20,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n});\n","path":null,"size_bytes":4614,"size_tokens":null},"navigation/ReportsStackNavigator.tsx":{"content":"import React from \"react\";\nimport { createNativeStackNavigator } from \"@react-navigation/native-stack\";\nimport ReportsScreen from \"@/screens/ReportsScreen\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { getCommonScreenOptions } from \"@/navigation/screenOptions\";\n\nexport type ReportsStackParamList = {\n  Reports: undefined;\n};\n\nconst Stack = createNativeStackNavigator<ReportsStackParamList>();\n\nexport default function ReportsStackNavigator() {\n  const { theme, isDark } = useTheme();\n\n  return (\n    <Stack.Navigator screenOptions={getCommonScreenOptions({ theme, isDark })}>\n      <Stack.Screen\n        name=\"Reports\"\n        component={ReportsScreen}\n        options={{\n          title: \"Reports\",\n        }}\n      />\n    </Stack.Navigator>\n  );\n}\n","path":null,"size_bytes":760,"size_tokens":null},"components/TripMap.web.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, View } from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Trip } from \"@/utils/storage\";\nimport { Spacing, BorderRadius } from \"@/constants/theme\";\n\ninterface TripMapProps {\n  trip: Trip;\n  height?: number;\n}\n\nexport function TripMap({ height = 250 }: TripMapProps) {\n  const { theme } = useTheme();\n\n  return (\n    <View\n      style={[\n        styles.container,\n        { height, backgroundColor: theme.backgroundSecondary },\n      ]}\n    >\n      <View style={styles.fallback}>\n        <Feather name=\"map\" size={48} color={theme.textSecondary} />\n        <ThemedText\n          type=\"small\"\n          style={[styles.fallbackText, { color: theme.textSecondary }]}\n        >\n          Map view is available on mobile devices via Expo Go\n        </ThemedText>\n      </View>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    borderRadius: BorderRadius.md,\n    overflow: \"hidden\",\n    marginBottom: Spacing.lg,\n  },\n  fallback: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: Spacing.lg,\n  },\n  fallbackText: {\n    textAlign: \"center\",\n    marginTop: Spacing.md,\n  },\n});\n","path":null,"size_bytes":1300,"size_tokens":null},"utils/dataAccess.ts":{"content":"import { Platform } from \"react-native\";\nimport {\n  Trip,\n  GPSPoint,\n  SiteVisit,\n  UserSettings,\n  getTrips as getTripsAsync,\n  saveTrips as saveTripsAsync,\n  getActiveTrip as getActiveTripAsync,\n  saveActiveTrip as saveActiveTripAsync,\n  getGPSPoints as getGPSPointsAsync,\n  saveGPSPoint as saveGPSPointAsync,\n  clearGPSPointsForTrip as clearGPSPointsAsync,\n  getSiteVisits as getSiteVisitsAsync,\n  saveSiteVisit as saveSiteVisitAsync,\n  getAllSiteVisits as getAllSiteVisitsAsync,\n  getUserSettings as getUserSettingsAsync,\n  saveUserSettings as saveUserSettingsAsync,\n} from \"./storage\";\nimport {\n  initializeDatabase,\n  getTripsFromDB,\n  saveTripToDB,\n  deleteTripFromDB,\n  getActiveTripFromDB,\n  getGPSPointsFromDB,\n  saveGPSPointToDB,\n  clearGPSPointsFromDB,\n  getSiteVisitsFromDB,\n  saveSiteVisitToDB,\n  getAllSiteVisitsFromDB,\n  getUserSettingsFromDB,\n  saveUserSettingsToDB,\n  getTripsByDateRange as getTripsByDateRangeDB,\n  getTripStats as getTripStatsDB,\n  exportTripsToCSV as exportTripsToCSVDB,\n  getGPSPointCountForTrip as getGPSPointCountDB,\n  ExtendedUserSettings,\n} from \"./database\";\n\nconst isNative = Platform.OS !== \"web\";\nlet isDBInitialized = false;\nlet initializationPromise: Promise<boolean> | null = null;\n\nexport async function initializeDataLayer(): Promise<boolean> {\n  if (!isNative) return false;\n  \n  if (isDBInitialized) return true;\n  \n  if (!initializationPromise) {\n    initializationPromise = (async () => {\n      try {\n        await initializeDatabase();\n        isDBInitialized = true;\n        return true;\n      } catch (error) {\n        console.error(\"Failed to initialize SQLite database:\", error);\n        isDBInitialized = false;\n        initializationPromise = null;\n        return false;\n      }\n    })();\n  }\n  \n  return await initializationPromise;\n}\n\nfunction resetDBState(): void {\n  isDBInitialized = false;\n  initializationPromise = null;\n}\n\nasync function ensureDBInitialized(): Promise<boolean> {\n  if (!isNative) return false;\n  return await initializeDataLayer();\n}\n\nexport async function getTrips(): Promise<Trip[]> {\n  if (await ensureDBInitialized()) {\n    try {\n      return await getTripsFromDB();\n    } catch (error) {\n      console.error(\"SQLite getTrips failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  return getTripsAsync();\n}\n\nexport async function saveTrip(trip: Trip): Promise<void> {\n  if (await ensureDBInitialized()) {\n    try {\n      await saveTripToDB(trip);\n      return;\n    } catch (error) {\n      console.error(\"SQLite saveTrip failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  const trips = await getTripsAsync();\n  const existingIndex = trips.findIndex((t) => t.id === trip.id);\n  if (existingIndex >= 0) {\n    trips[existingIndex] = trip;\n  } else {\n    trips.push(trip);\n  }\n  await saveTripsAsync(trips);\n}\n\nexport async function saveTrips(trips: Trip[]): Promise<void> {\n  if (await ensureDBInitialized()) {\n    try {\n      for (const trip of trips) {\n        await saveTripToDB(trip);\n      }\n      return;\n    } catch (error) {\n      console.error(\"SQLite saveTrips failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  await saveTripsAsync(trips);\n}\n\nexport async function deleteTrip(tripId: string): Promise<void> {\n  if (await ensureDBInitialized()) {\n    try {\n      await deleteTripFromDB(tripId);\n      return;\n    } catch (error) {\n      console.error(\"SQLite deleteTrip failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  const trips = await getTripsAsync();\n  await saveTripsAsync(trips.filter((t) => t.id !== tripId));\n}\n\nexport async function getActiveTrip(): Promise<Trip | null> {\n  if (await ensureDBInitialized()) {\n    try {\n      return await getActiveTripFromDB();\n    } catch (error) {\n      console.error(\"SQLite getActiveTrip failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  return getActiveTripAsync();\n}\n\nexport async function saveActiveTrip(trip: Trip | null): Promise<void> {\n  if (await ensureDBInitialized()) {\n    try {\n      if (trip) {\n        await saveTripToDB(trip);\n      }\n      return;\n    } catch (error) {\n      console.error(\"SQLite saveActiveTrip failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  await saveActiveTripAsync(trip);\n}\n\nexport async function getGPSPoints(tripId: string): Promise<GPSPoint[]> {\n  if (await ensureDBInitialized()) {\n    try {\n      return await getGPSPointsFromDB(tripId);\n    } catch (error) {\n      console.error(\"SQLite getGPSPoints failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  return getGPSPointsAsync(tripId);\n}\n\nexport async function saveGPSPoint(point: GPSPoint): Promise<void> {\n  if (await ensureDBInitialized()) {\n    try {\n      await saveGPSPointToDB(point);\n      return;\n    } catch (error) {\n      console.error(\"SQLite saveGPSPoint failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  await saveGPSPointAsync(point);\n}\n\nexport async function clearGPSPointsForTrip(tripId: string): Promise<void> {\n  if (await ensureDBInitialized()) {\n    try {\n      await clearGPSPointsFromDB(tripId);\n      return;\n    } catch (error) {\n      console.error(\"SQLite clearGPSPoints failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  await clearGPSPointsAsync(tripId);\n}\n\nexport async function getSiteVisits(tripId: string): Promise<SiteVisit[]> {\n  if (await ensureDBInitialized()) {\n    try {\n      return await getSiteVisitsFromDB(tripId);\n    } catch (error) {\n      console.error(\"SQLite getSiteVisits failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  return getSiteVisitsAsync(tripId);\n}\n\nexport async function saveSiteVisit(visit: SiteVisit): Promise<void> {\n  if (await ensureDBInitialized()) {\n    try {\n      await saveSiteVisitToDB(visit);\n      return;\n    } catch (error) {\n      console.error(\"SQLite saveSiteVisit failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  await saveSiteVisitAsync(visit);\n}\n\nexport async function getAllSiteVisits(): Promise<SiteVisit[]> {\n  if (await ensureDBInitialized()) {\n    try {\n      return await getAllSiteVisitsFromDB();\n    } catch (error) {\n      console.error(\"SQLite getAllSiteVisits failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  return getAllSiteVisitsAsync();\n}\n\nexport async function getUserSettings(): Promise<ExtendedUserSettings> {\n  if (await ensureDBInitialized()) {\n    try {\n      return await getUserSettingsFromDB();\n    } catch (error) {\n      console.error(\"SQLite getUserSettings failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  const settings = await getUserSettingsAsync();\n  return {\n    ...settings,\n    allowanceRate: settings.allowanceRate || 3.5,\n    allowanceRatePerMile: 0.8,\n    minDistanceForAllowance: 0,\n    maxDailyAllowance: 0,\n  };\n}\n\nexport async function saveUserSettings(settings: ExtendedUserSettings): Promise<void> {\n  if (await ensureDBInitialized()) {\n    try {\n      await saveUserSettingsToDB(settings);\n      return;\n    } catch (error) {\n      console.error(\"SQLite saveUserSettings failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  await saveUserSettingsAsync(settings);\n}\n\nexport async function getTripsByDateRange(\n  startDate: number,\n  endDate: number\n): Promise<Trip[]> {\n  if (await ensureDBInitialized()) {\n    try {\n      return await getTripsByDateRangeDB(startDate, endDate);\n    } catch (error) {\n      console.error(\"SQLite getTripsByDateRange failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  const trips = await getTripsAsync();\n  return trips.filter(\n    (trip) => trip.startTime >= startDate && trip.startTime <= endDate\n  );\n}\n\nexport async function getTripStats(\n  startDate: number,\n  endDate: number\n): Promise<{\n  totalTrips: number;\n  totalDistance: number;\n  totalDuration: number;\n  totalSiteVisits: number;\n}> {\n  if (await ensureDBInitialized()) {\n    try {\n      return await getTripStatsDB(startDate, endDate);\n    } catch (error) {\n      console.error(\"SQLite getTripStats failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  const trips = await getTripsAsync();\n  const filteredTrips = trips.filter(\n    (trip) => trip.startTime >= startDate && trip.startTime <= endDate && !trip.isActive\n  );\n  \n  const allVisits = await getAllSiteVisitsAsync();\n  const tripIds = new Set(filteredTrips.map((t) => t.id));\n  const filteredVisits = allVisits.filter((v) => tripIds.has(v.tripId));\n\n  return {\n    totalTrips: filteredTrips.length,\n    totalDistance: filteredTrips.reduce((sum, t) => sum + t.totalDistance, 0),\n    totalDuration: filteredTrips.reduce((sum, t) => {\n      if (!t.endTime) return sum;\n      return sum + (t.endTime - t.startTime);\n    }, 0),\n    totalSiteVisits: filteredVisits.length,\n  };\n}\n\nexport async function exportTripsToCSV(\n  startDate: number,\n  endDate: number\n): Promise<string> {\n  if (await ensureDBInitialized()) {\n    try {\n      return await exportTripsToCSVDB(startDate, endDate);\n    } catch (error) {\n      console.error(\"SQLite exportTripsToCSV failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n\n  const trips = await getTripsAsync();\n  const settings = await getUserSettingsAsync();\n  const filteredTrips = trips.filter(\n    (trip) =>\n      trip.startTime >= startDate &&\n      trip.startTime <= endDate &&\n      !trip.isActive\n  );\n\n  let csv =\n    \"Trip ID,Date,Start Time,End Time,Duration (min),Distance (km),Distance (mi),Allowance ($),Start Lat,Start Lng,End Lat,End Lng,Site Visits\\n\";\n\n  for (const trip of filteredTrips) {\n    const startDateObj = new Date(trip.startTime);\n    const endDateObj = trip.endTime ? new Date(trip.endTime) : null;\n    const duration = trip.endTime\n      ? Math.round((trip.endTime - trip.startTime) / 60000)\n      : 0;\n    const distanceKm = trip.totalDistance;\n    const distanceMi = distanceKm * 0.621371;\n    const allowance = (settings.useKilometers ? distanceKm : distanceMi) * settings.allowanceRate;\n\n    const siteVisits = await getSiteVisitsAsync(trip.id);\n    const siteNames = siteVisits.map((v) => v.siteName).join(\"; \");\n\n    csv += `${trip.id},`;\n    csv += `${startDateObj.toLocaleDateString()},`;\n    csv += `${startDateObj.toLocaleTimeString()},`;\n    csv += `${endDateObj ? endDateObj.toLocaleTimeString() : \"\"},`;\n    csv += `${duration},`;\n    csv += `${distanceKm.toFixed(2)},`;\n    csv += `${distanceMi.toFixed(2)},`;\n    csv += `${allowance.toFixed(2)},`;\n    csv += `${trip.startLatitude},`;\n    csv += `${trip.startLongitude},`;\n    csv += `${trip.endLatitude || \"\"},`;\n    csv += `${trip.endLongitude || \"\"},`;\n    csv += `\"${siteNames}\"\\n`;\n  }\n\n  return csv;\n}\n\nexport async function getGPSPointCountForTrip(tripId: string): Promise<number> {\n  if (await ensureDBInitialized()) {\n    try {\n      return await getGPSPointCountDB(tripId);\n    } catch (error) {\n      console.error(\"SQLite getGPSPointCount failed, falling back:\", error);\n      resetDBState();\n    }\n  }\n  const points = await getGPSPointsAsync(tripId);\n  return points.length;\n}\n\nexport function calculateAllowance(\n  distanceKm: number,\n  settings: ExtendedUserSettings\n): number {\n  const distance = settings.useKilometers\n    ? distanceKm\n    : distanceKm * 0.621371;\n\n  if (\n    settings.minDistanceForAllowance &&\n    distance < settings.minDistanceForAllowance\n  ) {\n    return 0;\n  }\n\n  const rate = settings.useKilometers\n    ? settings.allowanceRate\n    : settings.allowanceRatePerMile ?? 0.8;\n\n  let allowance = distance * rate;\n\n  if (settings.maxDailyAllowance && settings.maxDailyAllowance > 0) {\n    allowance = Math.min(allowance, settings.maxDailyAllowance);\n  }\n\n  return allowance;\n}\n\nexport function formatAllowanceAdvanced(\n  distanceKm: number,\n  settings: ExtendedUserSettings\n): string {\n  const amount = calculateAllowance(distanceKm, settings);\n  return `Rs ${amount.toFixed(2)}`;\n}\n\nexport { ExtendedUserSettings };\n","path":null,"size_bytes":11858,"size_tokens":null},"utils/database.ts":{"content":"import * as SQLite from \"expo-sqlite\";\nimport { Platform } from \"react-native\";\nimport {\n  Trip,\n  GPSPoint,\n  SiteVisit,\n  UserSettings,\n  calculateTotalDistance,\n  generateId,\n} from \"./storage\";\n\nconst DATABASE_NAME = \"routetracker.db\";\n\nlet db: SQLite.SQLiteDatabase | null = null;\nlet isInitialized = false;\nlet initPromise: Promise<void> | null = null;\n\nexport async function getDatabase(): Promise<SQLite.SQLiteDatabase> {\n  if (Platform.OS === \"web\") {\n    throw new Error(\"SQLite is not supported on web platform\");\n  }\n  \n  if (!isInitialized) {\n    if (!initPromise) {\n      initPromise = initializeDatabase();\n    }\n    await initPromise;\n  }\n  \n  if (!db) {\n    db = await SQLite.openDatabaseAsync(DATABASE_NAME);\n  }\n  \n  return db;\n}\n\nexport async function initializeDatabase(): Promise<void> {\n  if (Platform.OS === \"web\") {\n    console.log(\"SQLite not available on web, using fallback storage\");\n    return;\n  }\n\n  if (isInitialized) {\n    return;\n  }\n\n  try {\n    if (!db) {\n      db = await SQLite.openDatabaseAsync(DATABASE_NAME);\n    }\n    const database = db;\n\n    // Create tables one at a time for better compatibility\n    await database.runAsync(`\n      CREATE TABLE IF NOT EXISTS trips (\n        id TEXT PRIMARY KEY,\n        startTime INTEGER NOT NULL,\n        endTime INTEGER,\n        startLatitude REAL NOT NULL,\n        startLongitude REAL NOT NULL,\n        endLatitude REAL,\n        endLongitude REAL,\n        totalDistance REAL NOT NULL DEFAULT 0,\n        isActive INTEGER NOT NULL DEFAULT 0\n      )\n    `);\n\n    await database.runAsync(`\n      CREATE TABLE IF NOT EXISTS gps_points (\n        id TEXT PRIMARY KEY,\n        tripId TEXT NOT NULL,\n        latitude REAL NOT NULL,\n        longitude REAL NOT NULL,\n        timestamp INTEGER NOT NULL,\n        accuracy REAL,\n        FOREIGN KEY (tripId) REFERENCES trips(id) ON DELETE CASCADE\n      )\n    `);\n\n    await database.runAsync(`\n      CREATE TABLE IF NOT EXISTS site_visits (\n        id TEXT PRIMARY KEY,\n        tripId TEXT NOT NULL,\n        siteName TEXT NOT NULL,\n        notes TEXT,\n        photoUri TEXT,\n        arrivalTime INTEGER NOT NULL,\n        arrivalLatitude REAL NOT NULL,\n        arrivalLongitude REAL NOT NULL,\n        departureTime INTEGER,\n        departureLatitude REAL,\n        departureLongitude REAL,\n        schemeName TEXT,\n        schemeNumber TEXT,\n        esrDetails TEXT,\n        village TEXT,\n        issueReported TEXT,\n        resolution TEXT,\n        currentStatus TEXT,\n        FOREIGN KEY (tripId) REFERENCES trips(id) ON DELETE CASCADE\n      )\n    `);\n\n    await database.runAsync(`\n      CREATE TABLE IF NOT EXISTS user_settings (\n        id INTEGER PRIMARY KEY DEFAULT 1,\n        workerName TEXT DEFAULT '',\n        workerId TEXT DEFAULT '',\n        useKilometers INTEGER DEFAULT 1,\n        allowanceRate REAL DEFAULT 3.5,\n        gpsUpdateFrequency TEXT DEFAULT 'medium',\n        allowanceRatePerMile REAL DEFAULT 0.8,\n        minDistanceForAllowance REAL DEFAULT 0,\n        maxDailyAllowance REAL DEFAULT 0\n      )\n    `);\n\n    await database.runAsync(\n      \"CREATE INDEX IF NOT EXISTS idx_gps_points_tripId ON gps_points(tripId)\"\n    );\n    await database.runAsync(\n      \"CREATE INDEX IF NOT EXISTS idx_site_visits_tripId ON site_visits(tripId)\"\n    );\n    await database.runAsync(\n      \"CREATE INDEX IF NOT EXISTS idx_trips_startTime ON trips(startTime)\"\n    );\n    await database.runAsync(\n      \"CREATE INDEX IF NOT EXISTS idx_trips_isActive ON trips(isActive)\"\n    );\n\n    // Initialize default settings\n    const settingsResult = await database.getFirstAsync<{ count: number }>(\n      \"SELECT COUNT(*) as count FROM user_settings\"\n    );\n    if (!settingsResult || settingsResult.count === 0) {\n      await database.runAsync(\n        \"INSERT INTO user_settings (id) VALUES (1)\"\n      );\n    }\n\n    isInitialized = true;\n    console.log(\"SQLite database initialized successfully\");\n  } catch (error) {\n    console.error(\"Failed to initialize SQLite database:\", error);\n    console.log(\"Falling back to AsyncStorage\");\n    db = null;\n    isInitialized = false;\n    initPromise = null;\n  }\n}\n\nexport async function getTripsFromDB(): Promise<Trip[]> {\n  const database = await getDatabase();\n  const trips = await database.getAllAsync<{\n    id: string;\n    startTime: number;\n    endTime: number | null;\n    startLatitude: number;\n    startLongitude: number;\n    endLatitude: number | null;\n    endLongitude: number | null;\n    totalDistance: number;\n    isActive: number;\n  }>(\"SELECT * FROM trips WHERE isActive = 0 ORDER BY startTime DESC\");\n\n  const result: Trip[] = [];\n  for (const trip of trips) {\n    const siteVisits = await database.getAllAsync<{ id: string }>(\n      \"SELECT id FROM site_visits WHERE tripId = ?\",\n      [trip.id]\n    );\n    result.push({\n      id: trip.id,\n      startTime: trip.startTime,\n      endTime: trip.endTime || undefined,\n      startLatitude: trip.startLatitude,\n      startLongitude: trip.startLongitude,\n      endLatitude: trip.endLatitude || undefined,\n      endLongitude: trip.endLongitude || undefined,\n      totalDistance: trip.totalDistance,\n      siteVisits: siteVisits.map((v) => v.id),\n      isActive: false,\n    });\n  }\n  return result;\n}\n\nexport async function saveTripToDB(trip: Trip): Promise<void> {\n  const database = await getDatabase();\n  await database.runAsync(\n    `INSERT OR REPLACE INTO trips \n     (id, startTime, endTime, startLatitude, startLongitude, endLatitude, endLongitude, totalDistance, isActive) \n     VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`,\n    [\n      trip.id,\n      trip.startTime,\n      trip.endTime || null,\n      trip.startLatitude,\n      trip.startLongitude,\n      trip.endLatitude || null,\n      trip.endLongitude || null,\n      trip.totalDistance,\n      trip.isActive ? 1 : 0,\n    ]\n  );\n}\n\nexport async function deleteTripFromDB(tripId: string): Promise<void> {\n  const database = await getDatabase();\n  await database.runAsync(\"DELETE FROM trips WHERE id = ?\", [tripId]);\n}\n\nexport async function getActiveTripFromDB(): Promise<Trip | null> {\n  const database = await getDatabase();\n  const trip = await database.getFirstAsync<{\n    id: string;\n    startTime: number;\n    endTime: number | null;\n    startLatitude: number;\n    startLongitude: number;\n    endLatitude: number | null;\n    endLongitude: number | null;\n    totalDistance: number;\n    isActive: number;\n  }>(\"SELECT * FROM trips WHERE isActive = 1 LIMIT 1\");\n\n  if (!trip) return null;\n\n  const siteVisits = await database.getAllAsync<{ id: string }>(\n    \"SELECT id FROM site_visits WHERE tripId = ?\",\n    [trip.id]\n  );\n\n  return {\n    id: trip.id,\n    startTime: trip.startTime,\n    endTime: trip.endTime || undefined,\n    startLatitude: trip.startLatitude,\n    startLongitude: trip.startLongitude,\n    endLatitude: trip.endLatitude || undefined,\n    endLongitude: trip.endLongitude || undefined,\n    totalDistance: trip.totalDistance,\n    siteVisits: siteVisits.map((v) => v.id),\n    isActive: true,\n  };\n}\n\nexport async function getGPSPointsFromDB(tripId: string): Promise<GPSPoint[]> {\n  const database = await getDatabase();\n  const points = await database.getAllAsync<{\n    id: string;\n    tripId: string;\n    latitude: number;\n    longitude: number;\n    timestamp: number;\n    accuracy: number | null;\n  }>(\n    \"SELECT * FROM gps_points WHERE tripId = ? ORDER BY timestamp ASC\",\n    [tripId]\n  );\n\n  return points.map((p) => ({\n    id: p.id,\n    tripId: p.tripId,\n    latitude: p.latitude,\n    longitude: p.longitude,\n    timestamp: p.timestamp,\n    accuracy: p.accuracy || undefined,\n  }));\n}\n\nexport async function saveGPSPointToDB(point: GPSPoint): Promise<void> {\n  const database = await getDatabase();\n  await database.runAsync(\n    `INSERT OR REPLACE INTO gps_points \n     (id, tripId, latitude, longitude, timestamp, accuracy) \n     VALUES (?, ?, ?, ?, ?, ?)`,\n    [\n      point.id,\n      point.tripId,\n      point.latitude,\n      point.longitude,\n      point.timestamp,\n      point.accuracy || null,\n    ]\n  );\n}\n\nexport async function clearGPSPointsFromDB(tripId: string): Promise<void> {\n  const database = await getDatabase();\n  await database.runAsync(\"DELETE FROM gps_points WHERE tripId = ?\", [tripId]);\n}\n\nexport async function getSiteVisitsFromDB(tripId: string): Promise<SiteVisit[]> {\n  const database = await getDatabase();\n  const visits = await database.getAllAsync<{\n    id: string;\n    tripId: string;\n    siteName: string;\n    notes: string | null;\n    photoUri: string | null;\n    arrivalTime: number;\n    arrivalLatitude: number;\n    arrivalLongitude: number;\n    departureTime: number | null;\n    departureLatitude: number | null;\n    departureLongitude: number | null;\n    schemeName: string | null;\n    schemeNumber: string | null;\n    esrDetails: string | null;\n    village: string | null;\n    issueReported: string | null;\n    resolution: string | null;\n    currentStatus: string | null;\n  }>(\n    \"SELECT * FROM site_visits WHERE tripId = ? ORDER BY arrivalTime ASC\",\n    [tripId]\n  );\n\n  return visits.map((v) => ({\n    id: v.id,\n    tripId: v.tripId,\n    siteName: v.siteName,\n    notes: v.notes || undefined,\n    photoUri: v.photoUri || undefined,\n    arrivalTime: v.arrivalTime,\n    arrivalLatitude: v.arrivalLatitude,\n    arrivalLongitude: v.arrivalLongitude,\n    departureTime: v.departureTime || undefined,\n    departureLatitude: v.departureLatitude || undefined,\n    departureLongitude: v.departureLongitude || undefined,\n    schemeName: v.schemeName || undefined,\n    schemeNumber: v.schemeNumber || undefined,\n    esrDetails: v.esrDetails || undefined,\n    village: v.village || undefined,\n    issueReported: v.issueReported || undefined,\n    resolution: v.resolution || undefined,\n    currentStatus: v.currentStatus || undefined,\n  }));\n}\n\nexport async function saveSiteVisitToDB(visit: SiteVisit & { photoUri?: string }): Promise<void> {\n  const database = await getDatabase();\n  await database.runAsync(\n    `INSERT OR REPLACE INTO site_visits \n     (id, tripId, siteName, notes, photoUri, arrivalTime, arrivalLatitude, arrivalLongitude, departureTime, departureLatitude, departureLongitude, schemeName, schemeNumber, esrDetails, village, issueReported, resolution, currentStatus) \n     VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,\n    [\n      visit.id,\n      visit.tripId,\n      visit.siteName,\n      visit.notes || null,\n      visit.photoUri || null,\n      visit.arrivalTime,\n      visit.arrivalLatitude,\n      visit.arrivalLongitude,\n      visit.departureTime || null,\n      visit.departureLatitude || null,\n      visit.departureLongitude || null,\n      visit.schemeName || null,\n      visit.schemeNumber || null,\n      visit.esrDetails || null,\n      visit.village || null,\n      visit.issueReported || null,\n      visit.resolution || null,\n      visit.currentStatus || null,\n    ]\n  );\n}\n\nexport async function getAllSiteVisitsFromDB(): Promise<SiteVisit[]> {\n  const database = await getDatabase();\n  const visits = await database.getAllAsync<{\n    id: string;\n    tripId: string;\n    siteName: string;\n    notes: string | null;\n    photoUri: string | null;\n    arrivalTime: number;\n    arrivalLatitude: number;\n    arrivalLongitude: number;\n    departureTime: number | null;\n    departureLatitude: number | null;\n    departureLongitude: number | null;\n    schemeName: string | null;\n    schemeNumber: string | null;\n    esrDetails: string | null;\n    village: string | null;\n    issueReported: string | null;\n    resolution: string | null;\n    currentStatus: string | null;\n  }>(\"SELECT * FROM site_visits ORDER BY arrivalTime DESC\");\n\n  return visits.map((v) => ({\n    id: v.id,\n    tripId: v.tripId,\n    siteName: v.siteName,\n    notes: v.notes || undefined,\n    photoUri: v.photoUri || undefined,\n    arrivalTime: v.arrivalTime,\n    arrivalLatitude: v.arrivalLatitude,\n    arrivalLongitude: v.arrivalLongitude,\n    departureTime: v.departureTime || undefined,\n    departureLatitude: v.departureLatitude || undefined,\n    departureLongitude: v.departureLongitude || undefined,\n    schemeName: v.schemeName || undefined,\n    schemeNumber: v.schemeNumber || undefined,\n    esrDetails: v.esrDetails || undefined,\n    village: v.village || undefined,\n    issueReported: v.issueReported || undefined,\n    resolution: v.resolution || undefined,\n    currentStatus: v.currentStatus || undefined,\n  }));\n}\n\nexport interface ExtendedUserSettings extends UserSettings {\n  allowanceRatePerMile?: number;\n  minDistanceForAllowance?: number;\n  maxDailyAllowance?: number;\n}\n\nexport async function getUserSettingsFromDB(): Promise<ExtendedUserSettings> {\n  const database = await getDatabase();\n  const settings = await database.getFirstAsync<{\n    workerName: string;\n    workerId: string;\n    useKilometers: number;\n    allowanceRate: number;\n    gpsUpdateFrequency: string;\n    allowanceRatePerMile: number;\n    minDistanceForAllowance: number;\n    maxDailyAllowance: number;\n  }>(\"SELECT * FROM user_settings WHERE id = 1\");\n\n  if (!settings) {\n    return {\n      workerName: \"\",\n      workerId: \"\",\n      useKilometers: true,\n      allowanceRate: 3.5,\n      gpsUpdateFrequency: \"medium\" as const,\n      allowanceRatePerMile: 0.8,\n      minDistanceForAllowance: 0,\n      maxDailyAllowance: 0,\n    };\n  }\n\n  return {\n    workerName: settings.workerName || \"\",\n    workerId: settings.workerId || \"\",\n    useKilometers: settings.useKilometers === 1,\n    allowanceRate: settings.allowanceRate,\n    gpsUpdateFrequency: settings.gpsUpdateFrequency as \"low\" | \"medium\" | \"high\",\n    allowanceRatePerMile: settings.allowanceRatePerMile,\n    minDistanceForAllowance: settings.minDistanceForAllowance,\n    maxDailyAllowance: settings.maxDailyAllowance,\n  };\n}\n\nexport async function saveUserSettingsToDB(settings: ExtendedUserSettings): Promise<void> {\n  const database = await getDatabase();\n  await database.runAsync(\n    `UPDATE user_settings SET \n     workerName = ?, \n     workerId = ?, \n     useKilometers = ?, \n     allowanceRate = ?, \n     gpsUpdateFrequency = ?,\n     allowanceRatePerMile = ?,\n     minDistanceForAllowance = ?,\n     maxDailyAllowance = ?\n     WHERE id = 1`,\n    [\n      settings.workerName,\n      settings.workerId,\n      settings.useKilometers ? 1 : 0,\n      settings.allowanceRate,\n      settings.gpsUpdateFrequency,\n      settings.allowanceRatePerMile || 0.8,\n      settings.minDistanceForAllowance || 0,\n      settings.maxDailyAllowance || 0,\n    ]\n  );\n}\n\nexport async function getTripsByDateRange(\n  startDate: number,\n  endDate: number\n): Promise<Trip[]> {\n  const database = await getDatabase();\n  const trips = await database.getAllAsync<{\n    id: string;\n    startTime: number;\n    endTime: number | null;\n    startLatitude: number;\n    startLongitude: number;\n    endLatitude: number | null;\n    endLongitude: number | null;\n    totalDistance: number;\n    isActive: number;\n  }>(\n    \"SELECT * FROM trips WHERE startTime >= ? AND startTime <= ? AND isActive = 0 ORDER BY startTime DESC\",\n    [startDate, endDate]\n  );\n\n  const result: Trip[] = [];\n  for (const trip of trips) {\n    const siteVisits = await database.getAllAsync<{ id: string }>(\n      \"SELECT id FROM site_visits WHERE tripId = ?\",\n      [trip.id]\n    );\n    result.push({\n      id: trip.id,\n      startTime: trip.startTime,\n      endTime: trip.endTime || undefined,\n      startLatitude: trip.startLatitude,\n      startLongitude: trip.startLongitude,\n      endLatitude: trip.endLatitude || undefined,\n      endLongitude: trip.endLongitude || undefined,\n      totalDistance: trip.totalDistance,\n      siteVisits: siteVisits.map((v) => v.id),\n      isActive: false,\n    });\n  }\n  return result;\n}\n\nexport async function getTripStats(\n  startDate: number,\n  endDate: number\n): Promise<{\n  totalTrips: number;\n  totalDistance: number;\n  totalDuration: number;\n  totalSiteVisits: number;\n}> {\n  const database = await getDatabase();\n  \n  const tripStats = await database.getFirstAsync<{\n    count: number;\n    totalDistance: number;\n    totalDuration: number;\n  }>(\n    `SELECT \n       COUNT(*) as count, \n       COALESCE(SUM(totalDistance), 0) as totalDistance,\n       COALESCE(SUM(CASE WHEN endTime IS NOT NULL THEN endTime - startTime ELSE 0 END), 0) as totalDuration\n     FROM trips \n     WHERE startTime >= ? AND startTime <= ? AND isActive = 0`,\n    [startDate, endDate]\n  );\n\n  const siteStats = await database.getFirstAsync<{ count: number }>(\n    `SELECT COUNT(*) as count FROM site_visits sv\n     INNER JOIN trips t ON sv.tripId = t.id\n     WHERE t.startTime >= ? AND t.startTime <= ? AND t.isActive = 0`,\n    [startDate, endDate]\n  );\n\n  return {\n    totalTrips: tripStats?.count || 0,\n    totalDistance: tripStats?.totalDistance || 0,\n    totalDuration: tripStats?.totalDuration || 0,\n    totalSiteVisits: siteStats?.count || 0,\n  };\n}\n\nexport async function exportTripsToCSV(\n  startDate: number,\n  endDate: number\n): Promise<string> {\n  const database = await getDatabase();\n  \n  const trips = await database.getAllAsync<{\n    id: string;\n    startTime: number;\n    endTime: number | null;\n    startLatitude: number;\n    startLongitude: number;\n    endLatitude: number | null;\n    endLongitude: number | null;\n    totalDistance: number;\n  }>(\n    \"SELECT * FROM trips WHERE startTime >= ? AND startTime <= ? AND isActive = 0 ORDER BY startTime ASC\",\n    [startDate, endDate]\n  );\n\n  const settings = await getUserSettingsFromDB();\n  \n  let csv = \"Trip ID,Date,Start Time,End Time,Duration (min),Distance (km),Distance (mi),Allowance ($),Start Lat,Start Lng,End Lat,End Lng,Site Visits\\n\";\n\n  for (const trip of trips) {\n    const startDate = new Date(trip.startTime);\n    const endDate = trip.endTime ? new Date(trip.endTime) : null;\n    const duration = trip.endTime\n      ? Math.round((trip.endTime - trip.startTime) / 60000)\n      : 0;\n    const distanceKm = trip.totalDistance;\n    const distanceMi = distanceKm * 0.621371;\n    const rate = settings.useKilometers\n      ? settings.allowanceRate\n      : settings.allowanceRatePerMile || 0.8;\n    const allowance = (settings.useKilometers ? distanceKm : distanceMi) * rate;\n\n    const siteVisits = await database.getAllAsync<{ siteName: string }>(\n      \"SELECT siteName FROM site_visits WHERE tripId = ?\",\n      [trip.id]\n    );\n    const siteNames = siteVisits.map((v) => v.siteName).join(\"; \");\n\n    csv += `${trip.id},`;\n    csv += `${startDate.toLocaleDateString()},`;\n    csv += `${startDate.toLocaleTimeString()},`;\n    csv += `${endDate ? endDate.toLocaleTimeString() : \"\"},`;\n    csv += `${duration},`;\n    csv += `${distanceKm.toFixed(2)},`;\n    csv += `${distanceMi.toFixed(2)},`;\n    csv += `${allowance.toFixed(2)},`;\n    csv += `${trip.startLatitude},`;\n    csv += `${trip.startLongitude},`;\n    csv += `${trip.endLatitude || \"\"},`;\n    csv += `${trip.endLongitude || \"\"},`;\n    csv += `\"${siteNames}\"\\n`;\n  }\n\n  return csv;\n}\n\nexport async function getGPSPointCountForTrip(tripId: string): Promise<number> {\n  const database = await getDatabase();\n  const result = await database.getFirstAsync<{ count: number }>(\n    \"SELECT COUNT(*) as count FROM gps_points WHERE tripId = ?\",\n    [tripId]\n  );\n  return result?.count || 0;\n}\n","path":null,"size_bytes":19141,"size_tokens":null},"components/TripMap.native.tsx":{"content":"import React, { useState, useEffect, useRef } from \"react\";\nimport { StyleSheet, View } from \"react-native\";\nimport MapView, { Marker, Polyline, PROVIDER_DEFAULT } from \"react-native-maps\";\nimport { Feather } from \"@expo/vector-icons\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { GPSPoint, SiteVisit, Trip } from \"@/utils/storage\";\nimport { getGPSPoints, getSiteVisits } from \"@/utils/dataAccess\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\n\ninterface TripMapProps {\n  trip: Trip;\n  height?: number;\n}\n\nexport function TripMap({ trip, height = 250 }: TripMapProps) {\n  const { theme } = useTheme();\n  const mapRef = useRef<MapView>(null);\n  const [gpsPoints, setGpsPoints] = useState<GPSPoint[]>([]);\n  const [siteVisits, setSiteVisits] = useState<SiteVisit[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    loadData();\n  }, [trip.id]);\n\n  const loadData = async () => {\n    setIsLoading(true);\n    try {\n      const [points, visits] = await Promise.all([\n        getGPSPoints(trip.id),\n        getSiteVisits(trip.id),\n      ]);\n      setGpsPoints(points);\n      setSiteVisits(visits);\n    } catch (error) {\n      console.error(\"Error loading map data:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <View\n        style={[\n          styles.container,\n          { height, backgroundColor: theme.backgroundSecondary },\n        ]}\n      >\n        <View style={styles.loadingContainer}>\n          <Feather name=\"loader\" size={24} color={theme.textSecondary} />\n          <ThemedText\n            type=\"small\"\n            style={{ color: theme.textSecondary, marginTop: Spacing.sm }}\n          >\n            Loading route...\n          </ThemedText>\n        </View>\n      </View>\n    );\n  }\n\n  if (gpsPoints.length === 0) {\n    return (\n      <View\n        style={[\n          styles.container,\n          { height, backgroundColor: theme.backgroundSecondary },\n        ]}\n      >\n        <View style={styles.fallback}>\n          <Feather name=\"map-pin\" size={48} color={theme.textSecondary} />\n          <ThemedText\n            type=\"small\"\n            style={[styles.fallbackText, { color: theme.textSecondary }]}\n          >\n            No GPS data recorded for this trip\n          </ThemedText>\n        </View>\n      </View>\n    );\n  }\n\n  const routeCoordinates = gpsPoints.map((point) => ({\n    latitude: point.latitude,\n    longitude: point.longitude,\n  }));\n\n  const allLatitudes = [\n    ...gpsPoints.map((p) => p.latitude),\n    ...siteVisits.map((v) => v.arrivalLatitude),\n  ];\n  const allLongitudes = [\n    ...gpsPoints.map((p) => p.longitude),\n    ...siteVisits.map((v) => v.arrivalLongitude),\n  ];\n\n  const minLat = Math.min(...allLatitudes);\n  const maxLat = Math.max(...allLatitudes);\n  const minLng = Math.min(...allLongitudes);\n  const maxLng = Math.max(...allLongitudes);\n\n  const centerLat = (minLat + maxLat) / 2;\n  const centerLng = (minLng + maxLng) / 2;\n  const latDelta = Math.max((maxLat - minLat) * 1.3, 0.01);\n  const lngDelta = Math.max((maxLng - minLng) * 1.3, 0.01);\n\n  const initialRegion = {\n    latitude: centerLat,\n    longitude: centerLng,\n    latitudeDelta: latDelta,\n    longitudeDelta: lngDelta,\n  };\n\n  return (\n    <View style={[styles.container, { height }]}>\n      <MapView\n        ref={mapRef}\n        style={styles.map}\n        provider={PROVIDER_DEFAULT}\n        initialRegion={initialRegion}\n        showsUserLocation={false}\n        showsMyLocationButton={false}\n        showsCompass={true}\n        showsScale={true}\n      >\n        <Polyline\n          coordinates={routeCoordinates}\n          strokeColor={AppColors.primary}\n          strokeWidth={4}\n          lineCap=\"round\"\n          lineJoin=\"round\"\n        />\n\n        <Marker\n          coordinate={{\n            latitude: trip.startLatitude,\n            longitude: trip.startLongitude,\n          }}\n          title=\"Start\"\n          description=\"Trip started\"\n          pinColor={AppColors.primary}\n        />\n\n        {trip.endLatitude && trip.endLongitude ? (\n          <Marker\n            coordinate={{\n              latitude: trip.endLatitude,\n              longitude: trip.endLongitude,\n            }}\n            title=\"End\"\n            description=\"Trip ended\"\n            pinColor={AppColors.secondary}\n          />\n        ) : null}\n\n        {siteVisits.map((visit) => (\n          <Marker\n            key={visit.id}\n            coordinate={{\n              latitude: visit.arrivalLatitude,\n              longitude: visit.arrivalLongitude,\n            }}\n            title={visit.siteName}\n            description={visit.notes || \"Site visit\"}\n            pinColor={AppColors.accent}\n          />\n        ))}\n      </MapView>\n\n      <View style={styles.legend}>\n        <View style={styles.legendItem}>\n          <View\n            style={[styles.legendDot, { backgroundColor: AppColors.primary }]}\n          />\n          <ThemedText type=\"caption\" style={{ color: theme.text }}>\n            Start\n          </ThemedText>\n        </View>\n        <View style={styles.legendItem}>\n          <View\n            style={[styles.legendDot, { backgroundColor: AppColors.secondary }]}\n          />\n          <ThemedText type=\"caption\" style={{ color: theme.text }}>\n            End\n          </ThemedText>\n        </View>\n        <View style={styles.legendItem}>\n          <View\n            style={[styles.legendDot, { backgroundColor: AppColors.accent }]}\n          />\n          <ThemedText type=\"caption\" style={{ color: theme.text }}>\n            Site Visit\n          </ThemedText>\n        </View>\n      </View>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    borderRadius: BorderRadius.md,\n    overflow: \"hidden\",\n    marginBottom: Spacing.lg,\n  },\n  map: {\n    flex: 1,\n  },\n  fallback: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: Spacing.lg,\n  },\n  fallbackText: {\n    textAlign: \"center\",\n    marginTop: Spacing.md,\n  },\n  loadingContainer: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  legend: {\n    position: \"absolute\",\n    bottom: Spacing.sm,\n    left: Spacing.sm,\n    backgroundColor: \"rgba(255, 255, 255, 0.9)\",\n    borderRadius: BorderRadius.sm,\n    padding: Spacing.xs,\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  legendItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.xs,\n  },\n  legendDot: {\n    width: 10,\n    height: 10,\n    borderRadius: 5,\n  },\n});\n","path":null,"size_bytes":6578,"size_tokens":null},"navigation/AuthStackNavigator.tsx":{"content":"import { createNativeStackNavigator } from \"@react-navigation/native-stack\";\n\nimport LoginScreen from \"@/screens/LoginScreen\";\nimport RegisterScreen from \"@/screens/RegisterScreen\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { getCommonScreenOptions } from \"@/navigation/screenOptions\";\n\nexport type AuthStackParamList = {\n  Login: undefined;\n  Register: undefined;\n};\n\nconst Stack = createNativeStackNavigator<AuthStackParamList>();\n\nexport default function AuthStackNavigator() {\n  const { theme, isDark } = useTheme();\n\n  return (\n    <Stack.Navigator\n      screenOptions={{\n        ...getCommonScreenOptions({ theme, isDark }),\n        headerShown: false,\n      }}\n    >\n      <Stack.Screen name=\"Login\" component={LoginScreen} />\n      <Stack.Screen name=\"Register\" component={RegisterScreen} />\n    </Stack.Navigator>\n  );\n}\n","path":null,"size_bytes":840,"size_tokens":null},"screens/RegisterScreen.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  StyleSheet,\n  View,\n  TextInput,\n  Pressable,\n  Alert,\n  Image,\n} from \"react-native\";\nimport { NativeStackScreenProps } from \"@react-navigation/native-stack\";\nimport * as Haptics from \"expo-haptics\";\nimport { Feather } from \"@expo/vector-icons\";\n\nimport { AuthScrollView } from \"@/components/AuthScrollView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\nimport { AuthStackParamList } from \"@/navigation/AuthStackNavigator\";\n\ntype RegisterScreenProps = NativeStackScreenProps<AuthStackParamList, \"Register\">;\n\nexport default function RegisterScreen({ navigation }: RegisterScreenProps) {\n  const { theme } = useTheme();\n  const { register } = useAuth();\n\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [employeeId, setEmployeeId] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const validateEmail = (email: string): boolean => {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]{2,}$/;\n    return emailRegex.test(email.toLowerCase());\n  };\n\n  const handleRegister = async () => {\n    if (!name.trim()) {\n      Alert.alert(\"Error\", \"Please enter your name.\");\n      return;\n    }\n\n    if (!email.trim()) {\n      Alert.alert(\"Error\", \"Please enter your email.\");\n      return;\n    }\n\n    if (!validateEmail(email.trim())) {\n      Alert.alert(\"Error\", \"Please enter a valid email address.\");\n      return;\n    }\n\n    if (!employeeId.trim()) {\n      Alert.alert(\"Error\", \"Please enter your Employee ID.\");\n      return;\n    }\n\n    if (!password) {\n      Alert.alert(\"Error\", \"Please enter a password.\");\n      return;\n    }\n\n    if (password.length < 4) {\n      Alert.alert(\"Error\", \"Password must be at least 4 characters long.\");\n      return;\n    }\n\n    if (password !== confirmPassword) {\n      Alert.alert(\"Error\", \"Passwords do not match.\");\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n      const result = await register({\n        name: name.trim(),\n        email: email.trim(),\n        employeeId: employeeId.trim(),\n        password,\n      });\n\n      if (!result.success) {\n        Alert.alert(\"Registration Failed\", result.error || \"Please try again.\");\n      }\n    } catch (error) {\n      Alert.alert(\"Error\", \"An error occurred. Please try again.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <AuthScrollView showsVerticalScrollIndicator={false}>\n      <View style={styles.container}>\n        <View style={styles.logoContainer}>\n          <Image\n            source={require(\"../assets/images/icon.png\")}\n            style={styles.logo}\n            resizeMode=\"contain\"\n          />\n          <ThemedText type=\"h2\" style={styles.title}>\n            Create Account\n          </ThemedText>\n          <ThemedText\n            type=\"small\"\n            style={[styles.subtitle, { color: theme.textSecondary }]}\n          >\n            Register to start tracking your routes\n          </ThemedText>\n        </View>\n\n        <View\n          style={[\n            styles.formContainer,\n            {\n              backgroundColor: theme.backgroundDefault,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n        >\n          <View style={styles.inputContainer}>\n            <ThemedText type=\"caption\" style={styles.inputLabel}>\n              Full Name\n            </ThemedText>\n            <View\n              style={[\n                styles.inputWrapper,\n                {\n                  backgroundColor: theme.backgroundSecondary,\n                  borderColor: theme.backgroundTertiary,\n                },\n              ]}\n            >\n              <Feather name=\"user\" size={20} color={theme.textSecondary} />\n              <TextInput\n                style={[styles.input, { color: theme.text }]}\n                value={name}\n                onChangeText={setName}\n                placeholder=\"Enter your full name\"\n                placeholderTextColor={theme.textSecondary}\n                autoCapitalize=\"words\"\n              />\n            </View>\n          </View>\n\n          <View style={styles.inputContainer}>\n            <ThemedText type=\"caption\" style={styles.inputLabel}>\n              Email\n            </ThemedText>\n            <View\n              style={[\n                styles.inputWrapper,\n                {\n                  backgroundColor: theme.backgroundSecondary,\n                  borderColor: theme.backgroundTertiary,\n                },\n              ]}\n            >\n              <Feather name=\"mail\" size={20} color={theme.textSecondary} />\n              <TextInput\n                style={[styles.input, { color: theme.text }]}\n                value={email}\n                onChangeText={setEmail}\n                placeholder=\"Enter your email\"\n                placeholderTextColor={theme.textSecondary}\n                keyboardType=\"email-address\"\n                autoCapitalize=\"none\"\n                autoCorrect={false}\n              />\n            </View>\n          </View>\n\n          <View style={styles.inputContainer}>\n            <ThemedText type=\"caption\" style={styles.inputLabel}>\n              Employee ID\n            </ThemedText>\n            <View\n              style={[\n                styles.inputWrapper,\n                {\n                  backgroundColor: theme.backgroundSecondary,\n                  borderColor: theme.backgroundTertiary,\n                },\n              ]}\n            >\n              <Feather name=\"briefcase\" size={20} color={theme.textSecondary} />\n              <TextInput\n                style={[styles.input, { color: theme.text }]}\n                value={employeeId}\n                onChangeText={setEmployeeId}\n                placeholder=\"Enter your Employee ID\"\n                placeholderTextColor={theme.textSecondary}\n                autoCapitalize=\"characters\"\n                autoCorrect={false}\n              />\n            </View>\n          </View>\n\n          <View style={styles.inputContainer}>\n            <ThemedText type=\"caption\" style={styles.inputLabel}>\n              Password\n            </ThemedText>\n            <View\n              style={[\n                styles.inputWrapper,\n                {\n                  backgroundColor: theme.backgroundSecondary,\n                  borderColor: theme.backgroundTertiary,\n                },\n              ]}\n            >\n              <Feather name=\"lock\" size={20} color={theme.textSecondary} />\n              <TextInput\n                style={[styles.input, { color: theme.text }]}\n                value={password}\n                onChangeText={setPassword}\n                placeholder=\"Create a password\"\n                placeholderTextColor={theme.textSecondary}\n                secureTextEntry={!showPassword}\n                autoCapitalize=\"none\"\n              />\n              <Pressable onPress={() => setShowPassword(!showPassword)}>\n                <Feather\n                  name={showPassword ? \"eye-off\" : \"eye\"}\n                  size={20}\n                  color={theme.textSecondary}\n                />\n              </Pressable>\n            </View>\n          </View>\n\n          <View style={styles.inputContainer}>\n            <ThemedText type=\"caption\" style={styles.inputLabel}>\n              Confirm Password\n            </ThemedText>\n            <View\n              style={[\n                styles.inputWrapper,\n                {\n                  backgroundColor: theme.backgroundSecondary,\n                  borderColor: theme.backgroundTertiary,\n                },\n              ]}\n            >\n              <Feather name=\"lock\" size={20} color={theme.textSecondary} />\n              <TextInput\n                style={[styles.input, { color: theme.text }]}\n                value={confirmPassword}\n                onChangeText={setConfirmPassword}\n                placeholder=\"Confirm your password\"\n                placeholderTextColor={theme.textSecondary}\n                secureTextEntry={!showConfirmPassword}\n                autoCapitalize=\"none\"\n              />\n              <Pressable onPress={() => setShowConfirmPassword(!showConfirmPassword)}>\n                <Feather\n                  name={showConfirmPassword ? \"eye-off\" : \"eye\"}\n                  size={20}\n                  color={theme.textSecondary}\n                />\n              </Pressable>\n            </View>\n          </View>\n\n          <Pressable\n            onPress={handleRegister}\n            disabled={isLoading}\n            style={({ pressed }) => [\n              styles.registerButton,\n              {\n                backgroundColor: AppColors.primary,\n                opacity: pressed || isLoading ? 0.8 : 1,\n              },\n            ]}\n          >\n            <ThemedText\n              type=\"body\"\n              style={[styles.registerButtonText, { color: \"#FFFFFF\" }]}\n            >\n              {isLoading ? \"Registering...\" : \"Register\"}\n            </ThemedText>\n          </Pressable>\n        </View>\n\n        <View style={styles.loginContainer}>\n          <ThemedText\n            type=\"body\"\n            style={[styles.loginText, { color: theme.textSecondary }]}\n          >\n            Already have an account?\n          </ThemedText>\n          <Pressable onPress={() => navigation.goBack()}>\n            <ThemedText\n              type=\"body\"\n              style={[styles.loginLink, { color: AppColors.accent }]}\n            >\n              Login here\n            </ThemedText>\n          </Pressable>\n        </View>\n      </View>\n    </AuthScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    paddingHorizontal: Spacing.md,\n  },\n  logoContainer: {\n    alignItems: \"center\",\n    marginTop: Spacing.xl,\n    marginBottom: Spacing.lg,\n  },\n  logo: {\n    width: 80,\n    height: 80,\n    borderRadius: 16,\n    marginBottom: Spacing.sm,\n  },\n  title: {\n    marginBottom: Spacing.xs,\n  },\n  subtitle: {\n    textAlign: \"center\",\n  },\n  formContainer: {\n    padding: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    borderWidth: 1,\n  },\n  inputContainer: {\n    marginBottom: Spacing.md,\n  },\n  inputLabel: {\n    marginBottom: Spacing.xs,\n    opacity: 0.7,\n  },\n  inputWrapper: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    height: Spacing.inputHeight,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.md,\n    borderWidth: 1,\n    gap: Spacing.sm,\n  },\n  input: {\n    flex: 1,\n    fontSize: 16,\n  },\n  registerButton: {\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginTop: Spacing.md,\n  },\n  registerButtonText: {\n    fontWeight: \"600\",\n  },\n  loginContainer: {\n    flexDirection: \"row\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginTop: Spacing.lg,\n    marginBottom: Spacing.xl,\n    gap: Spacing.xs,\n  },\n  loginText: {},\n  loginLink: {\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":11375,"size_tokens":null},"context/AuthContext.tsx":{"content":"import React, { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nconst AUTH_STORAGE_KEY = \"@routetracker_auth\";\nconst USERS_STORAGE_KEY = \"@routetracker_users\";\n\nexport interface User {\n  id: string;\n  name: string;\n  email: string;\n  employeeId: string;\n  passwordHash: string;\n}\n\nexport interface AuthState {\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  user: Omit<User, \"passwordHash\"> | null;\n}\n\ninterface AuthContextType extends AuthState {\n  login: (employeeId: string, password: string) => Promise<{ success: boolean; error?: string }>;\n  register: (data: RegisterData) => Promise<{ success: boolean; error?: string }>;\n  logout: () => Promise<void>;\n}\n\nexport interface RegisterData {\n  name: string;\n  email: string;\n  employeeId: string;\n  password: string;\n}\n\nconst AuthContext = createContext<AuthContextType | null>(null);\n\nfunction simpleHash(str: string): string {\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash;\n  }\n  return hash.toString(36);\n}\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [state, setState] = useState<AuthState>({\n    isAuthenticated: false,\n    isLoading: true,\n    user: null,\n  });\n\n  useEffect(() => {\n    loadAuthState();\n  }, []);\n\n  const loadAuthState = async () => {\n    try {\n      const authData = await AsyncStorage.getItem(AUTH_STORAGE_KEY);\n      if (authData) {\n        const user = JSON.parse(authData);\n        setState({\n          isAuthenticated: true,\n          isLoading: false,\n          user,\n        });\n      } else {\n        setState({\n          isAuthenticated: false,\n          isLoading: false,\n          user: null,\n        });\n      }\n    } catch (error) {\n      console.error(\"Error loading auth state:\", error);\n      setState({\n        isAuthenticated: false,\n        isLoading: false,\n        user: null,\n      });\n    }\n  };\n\n  const getUsers = async (): Promise<User[]> => {\n    try {\n      const usersData = await AsyncStorage.getItem(USERS_STORAGE_KEY);\n      return usersData ? JSON.parse(usersData) : [];\n    } catch (error) {\n      console.error(\"Error loading users:\", error);\n      return [];\n    }\n  };\n\n  const saveUsers = async (users: User[]): Promise<void> => {\n    try {\n      await AsyncStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users));\n    } catch (error) {\n      console.error(\"Error saving users:\", error);\n    }\n  };\n\n  const login = async (employeeId: string, password: string): Promise<{ success: boolean; error?: string }> => {\n    try {\n      const users = await getUsers();\n      const user = users.find((u) => u.employeeId.toLowerCase() === employeeId.toLowerCase());\n\n      if (!user) {\n        return { success: false, error: \"Employee ID not found. Please register first.\" };\n      }\n\n      const passwordHash = simpleHash(password);\n      if (user.passwordHash !== passwordHash) {\n        return { success: false, error: \"Incorrect password. Please try again.\" };\n      }\n\n      const authUser = {\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        employeeId: user.employeeId,\n      };\n\n      await AsyncStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(authUser));\n      \n      setState({\n        isAuthenticated: true,\n        isLoading: false,\n        user: authUser,\n      });\n\n      return { success: true };\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      return { success: false, error: \"An error occurred. Please try again.\" };\n    }\n  };\n\n  const register = async (data: RegisterData): Promise<{ success: boolean; error?: string }> => {\n    try {\n      const users = await getUsers();\n\n      const existingUser = users.find(\n        (u) => u.employeeId.toLowerCase() === data.employeeId.toLowerCase()\n      );\n\n      if (existingUser) {\n        return { success: false, error: \"This Employee ID is already registered.\" };\n      }\n\n      const existingEmail = users.find(\n        (u) => u.email.toLowerCase() === data.email.toLowerCase()\n      );\n\n      if (existingEmail) {\n        return { success: false, error: \"This email is already registered.\" };\n      }\n\n      const newUser: User = {\n        id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        name: data.name,\n        email: data.email,\n        employeeId: data.employeeId,\n        passwordHash: simpleHash(data.password),\n      };\n\n      users.push(newUser);\n      await saveUsers(users);\n\n      const authUser = {\n        id: newUser.id,\n        name: newUser.name,\n        email: newUser.email,\n        employeeId: newUser.employeeId,\n      };\n\n      await AsyncStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(authUser));\n\n      setState({\n        isAuthenticated: true,\n        isLoading: false,\n        user: authUser,\n      });\n\n      return { success: true };\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n      return { success: false, error: \"An error occurred. Please try again.\" };\n    }\n  };\n\n  const logout = async (): Promise<void> => {\n    try {\n      await AsyncStorage.removeItem(AUTH_STORAGE_KEY);\n      setState({\n        isAuthenticated: false,\n        isLoading: false,\n        user: null,\n      });\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{ ...state, login, register, logout }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":5743,"size_tokens":null},"screens/LoginScreen.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  StyleSheet,\n  View,\n  TextInput,\n  Pressable,\n  Alert,\n  Image,\n  KeyboardAvoidingView,\n  Platform,\n} from \"react-native\";\nimport { NativeStackScreenProps } from \"@react-navigation/native-stack\";\nimport * as Haptics from \"expo-haptics\";\nimport { Feather } from \"@expo/vector-icons\";\n\nimport { AuthScrollView } from \"@/components/AuthScrollView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { Spacing, BorderRadius, AppColors } from \"@/constants/theme\";\nimport { AuthStackParamList } from \"@/navigation/AuthStackNavigator\";\n\ntype LoginScreenProps = NativeStackScreenProps<AuthStackParamList, \"Login\">;\n\nexport default function LoginScreen({ navigation }: LoginScreenProps) {\n  const { theme } = useTheme();\n  const { login } = useAuth();\n\n  const [employeeId, setEmployeeId] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleLogin = async () => {\n    if (!employeeId.trim()) {\n      Alert.alert(\"Error\", \"Please enter your Employee ID.\");\n      return;\n    }\n\n    if (!password) {\n      Alert.alert(\"Error\", \"Please enter your password.\");\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n      const result = await login(employeeId.trim(), password);\n\n      if (!result.success) {\n        Alert.alert(\"Login Failed\", result.error || \"Please try again.\");\n      }\n    } catch (error) {\n      Alert.alert(\"Error\", \"An error occurred. Please try again.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <AuthScrollView showsVerticalScrollIndicator={false}>\n      <View style={styles.container}>\n        <View style={styles.logoContainer}>\n          <Image\n            source={require(\"../assets/images/icon.png\")}\n            style={styles.logo}\n            resizeMode=\"contain\"\n          />\n          <ThemedText type=\"h2\" style={styles.title}>\n            RouteTracker\n          </ThemedText>\n          <ThemedText\n            type=\"small\"\n            style={[styles.subtitle, { color: theme.textSecondary }]}\n          >\n            GPS Route Tracking for Field Workers\n          </ThemedText>\n        </View>\n\n        <View\n          style={[\n            styles.formContainer,\n            {\n              backgroundColor: theme.backgroundDefault,\n              borderColor: theme.backgroundSecondary,\n            },\n          ]}\n        >\n          <ThemedText type=\"h4\" style={styles.formTitle}>\n            Login\n          </ThemedText>\n\n          <View style={styles.inputContainer}>\n            <ThemedText type=\"caption\" style={styles.inputLabel}>\n              Employee ID\n            </ThemedText>\n            <View\n              style={[\n                styles.inputWrapper,\n                {\n                  backgroundColor: theme.backgroundSecondary,\n                  borderColor: theme.backgroundTertiary,\n                },\n              ]}\n            >\n              <Feather name=\"user\" size={20} color={theme.textSecondary} />\n              <TextInput\n                style={[styles.input, { color: theme.text }]}\n                value={employeeId}\n                onChangeText={setEmployeeId}\n                placeholder=\"Enter your Employee ID\"\n                placeholderTextColor={theme.textSecondary}\n                autoCapitalize=\"characters\"\n                autoCorrect={false}\n              />\n            </View>\n          </View>\n\n          <View style={styles.inputContainer}>\n            <ThemedText type=\"caption\" style={styles.inputLabel}>\n              Password\n            </ThemedText>\n            <View\n              style={[\n                styles.inputWrapper,\n                {\n                  backgroundColor: theme.backgroundSecondary,\n                  borderColor: theme.backgroundTertiary,\n                },\n              ]}\n            >\n              <Feather name=\"lock\" size={20} color={theme.textSecondary} />\n              <TextInput\n                style={[styles.input, { color: theme.text }]}\n                value={password}\n                onChangeText={setPassword}\n                placeholder=\"Enter your password\"\n                placeholderTextColor={theme.textSecondary}\n                secureTextEntry={!showPassword}\n                autoCapitalize=\"none\"\n              />\n              <Pressable onPress={() => setShowPassword(!showPassword)}>\n                <Feather\n                  name={showPassword ? \"eye-off\" : \"eye\"}\n                  size={20}\n                  color={theme.textSecondary}\n                />\n              </Pressable>\n            </View>\n          </View>\n\n          <Pressable\n            onPress={handleLogin}\n            disabled={isLoading}\n            style={({ pressed }) => [\n              styles.loginButton,\n              {\n                backgroundColor: AppColors.primary,\n                opacity: pressed || isLoading ? 0.8 : 1,\n              },\n            ]}\n          >\n            <ThemedText\n              type=\"body\"\n              style={[styles.loginButtonText, { color: \"#FFFFFF\" }]}\n            >\n              {isLoading ? \"Logging in...\" : \"Login\"}\n            </ThemedText>\n          </Pressable>\n        </View>\n\n        <View style={styles.registerContainer}>\n          <ThemedText\n            type=\"body\"\n            style={[styles.registerText, { color: theme.textSecondary }]}\n          >\n            Don't have an account?\n          </ThemedText>\n          <Pressable onPress={() => navigation.navigate(\"Register\")}>\n            <ThemedText\n              type=\"body\"\n              style={[styles.registerLink, { color: AppColors.accent }]}\n            >\n              Register here\n            </ThemedText>\n          </Pressable>\n        </View>\n      </View>\n    </AuthScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    paddingHorizontal: Spacing.md,\n  },\n  logoContainer: {\n    alignItems: \"center\",\n    marginTop: Spacing.xxl,\n    marginBottom: Spacing.xl,\n  },\n  logo: {\n    width: 100,\n    height: 100,\n    borderRadius: 20,\n    marginBottom: Spacing.md,\n  },\n  title: {\n    marginBottom: Spacing.xs,\n  },\n  subtitle: {\n    textAlign: \"center\",\n  },\n  formContainer: {\n    padding: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    borderWidth: 1,\n  },\n  formTitle: {\n    marginBottom: Spacing.lg,\n    textAlign: \"center\",\n  },\n  inputContainer: {\n    marginBottom: Spacing.md,\n  },\n  inputLabel: {\n    marginBottom: Spacing.xs,\n    opacity: 0.7,\n  },\n  inputWrapper: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    height: Spacing.inputHeight,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.md,\n    borderWidth: 1,\n    gap: Spacing.sm,\n  },\n  input: {\n    flex: 1,\n    fontSize: 16,\n  },\n  loginButton: {\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginTop: Spacing.md,\n  },\n  loginButtonText: {\n    fontWeight: \"600\",\n  },\n  registerContainer: {\n    flexDirection: \"row\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginTop: Spacing.xl,\n    gap: Spacing.xs,\n  },\n  registerText: {},\n  registerLink: {\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":7442,"size_tokens":null},"components/AuthScrollView.tsx":{"content":"import { Platform, StyleSheet, ScrollView } from \"react-native\";\nimport {\n  KeyboardAwareScrollView,\n  KeyboardAwareScrollViewProps,\n} from \"react-native-keyboard-controller\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing } from \"@/constants/theme\";\n\nexport function AuthScrollView({\n  children,\n  contentContainerStyle,\n  style,\n  keyboardShouldPersistTaps = \"handled\",\n  ...scrollViewProps\n}: KeyboardAwareScrollViewProps) {\n  const { theme } = useTheme();\n  const insets = useSafeAreaInsets();\n\n  const paddingTop = insets.top + Spacing.xl;\n  const paddingBottom = insets.bottom + Spacing.xxl;\n  const scrollInsetBottom = insets.bottom + 16;\n\n  if (Platform.OS === \"web\") {\n    return (\n      <ScrollView\n        style={[\n          styles.container,\n          { backgroundColor: theme.backgroundRoot },\n          style,\n        ]}\n        contentContainerStyle={[\n          {\n            paddingTop,\n            paddingBottom,\n          },\n          styles.contentContainer,\n          contentContainerStyle,\n        ]}\n        scrollIndicatorInsets={{ bottom: scrollInsetBottom }}\n        keyboardShouldPersistTaps={keyboardShouldPersistTaps}\n        {...scrollViewProps}\n      >\n        {children}\n      </ScrollView>\n    );\n  }\n\n  return (\n    <KeyboardAwareScrollView\n      style={[\n        styles.container,\n        { backgroundColor: theme.backgroundRoot },\n        style,\n      ]}\n      contentContainerStyle={[\n        {\n          paddingTop,\n          paddingBottom,\n        },\n        styles.contentContainer,\n        contentContainerStyle,\n      ]}\n      scrollIndicatorInsets={{ bottom: scrollInsetBottom }}\n      keyboardShouldPersistTaps={keyboardShouldPersistTaps}\n      {...scrollViewProps}\n    >\n      {children}\n    </KeyboardAwareScrollView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  contentContainer: {\n    paddingHorizontal: Spacing.xl,\n  },\n});\n","path":null,"size_bytes":1990,"size_tokens":null},"hooks/useMotionDetection.ts":{"content":"import { useState, useEffect, useRef, useCallback } from \"react\";\nimport { Accelerometer, AccelerometerMeasurement } from \"expo-sensors\";\nimport { Platform } from \"react-native\";\n\nexport type MotionState = \"stationary\" | \"moving\" | \"unknown\";\n\ninterface MotionDetectionState {\n  isMoving: boolean;\n  motionState: MotionState;\n  accelerationMagnitude: number;\n  motionConfidence: number;\n}\n\nconst STILLNESS_THRESHOLD = 0.02;\nconst MOVEMENT_THRESHOLD = 0.05;\nconst WINDOW_SIZE = 20;\n\nexport function useMotionDetection() {\n  const [state, setState] = useState<MotionDetectionState>({\n    isMoving: true,\n    motionState: \"unknown\",\n    accelerationMagnitude: 0,\n    motionConfidence: 0.5,\n  });\n  \n  const magnitudeBuffer = useRef<number[]>([]);\n  const subscription = useRef<{ remove: () => void } | null>(null);\n  const isAvailable = useRef(false);\n  const smoothedConfidence = useRef(0.5);\n\n  const processAcceleration = useCallback((data: AccelerometerMeasurement) => {\n    const magnitude = Math.sqrt(data.x * data.x + data.y * data.y + data.z * data.z);\n    const deviation = Math.abs(magnitude - 1.0);\n    \n    magnitudeBuffer.current.push(deviation);\n    if (magnitudeBuffer.current.length > WINDOW_SIZE) {\n      magnitudeBuffer.current.shift();\n    }\n    \n    if (magnitudeBuffer.current.length < 5) {\n      return;\n    }\n    \n    const avgDeviation = magnitudeBuffer.current.reduce((a, b) => a + b, 0) / magnitudeBuffer.current.length;\n    const variance = magnitudeBuffer.current.reduce((sum, val) => sum + Math.pow(val - avgDeviation, 2), 0) / magnitudeBuffer.current.length;\n    const stdDev = Math.sqrt(variance);\n    \n    const activityLevel = avgDeviation + stdDev * 2;\n    \n    let rawConfidence: number;\n    if (activityLevel < STILLNESS_THRESHOLD) {\n      rawConfidence = 0.0;\n    } else if (activityLevel > MOVEMENT_THRESHOLD) {\n      rawConfidence = 1.0;\n    } else {\n      rawConfidence = (activityLevel - STILLNESS_THRESHOLD) / (MOVEMENT_THRESHOLD - STILLNESS_THRESHOLD);\n    }\n    \n    smoothedConfidence.current = smoothedConfidence.current * 0.7 + rawConfidence * 0.3;\n    \n    setState({\n      isMoving: smoothedConfidence.current > 0.3,\n      motionState: smoothedConfidence.current < 0.2 ? \"stationary\" : \n                   smoothedConfidence.current > 0.5 ? \"moving\" : \"unknown\",\n      accelerationMagnitude: avgDeviation,\n      motionConfidence: smoothedConfidence.current,\n    });\n  }, []);\n\n  const startMotionDetection = useCallback(async () => {\n    if (Platform.OS === \"web\") {\n      setState({ isMoving: true, motionState: \"unknown\", accelerationMagnitude: 0, motionConfidence: 0.5 });\n      return;\n    }\n    \n    try {\n      const available = await Accelerometer.isAvailableAsync();\n      isAvailable.current = available;\n      \n      if (!available) {\n        setState({ isMoving: true, motionState: \"unknown\", accelerationMagnitude: 0, motionConfidence: 0.5 });\n        return;\n      }\n      \n      await Accelerometer.setUpdateInterval(100);\n      \n      subscription.current = Accelerometer.addListener(processAcceleration);\n    } catch (error) {\n      console.error(\"Error starting motion detection:\", error);\n      setState({ isMoving: true, motionState: \"unknown\", accelerationMagnitude: 0, motionConfidence: 0.5 });\n    }\n  }, [processAcceleration]);\n\n  const stopMotionDetection = useCallback(() => {\n    if (subscription.current) {\n      subscription.current.remove();\n      subscription.current = null;\n    }\n    magnitudeBuffer.current = [];\n    smoothedConfidence.current = 0.5;\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      stopMotionDetection();\n    };\n  }, [stopMotionDetection]);\n\n  return {\n    ...state,\n    startMotionDetection,\n    stopMotionDetection,\n    isAccelerometerAvailable: isAvailable.current,\n  };\n}\n\nlet globalMotionState: MotionState = \"unknown\";\nlet globalIsMoving = true;\nlet globalMotionConfidence = 0.5;\n\nexport function setGlobalMotionState(state: MotionState, isMoving: boolean, confidence?: number) {\n  globalMotionState = state;\n  globalIsMoving = isMoving;\n  if (confidence !== undefined) {\n    globalMotionConfidence = confidence;\n  }\n}\n\nexport function getGlobalMotionState(): { state: MotionState; isMoving: boolean; confidence: number } {\n  return { state: globalMotionState, isMoving: globalIsMoving, confidence: globalMotionConfidence };\n}\n\ninterface GPSLocationForMotion {\n  latitude: number;\n  longitude: number;\n  timestamp: number;\n  accuracy?: number;\n  speed?: number | null;\n  heading?: number | null;\n}\n\nconst gpsMotionBuffer: GPSLocationForMotion[] = [];\nconst GPS_BUFFER_SIZE = 10;\nconst MIN_SPEED_MPS = 0.5;\nconst NET_DISPLACEMENT_MIN_M = 15;\nconst MAX_STATIONARY_ACCURACY = 25;\n\nfunction haversineDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const R = 6371000;\n  const dLat = (lat2 - lat1) * Math.PI / 180;\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n            Math.sin(dLon/2) * Math.sin(dLon/2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n  return R * c;\n}\n\nlet smoothedConfidence = 0.0;\n\nexport function analyzeGPSMotion(location: GPSLocationForMotion, accelerometerConfidence?: number): { isStationary: boolean; motionConfidence: number } {\n  gpsMotionBuffer.push(location);\n  if (gpsMotionBuffer.length > GPS_BUFFER_SIZE) {\n    gpsMotionBuffer.shift();\n  }\n  \n  if (gpsMotionBuffer.length < 3) {\n    smoothedConfidence = 0.0;\n    return { isStationary: true, motionConfidence: 0.0 };\n  }\n  \n  const oldest = gpsMotionBuffer[0];\n  const newest = gpsMotionBuffer[gpsMotionBuffer.length - 1];\n  const netDisplacement = haversineDistance(oldest.latitude, oldest.longitude, newest.latitude, newest.longitude);\n  const windowTimeSec = (newest.timestamp - oldest.timestamp) / 1000;\n  \n  let totalPathDistance = 0;\n  for (let i = 1; i < gpsMotionBuffer.length; i++) {\n    totalPathDistance += haversineDistance(\n      gpsMotionBuffer[i-1].latitude, gpsMotionBuffer[i-1].longitude,\n      gpsMotionBuffer[i].latitude, gpsMotionBuffer[i].longitude\n    );\n  }\n  \n  const avgAccuracy = gpsMotionBuffer.reduce((sum, p) => sum + (p.accuracy || 25), 0) / gpsMotionBuffer.length;\n  \n  const hasDeviceSpeed = location.speed !== undefined && location.speed !== null && location.speed >= 0;\n  const deviceSpeed: number = hasDeviceSpeed ? (location.speed as number) : 0;\n  const netSpeed = windowTimeSec > 0 ? netDisplacement / windowTimeSec : 0;\n  \n  const straightness = totalPathDistance > 0 ? netDisplacement / totalPathDistance : 0;\n  \n  let rawConfidence = 0.0;\n  \n  if (hasDeviceSpeed && deviceSpeed >= 0.5) {\n    rawConfidence = Math.min(0.95, 0.5 + deviceSpeed * 0.3);\n  } else if (netDisplacement > avgAccuracy * 1.5 && straightness >= 0.5 && netSpeed >= 0.3) {\n    rawConfidence = Math.min(0.9, straightness * 0.6 + netSpeed * 0.2);\n  } else if (netDisplacement > avgAccuracy && straightness >= 0.3 && netSpeed >= 0.2) {\n    rawConfidence = Math.min(0.7, straightness * 0.5 + netSpeed * 0.3);\n  } else if (netSpeed >= 0.3) {\n    rawConfidence = Math.min(0.5, netSpeed * 0.4 + straightness * 0.3);\n  } else {\n    rawConfidence = 0.0;\n  }\n  \n  const hasAccelerometer = accelerometerConfidence !== undefined && accelerometerConfidence > 0;\n  if (hasAccelerometer) {\n    rawConfidence = rawConfidence * 0.4 + accelerometerConfidence * 0.6;\n  }\n  \n  smoothedConfidence = smoothedConfidence * 0.5 + rawConfidence * 0.5;\n  \n  return { \n    isStationary: smoothedConfidence < 0.25, \n    motionConfidence: smoothedConfidence \n  };\n}\n\nexport function resetGPSMotionBuffer() {\n  gpsMotionBuffer.length = 0;\n  smoothedConfidence = 0.0;\n}\n","path":null,"size_bytes":7709,"size_tokens":null},"utils/gpsFilter.ts":{"content":"import { GPSPoint } from \"./storage\";\n\ninterface FilteredPoint {\n  latitude: number;\n  longitude: number;\n  timestamp: number;\n  accuracy: number;\n  speed: number;\n  isValidMovement: boolean;\n  filteredDistance: number;\n}\n\ninterface KalmanState {\n  lat: number;\n  lon: number;\n  latVariance: number;\n  lonVariance: number;\n  timestamp: number;\n}\n\nclass GPSFilter {\n  private kalmanState: KalmanState | null = null;\n  private pointBuffer: FilteredPoint[] = [];\n  private lastValidPoint: FilteredPoint | null = null;\n  private isStationaryLocked = true;\n  private lockReleaseTime = 0;\n  private dwellCenter: { lat: number; lon: number } | null = null;\n  private consecutiveStationaryCount = 0;\n  private consecutiveMovingCount = 0;\n\n  private readonly BUFFER_SIZE = 15;\n  private readonly STATIONARY_LOCK_RELEASE_METERS = 25;\n  private readonly STATIONARY_LOCK_RELEASE_SECONDS = 20;\n  private readonly DWELL_RADIUS_METERS = 20;\n  private readonly MIN_SPEED_MPS = 0.5;\n  private readonly MIN_ACCURACY_METERS = 30;\n  private readonly MIN_SEGMENT_METERS = 8;\n  private readonly CONSECUTIVE_MOVING_THRESHOLD = 3;\n  private readonly CONSECUTIVE_STATIONARY_THRESHOLD = 5;\n  private readonly PROCESS_NOISE = 3;\n  private readonly MEASUREMENT_NOISE_BASE = 10;\n\n  reset(): void {\n    this.kalmanState = null;\n    this.pointBuffer = [];\n    this.lastValidPoint = null;\n    this.isStationaryLocked = true;\n    this.lockReleaseTime = 0;\n    this.dwellCenter = null;\n    this.consecutiveStationaryCount = 0;\n    this.consecutiveMovingCount = 0;\n  }\n\n  private haversineDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n    const R = 6371000;\n    const dLat = (lat2 - lat1) * Math.PI / 180;\n    const dLon = (lon2 - lon1) * Math.PI / 180;\n    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n              Math.sin(dLon / 2) * Math.sin(dLon / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n  }\n\n  private applyKalmanFilter(\n    lat: number,\n    lon: number,\n    accuracy: number,\n    timestamp: number\n  ): { lat: number; lon: number } {\n    const measurementNoise = Math.max(this.MEASUREMENT_NOISE_BASE, accuracy);\n\n    if (!this.kalmanState) {\n      this.kalmanState = {\n        lat,\n        lon,\n        latVariance: measurementNoise * measurementNoise,\n        lonVariance: measurementNoise * measurementNoise,\n        timestamp,\n      };\n      return { lat, lon };\n    }\n\n    const timeDelta = (timestamp - this.kalmanState.timestamp) / 1000;\n    const processNoise = this.PROCESS_NOISE * timeDelta;\n\n    const predictedLatVariance = this.kalmanState.latVariance + processNoise * processNoise;\n    const predictedLonVariance = this.kalmanState.lonVariance + processNoise * processNoise;\n\n    const latKalmanGain = predictedLatVariance / (predictedLatVariance + measurementNoise * measurementNoise);\n    const lonKalmanGain = predictedLonVariance / (predictedLonVariance + measurementNoise * measurementNoise);\n\n    const newLat = this.kalmanState.lat + latKalmanGain * (lat - this.kalmanState.lat);\n    const newLon = this.kalmanState.lon + lonKalmanGain * (lon - this.kalmanState.lon);\n\n    this.kalmanState = {\n      lat: newLat,\n      lon: newLon,\n      latVariance: (1 - latKalmanGain) * predictedLatVariance,\n      lonVariance: (1 - lonKalmanGain) * predictedLonVariance,\n      timestamp,\n    };\n\n    return { lat: newLat, lon: newLon };\n  }\n\n  private checkStationaryLock(): void {\n    if (this.pointBuffer.length < 3) return;\n\n    const now = this.pointBuffer[this.pointBuffer.length - 1].timestamp;\n    const windowStart = now - this.STATIONARY_LOCK_RELEASE_SECONDS * 1000;\n\n    const recentPoints = this.pointBuffer.filter(p => p.timestamp >= windowStart);\n    if (recentPoints.length < 2) return;\n\n    const oldest = recentPoints[0];\n    const newest = recentPoints[recentPoints.length - 1];\n    const netDisplacement = this.haversineDistance(\n      oldest.latitude, oldest.longitude,\n      newest.latitude, newest.longitude\n    );\n\n    const avgSpeed = recentPoints.reduce((sum, p) => sum + p.speed, 0) / recentPoints.length;\n    const avgAccuracy = recentPoints.reduce((sum, p) => sum + p.accuracy, 0) / recentPoints.length;\n\n    if (this.isStationaryLocked) {\n      if (\n        netDisplacement > this.STATIONARY_LOCK_RELEASE_METERS &&\n        avgSpeed >= this.MIN_SPEED_MPS &&\n        avgAccuracy < this.MIN_ACCURACY_METERS &&\n        this.consecutiveMovingCount >= this.CONSECUTIVE_MOVING_THRESHOLD\n      ) {\n        this.isStationaryLocked = false;\n        this.lockReleaseTime = now;\n        this.dwellCenter = null;\n        this.consecutiveStationaryCount = 0;\n      }\n    } else {\n      if (\n        netDisplacement < 10 &&\n        avgSpeed < 0.3 &&\n        this.consecutiveStationaryCount >= this.CONSECUTIVE_STATIONARY_THRESHOLD\n      ) {\n        this.isStationaryLocked = true;\n        this.dwellCenter = { lat: newest.latitude, lon: newest.longitude };\n        this.consecutiveMovingCount = 0;\n      }\n    }\n  }\n\n  processPoint(\n    latitude: number,\n    longitude: number,\n    timestamp: number,\n    accuracy: number | undefined,\n    speed: number | null | undefined,\n    motionConfidence: number\n  ): { distance: number; isMoving: boolean; filteredLat: number; filteredLon: number } {\n    const acc = accuracy ?? 15;\n    const spd = speed ?? 0;\n\n    const filtered = this.applyKalmanFilter(latitude, longitude, acc, timestamp);\n\n    const isMovingBySpeed = spd >= this.MIN_SPEED_MPS;\n    const isMovingByConfidence = motionConfidence >= 0.5;\n\n    if (isMovingBySpeed || isMovingByConfidence) {\n      this.consecutiveMovingCount++;\n      this.consecutiveStationaryCount = 0;\n    } else {\n      this.consecutiveStationaryCount++;\n      this.consecutiveMovingCount = 0;\n    }\n\n    const point: FilteredPoint = {\n      latitude: filtered.lat,\n      longitude: filtered.lon,\n      timestamp,\n      accuracy: acc,\n      speed: spd,\n      isValidMovement: false,\n      filteredDistance: 0,\n    };\n\n    this.pointBuffer.push(point);\n    if (this.pointBuffer.length > this.BUFFER_SIZE) {\n      this.pointBuffer.shift();\n    }\n\n    this.checkStationaryLock();\n\n    if (this.isStationaryLocked) {\n      if (!this.dwellCenter) {\n        this.dwellCenter = { lat: filtered.lat, lon: filtered.lon };\n      }\n      this.lastValidPoint = point;\n      return {\n        distance: 0,\n        isMoving: false,\n        filteredLat: filtered.lat,\n        filteredLon: filtered.lon,\n      };\n    }\n\n    if (this.dwellCenter) {\n      const distFromDwell = this.haversineDistance(\n        this.dwellCenter.lat, this.dwellCenter.lon,\n        filtered.lat, filtered.lon\n      );\n      if (distFromDwell < this.DWELL_RADIUS_METERS) {\n        return {\n          distance: 0,\n          isMoving: false,\n          filteredLat: filtered.lat,\n          filteredLon: filtered.lon,\n        };\n      } else {\n        this.dwellCenter = null;\n      }\n    }\n\n    if (!this.lastValidPoint) {\n      this.lastValidPoint = point;\n      return {\n        distance: 0,\n        isMoving: true,\n        filteredLat: filtered.lat,\n        filteredLon: filtered.lon,\n      };\n    }\n\n    const segmentDistance = this.haversineDistance(\n      this.lastValidPoint.latitude, this.lastValidPoint.longitude,\n      filtered.lat, filtered.lon\n    );\n\n    if (segmentDistance < this.MIN_SEGMENT_METERS) {\n      return {\n        distance: 0,\n        isMoving: false,\n        filteredLat: filtered.lat,\n        filteredLon: filtered.lon,\n      };\n    }\n\n    const timeDiff = (timestamp - this.lastValidPoint.timestamp) / 1000;\n    if (timeDiff > 0) {\n      const impliedSpeed = segmentDistance / timeDiff;\n      if (impliedSpeed > 55) {\n        return {\n          distance: 0,\n          isMoving: false,\n          filteredLat: filtered.lat,\n          filteredLon: filtered.lon,\n        };\n      }\n    }\n\n    if (acc > this.MIN_ACCURACY_METERS) {\n      return {\n        distance: 0,\n        isMoving: false,\n        filteredLat: filtered.lat,\n        filteredLon: filtered.lon,\n      };\n    }\n\n    point.isValidMovement = true;\n    point.filteredDistance = segmentDistance;\n    this.lastValidPoint = point;\n\n    return {\n      distance: segmentDistance / 1000,\n      isMoving: true,\n      filteredLat: filtered.lat,\n      filteredLon: filtered.lon,\n    };\n  }\n\n  getDistanceInKm(meters: number): number {\n    return meters / 1000;\n  }\n\n  getState(): {\n    isLocked: boolean;\n    consecutiveMoving: number;\n    consecutiveStationary: number;\n    bufferSize: number;\n  } {\n    return {\n      isLocked: this.isStationaryLocked,\n      consecutiveMoving: this.consecutiveMovingCount,\n      consecutiveStationary: this.consecutiveStationaryCount,\n      bufferSize: this.pointBuffer.length,\n    };\n  }\n}\n\nlet globalFilter: GPSFilter | null = null;\n\nexport function getGPSFilter(): GPSFilter {\n  if (!globalFilter) {\n    globalFilter = new GPSFilter();\n  }\n  return globalFilter;\n}\n\nexport function resetGPSFilter(): void {\n  if (globalFilter) {\n    globalFilter.reset();\n  }\n  globalFilter = new GPSFilter();\n}\n\nexport function calculateFilteredDistance(points: GPSPoint[]): number {\n  if (points.length < 2) return 0;\n\n  const sortedPoints = [...points].sort((a, b) => a.timestamp - b.timestamp);\n  \n  let totalDistance = 0;\n  const MIN_SEGMENT_METERS = 15;\n  const MAX_ACCURACY_METERS = 30;\n  const MIN_SPEED_KMH = 1.5;\n  const MAX_SPEED_KMH = 200;\n  \n  let lastValidPoint: GPSPoint | null = null;\n  let stationaryCount = 0;\n  let movingCount = 0;\n  \n  for (const point of sortedPoints) {\n    if (point.latitude === 0 && point.longitude === 0) continue;\n    \n    const accuracy = point.accuracy ?? 15;\n    if (accuracy > MAX_ACCURACY_METERS) continue;\n    \n    if (point.isStationary === true) {\n      stationaryCount++;\n      movingCount = 0;\n      continue;\n    }\n    \n    movingCount++;\n    stationaryCount = 0;\n    \n    if (movingCount < 2) {\n      lastValidPoint = point;\n      continue;\n    }\n    \n    if (!lastValidPoint) {\n      lastValidPoint = point;\n      continue;\n    }\n    \n    const R = 6371;\n    const dLat = (point.latitude - lastValidPoint.latitude) * Math.PI / 180;\n    const dLon = (point.longitude - lastValidPoint.longitude) * Math.PI / 180;\n    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n              Math.cos(lastValidPoint.latitude * Math.PI / 180) * \n              Math.cos(point.latitude * Math.PI / 180) *\n              Math.sin(dLon / 2) * Math.sin(dLon / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    const segmentDistanceKm = R * c;\n    const segmentDistanceMeters = segmentDistanceKm * 1000;\n    \n    if (segmentDistanceMeters < MIN_SEGMENT_METERS) {\n      continue;\n    }\n    \n    const timeDiffMs = point.timestamp - lastValidPoint.timestamp;\n    const timeDiffHours = timeDiffMs / (1000 * 60 * 60);\n    \n    if (timeDiffHours > 0) {\n      const speedKmh = segmentDistanceKm / timeDiffHours;\n      \n      if (speedKmh < MIN_SPEED_KMH || speedKmh > MAX_SPEED_KMH) {\n        continue;\n      }\n    }\n    \n    totalDistance += segmentDistanceKm;\n    lastValidPoint = point;\n  }\n\n  return totalDistance;\n}\n","path":null,"size_bytes":11162,"size_tokens":null}},"version":2}